!function(t){var e={};function i(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,o){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:o})},i.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=4)}([function(t,e,i){var o,r;r=this,void 0===(o=function(t){return r.ex=function(){var t,e,i;!function(o){var r,n,s,a,h={},l={},c={},u={},p=Object.prototype.hasOwnProperty,d=[].slice,f=/\.js$/;function g(t,e){return p.call(t,e)}function y(t,e){var i,o,r,n,s,a,h,l,u,p,d,g,y=e&&e.split("/"),_=c.map,v=_&&_["*"]||{};if(t){for(t=t.split("/"),s=t.length-1,c.nodeIdCompat&&f.test(t[s])&&(t[s]=t[s].replace(f,"")),"."===t[0].charAt(0)&&y&&(g=y.slice(0,y.length-1),t=g.concat(t)),u=0;u<t.length;u++)if("."===(d=t[u]))t.splice(u,1),u-=1;else if(".."===d){if(0===u||1===u&&".."===t[2]||".."===t[u-1])continue;u>0&&(t.splice(u-1,2),u-=2)}t=t.join("/")}if((y||v)&&_){for(i=t.split("/"),u=i.length;u>0;u-=1){if(o=i.slice(0,u).join("/"),y)for(p=y.length;p>0;p-=1)if((r=_[y.slice(0,p).join("/")])&&(r=r[o])){n=r,a=u;break}if(n)break;!h&&v&&v[o]&&(h=v[o],l=u)}!n&&h&&(n=h,a=l),n&&(i.splice(0,a,n),t=i.join("/"))}return t}function _(t,e){return function(){var i=d.call(arguments,0);return"string"!=typeof i[0]&&1===i.length&&i.push(null),n.apply(o,i.concat([t,e]))}}function v(t){return function(e){h[t]=e}}function m(t){if(g(l,t)){var e=l[t];delete l[t],u[t]=!0,r.apply(o,e)}if(!g(h,t)&&!g(u,t))throw new Error("No "+t);return h[t]}function b(t){var e,i=t?t.indexOf("!"):-1;return i>-1&&(e=t.substring(0,i),t=t.substring(i+1,t.length)),[e,t]}function w(t){return t?b(t):[]}s=function(t,e){var i,o,r=b(t),n=r[0],s=e[1];return t=r[1],n&&(n=y(n,s),i=m(n)),n?t=i&&i.normalize?i.normalize(t,(o=s,function(t){return y(t,o)})):y(t,s):(t=y(t,s),r=b(t),n=r[0],t=r[1],n&&(i=m(n))),{f:n?n+"!"+t:t,n:t,pr:n,p:i}},a={require:function(t){return _(t)},exports:function(t){var e=h[t];return void 0!==e?e:h[t]={}},module:function(t){return{id:t,uri:"",exports:h[t],config:function(t){return function(){return c&&c.config&&c.config[t]||{}}}(t)}}},r=function(t,e,i,r){var n,c,p,d,f,y,b,x=[],P=typeof i;if(y=w(r=r||t),"undefined"===P||"function"===P){for(e=!e.length&&i.length?["require","exports","module"]:e,f=0;f<e.length;f+=1)if(d=s(e[f],y),"require"===(c=d.f))x[f]=a.require(t);else if("exports"===c)x[f]=a.exports(t),b=!0;else if("module"===c)n=x[f]=a.module(t);else if(g(h,c)||g(l,c)||g(u,c))x[f]=m(c);else{if(!d.p)throw new Error(t+" missing "+c);d.p.load(d.n,_(r,!0),v(c),{}),x[f]=h[c]}p=i?i.apply(h[t],x):void 0,t&&(n&&n.exports!==o&&n.exports!==h[t]?h[t]=n.exports:p===o&&b||(h[t]=p))}else t&&(h[t]=i)},t=e=n=function(t,e,i,h,l){if("string"==typeof t)return a[t]?a[t](e):m(s(t,w(e)).f);if(!t.splice){if((c=t).deps&&n(c.deps,c.callback),!e)return;e.splice?(t=e,e=i,i=null):t=o}return e=e||function(){},"function"==typeof i&&(i=h,h=l),h?r(o,t,e,i):setTimeout(function(){r(o,t,e,i)},4),n},n.config=function(t){return n(t)},t._defined=h,(i=function(t,e,i){if("string"!=typeof t)throw new Error("See almond README: incorrect module build, no module name");e.splice||(i=e,e=[]),g(h,t)||g(l,t)||(l[t]=[t,e,i])}).amd={jQuery:!0}}();var o,r=this&&this.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var r,n=arguments.length,s=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(n<3?r(s):n>3?r(e,i,s):r(e,i))||s);return n>3&&s&&Object.defineProperty(e,i,s),s};return i("Actions/RotationType",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.ShortestPath=0]="ShortestPath",t[t.LongestPath=1]="LongestPath",t[t.Clockwise=2]="Clockwise",t[t.CounterClockwise=3]="CounterClockwise"}(e.RotationType||(e.RotationType={}))}),i("Util/EasingFunctions",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){};i.Linear=function(t,e,i,o){return(i-=e)*t/o+e},i.EaseInQuad=function(t,e,i,o){return(i-=e)*(t/=o)*t+e},i.EaseOutQuad=function(t,e,i,o){return-(i-=e)*(t/=o)*(t-2)+e},i.EaseInOutQuad=function(t,e,i,o){return i-=e,(t/=o/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},i.EaseInCubic=function(t,e,i,o){return(i-=e)*(t/=o)*t*t+e},i.EaseOutCubic=function(t,e,i,o){return t/=o,(i-=e)*(--t*t*t+1)+e},i.EaseInOutCubic=function(t,e,i,o){return i-=e,(t/=o/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e},e.EasingFunctions=i}),i("Promises",["require","exports"],function(t,e){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.Resolved=0]="Resolved",t[t.Rejected=1]="Rejected",t[t.Pending=2]="Pending"}(i=e.PromiseState||(e.PromiseState={}));var o=function(){function t(){this._state=i.Pending,this._successCallbacks=[],this._rejectCallback=function(){}}return t.resolve=function(e){return(new t).resolve(e)},t.reject=function(e){return(new t).reject(e)},t.join=function(){var e=[];if(arguments.length>0&&!Array.isArray(arguments[0]))for(var i=0;i<arguments.length;i++)e[i-0]=arguments[i];else 1===arguments.length&&Array.isArray(arguments[0])&&(e=arguments[0]);var o=new t;if(!e||!e.length)return o.resolve();var r=e.length,n=0,s=0,a=[];return e.forEach(function(t){t.then(function(){(n+=1)===r?o.resolve():n+s+a.length===r&&o.reject(a)},function(){n+(s+=1)+a.length===r&&o.reject(a)}).error(function(t){a.push(t),a.length+n+s===r&&o.reject(a)})}),o},t.prototype.then=function(t,e){if(t&&(this._successCallbacks.push(t),this.state()===i.Resolved))try{t.call(this,this._value)}catch(t){this._handleError(t)}if(e&&(this._rejectCallback=e,this.state()===i.Rejected))try{e.call(this,this._value)}catch(t){this._handleError(t)}return this},t.prototype.error=function(t){return t&&(this._errorCallback=t),this},t.prototype.resolve=function(t){var e=this;if(this._state!==i.Pending)throw new Error("Cannot resolve a promise that is not in a pending state!");this._value=t;try{this._state=i.Resolved,this._successCallbacks.forEach(function(t){t.call(e,e._value)})}catch(t){this._handleError(t)}return this},t.prototype.reject=function(t){if(this._state!==i.Pending)throw new Error("Cannot reject a promise that is not in a pending state!");this._value=t;try{this._state=i.Rejected,this._rejectCallback.call(this,this._value)}catch(t){this._handleError(t)}return this},t.prototype.state=function(){return this._state},t.prototype._handleError=function(t){if(!this._errorCallback)throw t;this._errorCallback.call(this,t)},t}();e.Promise=o}),i("Math/Random",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){this.seed=t,this._lowerMask=2147483647,this._upperMask=2147483648,this._w=32,this._n=624,this._m=397,this._a=2567483615,this._u=11,this._s=7,this._b=2636928640,this._t=15,this._c=4022730752,this._l=18,this._f=1812433253,this._mt=new Array(this._n),this._mt[0]=(t||Date.now())>>>0;for(var e=1;e<this._n;e++){var i=this._mt[e-1]^this._mt[e-1]>>>this._w-2;this._mt[e]=(this._f*((4294901760&i)>>>16)<<16)+this._f*(65535&i)+e>>>0}this._index=this._n}return t.prototype._twist=function(){for(var t=[0,this._a],e=0,i=0;i<this._n-this._m;i++)e=this._mt[i]&this._upperMask|this._mt[i+1]&this._lowerMask,this._mt[i]=this._mt[i+this._m]^e>>>1^4294967295&t[1&e];for(;i<this._n-1;i++)e=this._mt[i]&this._upperMask|this._mt[i+1]&this._lowerMask,this._mt[i]=this._mt[i+(this._m-this._n)]^e>>>1^4294967295&t[1&e];e=this._mt[this._n-1]&this._upperMask|this._mt[0]&this._lowerMask,this._mt[this._n-1]=this._mt[this._m-1]^e>>>1^4294967295&t[1&e],this._index=0},t.prototype.nextInt=function(){this._index>=this._n&&this._twist();var t=this._mt[this._index++];return t^=t>>>this._u,t^=t<<this._s&this._b,t^=t<<this._t&this._c,(t^=t>>>this._l)>>>0},t.prototype.next=function(){return this.nextInt()*(1/4294967296)},t.prototype.floating=function(t,e){return(e-t)*this.next()+t},t.prototype.integer=function(t,e){return Math.floor((e-t+1)*this.next()+t)},t.prototype.bool=function(t){return void 0===t&&(t=.5),this.next()<=t},t.prototype.pickOne=function(t){return t[this.integer(0,t.length-1)]},t.prototype.pickSet=function(t,e,i){return void 0===i&&(i=!1),i?this._pickSetWithDuplicates(t,e):this._pickSetWithoutDuplicates(t,e)},t.prototype._pickSetWithoutDuplicates=function(t,e){if(e>t.length||e<0)throw new Error("Invalid number of elements to pick, must pick a value 0 < n <= length");if(e===t.length)return t;for(var i=new Array(e),o=0,r=t.slice(0);o<e;){var n=this.integer(0,r.length-1);i[o++]=r[n],r.splice(n,1)}return i},t.prototype._pickSetWithDuplicates=function(t,e){if(e<0)throw new Error("Invalid number of elements to pick, must pick a value 0 <= n < MAX_INT");for(var i=new Array(e),o=0;o<e;o++)i.push(this.pickOne(t));return i},t.prototype.shuffle=function(t){for(var e=t.slice(0),i=null,o=0;o<e.length-2;o++){var r=this.integer(o,e.length-1);i=e[o],e[o]=e[r],e[r]=i}return e},t.prototype.range=function(t,e,i){for(var o=new Array(t),r=0;r<t;r++)o[r]=this.integer(e,i);return o},t.prototype.d4=function(){return this.integer(1,4)},t.prototype.d6=function(){return this.integer(1,6)},t.prototype.d8=function(){return this.integer(1,8)},t.prototype.d10=function(){return this.integer(1,10)},t.prototype.d12=function(){return this.integer(1,12)},t.prototype.d20=function(){return this.integer(1,20)},t}();e.Random=i}),i("Collision/Side",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.None=0]="None",t[t.Top=1]="Top",t[t.Bottom=2]="Bottom",t[t.Left=3]="Left",t[t.Right=4]="Right"}(e.Side||(e.Side={}))}),i("Util/Util",["require","exports","Algebra","Math/Random","Collision/Side"],function(t,e,i,o,r){"use strict";function n(t,e,i){return void 0===i&&(i=new o.Random),i?i.floating(t,e):t+Math.random()*(e-t)}Object.defineProperty(e,"__esModule",{value:!0}),e.TwoPI=2*Math.PI,e.extend=function t(){var e={},i=!1,o=0,r=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(i=arguments[0],o++);var n="function"==typeof Object.assign,s=null;for(s=n?Object.assign:function(o){for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(i&&"[object Object]"===Object.prototype.toString.call(o[r])?e[r]=t(!0,e[r],o[r]):e[r]=o[r])};o<r;o++){var a=arguments[o];n?s(e,a):s(a)}return e},e.base64Encode=function(t){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="",o=0;o<t.length;){var r,n,s=255&t.charCodeAt(o++),a=255&t.charCodeAt(o++),h=255&t.charCodeAt(o++),l=s>>2,c=(3&s)<<4|a>>4;isNaN(a)?r=n=64:(r=(15&a)<<2|h>>6,n=isNaN(h)?64:63&h),i+=e.charAt(l)+e.charAt(c)+e.charAt(r)+e.charAt(n)}return i},e.clamp=function(t,e,i){return Math.min(Math.max(e,t),i)},e.randomInRange=n,e.randomIntInRange=function(t,e,i){return void 0===i&&(i=new o.Random),i?i.integer(t,e):Math.round(n(t,e))},e.canonicalizeAngle=function(t){var i=t;if(t>e.TwoPI)for(;i>e.TwoPI;)i-=e.TwoPI;if(t<0)for(;i<0;)i+=e.TwoPI;return i},e.toDegrees=function(t){return 180/Math.PI*t},e.toRadians=function(t){return t/180*Math.PI},e.getPosition=function(t){var e=0,o=0,r=function(t){e+=t.offsetLeft,t.offsetParent&&r(t.offsetParent)},n=function(t){o+=t.offsetTop,t.offsetParent&&n(t.offsetParent)};return r(t),n(t),new i.Vector(e,o)},e.addItemToArray=function(t,e){return-1===e.indexOf(t)&&(e.push(t),!0)},e.removeItemFromArray=function(t,e){var i;return(i=e.indexOf(t))>-1&&(e.splice(i,1),!0)},e.contains=function(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return!0;return!1},e.getOppositeSide=function(t){return t===r.Side.Top?r.Side.Bottom:t===r.Side.Bottom?r.Side.Top:t===r.Side.Left?r.Side.Right:t===r.Side.Right?r.Side.Left:r.Side.None},e.getSideFromVector=function(t){for(var e=[i.Vector.Left,i.Vector.Right,i.Vector.Up,i.Vector.Down],o=[r.Side.Left,r.Side.Right,r.Side.Top,r.Side.Bottom],n=-Number.MAX_VALUE,s=-1,a=0;a<e.length;a++)e[a].dot(t)>n&&(n=e[a].dot(t),s=a);return o[s]};var s=function(){function t(e){void 0===e&&(e=t.DefaultSize),this._internalArray=null,this._endPointer=0,this._internalArray=new Array(e)}return t.prototype._resize=function(){for(var t=2*this._internalArray.length,e=new Array(t),i=this.count(),o=0;o<i;o++)e[o]=this._internalArray[o];delete this._internalArray,this._internalArray=e},t.prototype.push=function(t){return this._endPointer===this._internalArray.length&&this._resize(),this._internalArray[this._endPointer++]=t},t.prototype.pop=function(){return this._endPointer=this._endPointer-1<0?0:this._endPointer-1,this._internalArray[this._endPointer]},t.prototype.count=function(){return this._endPointer},t.prototype.clear=function(){this._endPointer=0},t.prototype.internalSize=function(){return this._internalArray.length},t.prototype.elementAt=function(t){if(t>=this.count())throw new Error("Invalid index "+t);return this._internalArray[t]},t.prototype.insert=function(t,e){return t>=this.count()&&this._resize(),this._internalArray[t]=e},t.prototype.remove=function(t){var e=this.count();if(0===e)throw new Error("Invalid parameter "+t);for(var i=this._internalArray[t],o=t;o<e;o++)this._internalArray[o]=this._internalArray[o+1];return this._endPointer--,i},t.prototype.removeElement=function(t){var e=this._internalArray.indexOf(t);this.remove(e)},t.prototype.toArray=function(){return this._internalArray.slice(0,this._endPointer)},t.prototype.forEach=function(t){for(var e=0,i=this.count();e<i;e++)t.call(this,this._internalArray[e],e)},t.prototype.map=function(t){for(var e=this.count(),i=0;i<e;i++)this._internalArray[i]=t.call(this,this._internalArray[i],i)},t}();s.DefaultSize=200,e.Collection=s}),i("Interfaces/IActorTrait",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}),i("Traits/CapturePointer",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.update=function(t,e){t.enableCapturePointer&&(t.isKilled()||e.input.pointers.propogate(t))},t}();e.CapturePointer=i}),i("Traits/EulerMovement",["require","exports","Physics","Actor"],function(t,e,i,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){}return t.prototype.update=function(t,e,r){var n=r/1e3,s=t.acc.clone();t.collisionType===o.CollisionType.Active&&s.addEqual(i.Physics.acc),t.oldVel=t.vel,t.vel.addEqual(s.scale(n)),t.pos.addEqual(t.vel.scale(n)).addEqual(s.scale(.5*n*n)),t.rx+=t.torque*(1/t.moi)*n,t.rotation+=t.rx*n,t.scale.x+=t.sx*r/1e3,t.scale.y+=t.sy*r/1e3},t}();e.EulerMovement=r}),i("Drawing/Color",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e,i,o){this.r=t,this.g=e,this.b=i,this.a=null!=o?o:1}return t.fromRGB=function(e,i,o,r){return new t(e,i,o,r)},t.fromHex=function(e){var i;if(i=e.match(/^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i)){var o=parseInt(i[1],16),r=parseInt(i[2],16),n=parseInt(i[3],16),s=1;return i[4]&&(s=parseInt(i[4],16)/255),new t(o,r,n,s)}throw new Error("Invalid hex string: "+e)},t.fromHSL=function(t,e,i,r){return void 0===r&&(r=1),new o(t,e,i,r).toRGBA()},t.prototype.lighten=function(t){void 0===t&&(t=.1);var e=o.fromRGBA(this.r,this.g,this.b,this.a);return e.l+=e.l*t,e.toRGBA()},t.prototype.darken=function(t){void 0===t&&(t=.1);var e=o.fromRGBA(this.r,this.g,this.b,this.a);return e.l-=e.l*t,e.toRGBA()},t.prototype.saturate=function(t){void 0===t&&(t=.1);var e=o.fromRGBA(this.r,this.g,this.b,this.a);return e.s+=e.s*t,e.toRGBA()},t.prototype.desaturate=function(t){void 0===t&&(t=.1);var e=o.fromRGBA(this.r,this.g,this.b,this.a);return e.s-=e.s*t,e.toRGBA()},t.prototype.mulitiply=function(e){return new t(e.r/255*this.r/255*255,e.g/255*this.g/255*255,e.b/255*this.b/255*255,e.a*this.a)},t.prototype.screen=function(t){var e=t.invert(),i=t.invert();return e.mulitiply(i).invert()},t.prototype.invert=function(){return new t(255-this.r,255-this.g,255-this.b,1-this.a)},t.prototype.average=function(e){return new t((e.r+this.r)/2,(e.g+this.g)/2,(e.b+this.b)/2,(e.a+this.a)/2)},t.prototype.toString=function(t){switch(void 0===t&&(t="rgb"),t){case"rgb":return this.toRGBA();case"hsl":return this.toHSLA();case"hex":return this.toHex();default:throw new Error("Invalid Color format")}},t.prototype._componentToHex=function(t){var e=t.toString(16);return 1===e.length?"0"+e:e},t.prototype.toHex=function(){return"#"+this._componentToHex(this.r)+this._componentToHex(this.g)+this._componentToHex(this.b)},t.prototype.toRGBA=function(){var t=String(this.r.toFixed(0))+", "+String(this.g.toFixed(0))+", "+String(this.b.toFixed(0));return void 0!==this.a||null!==this.a?"rgba("+t+", "+String(this.a)+")":"rgb("+t+")"},t.prototype.toHSLA=function(){return o.fromRGBA(this.r,this.g,this.b,this.a).toString()},t.prototype.fillStyle=function(){return this.toString()},t.prototype.clone=function(){return new t(this.r,this.g,this.b,this.a)},t}();i.Black=i.fromHex("#000000"),i.White=i.fromHex("#FFFFFF"),i.Gray=i.fromHex("#808080"),i.LightGray=i.fromHex("#D3D3D3"),i.DarkGray=i.fromHex("#A9A9A9"),i.Yellow=i.fromHex("#FFFF00"),i.Orange=i.fromHex("#FFA500"),i.Red=i.fromHex("#FF0000"),i.Vermillion=i.fromHex("#FF5B31"),i.Rose=i.fromHex("#FF007F"),i.Magenta=i.fromHex("#FF00FF"),i.Violet=i.fromHex("#7F00FF"),i.Blue=i.fromHex("#0000FF"),i.Azure=i.fromHex("#007FFF"),i.Cyan=i.fromHex("#00FFFF"),i.Viridian=i.fromHex("#59978F"),i.Green=i.fromHex("#00FF00"),i.Chartreuse=i.fromHex("#7FFF00"),i.Transparent=i.fromHex("#FFFFFF00"),e.Color=i;var o=function(){function t(t,e,i,o){this.h=t,this.s=e,this.l=i,this.a=o}return t.hue2rgb=function(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t},t.fromRGBA=function(e,i,o,r){e/=255,i/=255,o/=255;var n,s,a=Math.max(e,i,o),h=Math.min(e,i,o),l=(a+h)/2;if(a===h)n=s=0;else{var c=a-h;switch(s=l>.5?c/(2-a-h):c/(a+h),a){case e:n=(i-o)/c+(i<o?6:0);break;case i:n=(o-e)/c+2;break;case o:n=(e-i)/c+4}n/=6}return new t(n,s,l,r)},t.prototype.toRGBA=function(){var e,o,r;if(0===this.s)e=o=r=this.l;else{var n=this.l<.5?this.l*(1+this.s):this.l+this.s-this.l*this.s,s=2*this.l-n;e=t.hue2rgb(s,n,this.h+1/3),o=t.hue2rgb(s,n,this.h),r=t.hue2rgb(s,n,this.h-1/3)}return new i(255*e,255*o,255*r,this.a)},t.prototype.toString=function(){return"hsla("+this.h.toFixed(0)+", "+this.s.toFixed(0)+", "+this.l.toFixed(0)+", "+this.a.toFixed(0)+")"},t}()}),i("Util/CullingBox",["require","exports","Algebra","Drawing/Color"],function(t,e,i,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){this._topLeft=new i.Vector(0,0),this._topRight=new i.Vector(0,0),this._bottomLeft=new i.Vector(0,0),this._bottomRight=new i.Vector(0,0)}return t.prototype.isSpriteOffScreen=function(t,e){var o=t.currentDrawing.drawWidth,r=t.currentDrawing.drawHeight,n=t.rotation,s=t.getCenter(),a=t.getWorldPos();this._topLeft.x=a.x-o/2,this._topLeft.y=a.y-r/2,this._topLeft=this._topLeft.rotate(n,s),this._topRight.x=a.x+o/2,this._topRight.y=a.y-r/2,this._topRight=this._topRight.rotate(n,s),this._bottomLeft.x=a.x-o/2,this._bottomLeft.y=a.y+r/2,this._bottomLeft=this._bottomLeft.rotate(n,s),this._bottomRight.x=a.x+o/2,this._bottomRight.y=a.y+r/2,this._bottomRight=this._bottomRight.rotate(n,s);var h=e.worldToScreenCoordinates(this._topLeft),l=e.worldToScreenCoordinates(this._topRight),c=e.worldToScreenCoordinates(this._bottomLeft),u=e.worldToScreenCoordinates(this._bottomRight);this._xCoords=[],this._yCoords=[],this._xCoords.push(h.x,l.x,c.x,u.x),this._yCoords.push(h.y,l.y,c.y,u.y),this._xMin=Math.min.apply(null,this._xCoords),this._yMin=Math.min.apply(null,this._yCoords),this._xMax=Math.max.apply(null,this._xCoords),this._yMax=Math.max.apply(null,this._yCoords);var p=e.screenToWorldCoordinates(new i.Vector(this._xMin,this._yMin)),d=e.screenToWorldCoordinates(new i.Vector(this._xMax,this._yMax));this._xMinWorld=p.x,this._yMinWorld=p.y,this._xMaxWorld=d.x,this._yMaxWorld=d.y;var f=[new i.Vector(this._xMin,this._yMin),new i.Vector(this._xMax,this._yMin),new i.Vector(this._xMin,this._yMax),new i.Vector(this._xMax,this._yMax)];if(f[0].x<0&&f[1].x>e.canvas.clientWidth&&(f[0].y>0||f[2].y<e.canvas.clientHeight))return!1;if(f[0].y<0&&f[2].y>e.canvas.clientHeight&&(f[1].x>0||f[0].x<e.canvas.clientWidth))return!1;for(var g=0;g<f.length;g++)if(f[g].x>0&&f[g].y>0&&f[g].x<e.canvas.clientWidth&&f[g].y<e.canvas.clientHeight)return!1;return!0},t.prototype.debugDraw=function(t){t.beginPath(),t.strokeStyle=o.Color.White.toString(),t.rect(this._xMinWorld,this._yMinWorld,this._xMaxWorld-this._xMinWorld,this._yMaxWorld-this._yMinWorld),t.stroke(),t.fillStyle=o.Color.Red.toString(),t.beginPath(),t.arc(this._topLeft.x,this._topLeft.y,5,0,2*Math.PI),t.closePath(),t.fill(),t.fillStyle=o.Color.Green.toString(),t.beginPath(),t.arc(this._topRight.x,this._topRight.y,5,0,2*Math.PI),t.closePath(),t.fill(),t.fillStyle=o.Color.Blue.toString(),t.beginPath(),t.arc(this._bottomLeft.x,this._bottomLeft.y,5,0,2*Math.PI),t.closePath(),t.fill(),t.fillStyle=o.Color.Magenta.toString(),t.beginPath(),t.arc(this._bottomRight.x,this._bottomRight.y,5,0,2*Math.PI),t.closePath(),t.fill()},t}();e.CullingBox=r}),i("Traits/OffscreenCulling",["require","exports","Util/CullingBox","Algebra","Events"],function(t,e,i,o,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){this.cullingBox=new i.CullingBox}return t.prototype.update=function(t,e){var i=t.eventDispatcher,n=t.anchor,s=t.getGlobalScale(),a=s.x*t.getWidth()/t.scale.x,h=s.y*t.getHeight()/t.scale.y,l=t.getWorldPos(),c=e.worldToScreenCoordinates(new o.Vector(l.x-n.x*a,l.y-n.y*h)),u=1;t.scene&&t.scene.camera&&(u=Math.abs(t.scene.camera.getZoom()));var p=!0;null!=t.currentDrawing&&(p=this.cullingBox.isSpriteOffScreen(t,e)),t.isOffScreen?(c.x+a*u>0&&c.y+h*u>0&&c.x<e.drawWidth&&c.y<e.drawHeight||!p)&&(i.emit("enterviewport",new r.EnterViewPortEvent(t)),t.isOffScreen=!1):(c.x+a*u<0||c.y+h*u<0||c.x>e.drawWidth||c.y>e.drawHeight)&&p&&(i.emit("exitviewport",new r.ExitViewPortEvent(t)),t.isOffScreen=!0)},t}();e.OffscreenCulling=n}),i("Traits/TileMapCollisionDetection",["require","exports","Actor","Collision/Side","Events"],function(t,e,i,o,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}return t.prototype.update=function(t,e){var n=t.eventDispatcher;if(t.collisionType!==i.CollisionType.PreventCollision&&e.currentScene&&e.currentScene.tileMaps)for(var s=0;s<e.currentScene.tileMaps.length;s++)for(var a,h=e.currentScene.tileMaps[s],l=o.Side.None,c=2;(a=h.collides(t))&&!(c--<0);)l=t.getSideFromIntersect(a),n.emit("precollision",new r.PreCollisionEvent(t,null,l,a)),t.collisionType===i.CollisionType.Active&&(t.pos.y+=a.y,t.pos.x+=a.x,n.emit("postcollision",new r.PostCollisionEvent(t,null,l,a)))},t}();e.TileMapCollisionDetection=n}),i("Traits/Index",["require","exports","Traits/CapturePointer","Traits/EulerMovement","Traits/OffscreenCulling","Traits/TileMapCollisionDetection"],function(t,e,i,o,r,n){"use strict";function s(t){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}Object.defineProperty(e,"__esModule",{value:!0}),s(i),s(o),s(r),s(n)}),i("UIActor",["require","exports","Algebra","Actor","Traits/Index"],function(t,e,i,o,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(t){function e(e,i,r,s){var a=this;return(a=t.call(this,e,i,r,s)||this).traits=[],a.traits.push(new n.CapturePointer),a.anchor.setTo(0,0),a.collisionType=o.CollisionType.PreventCollision,a.enableCapturePointer=!0,a}return r(e,t),e.prototype._initialize=function(e){this._engine=e,t.prototype._initialize.call(this,e)},e.prototype.contains=function(e,o,r){if(void 0===r&&(r=!0),r)return t.prototype.contains.call(this,e,o);var n=this._engine.worldToScreenCoordinates(new i.Vector(e,o));return t.prototype.contains.call(this,n.x,n.y)},e}(o.Actor);e.UIActor=s}),i("Util/Log",["require","exports"],function(t,e){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.Debug=0]="Debug",t[t.Info=1]="Info",t[t.Warn=2]="Warn",t[t.Error=3]="Error",t[t.Fatal=4]="Fatal"}(i=e.LogLevel||(e.LogLevel={}));var o=function(){function t(){if(this._appenders=[],this.defaultLevel=i.Info,t._instance)throw new Error("Logger is a singleton");return t._instance=this,t._instance.addAppender(new r),t._instance}return t.getInstance=function(){return null==t._instance&&(t._instance=new t),t._instance},t.prototype.addAppender=function(t){this._appenders.push(t)},t.prototype.clearAppenders=function(){this._appenders.length=0},t.prototype._log=function(t,e){null==t&&(t=this.defaultLevel);for(var i=0,o=this._appenders.length;i<o;i++)t>=this.defaultLevel&&this._appenders[i].log(t,e)},t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._log(i.Debug,t)},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._log(i.Info,t)},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._log(i.Warn,t)},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._log(i.Error,t)},t.prototype.fatal=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._log(i.Fatal,t)},t}();o._instance=null,e.Logger=o;var r=function(){function t(){}return t.prototype.log=function(t,e){if(console||console.log||!console.warn||!console.error){var o=[];o.unshift.apply(o,e),o.unshift("["+i[t]+"] : "),t<i.Warn?console.log.apply?console.log.apply(console,o):console.log(o.join(" ")):t<i.Error?console.warn.apply?console.warn.apply(console,o):console.warn(o.join(" ")):console.error.apply?console.error.apply(console,o):console.error(o.join(" "))}},t}();e.ConsoleAppender=r;var n=function(){function t(t,e){this._messages=[],this._canvas=document.createElement("canvas"),this._canvas.width=t||window.innerWidth,this._canvas.height=e||window.innerHeight,this._canvas.style.position="absolute",this._ctx=this._canvas.getContext("2d"),document.body.appendChild(this._canvas)}return t.prototype.log=function(t,e){var o=e.join(",");this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._messages.unshift("["+i[t]+"] : "+o);for(var r=10,n=1,s=0;s<this._messages.length;s++)this._ctx.fillStyle="rgba(255,255,255,"+n.toFixed(2)+")",this._ctx.fillText(this._messages[s],200,r),r+=10,n=n>0?n-.05:0},t}();e.ScreenAppender=n}),i("Timer",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(e,i,o){this.id=0,this.interval=10,this.fcn=function(){},this.repeats=!1,this._elapsedTime=0,this._totalTimeAlive=0,this._paused=!1,this.complete=!1,this.scene=null,this.id=t.id++,this.interval=i||this.interval,this.fcn=e||this.fcn,this.repeats=o||this.repeats}return t.prototype.update=function(t){this._paused||(this._totalTimeAlive+=t,this._elapsedTime+=t,!this.complete&&this._elapsedTime>=this.interval&&(this.fcn.call(this),this.repeats?this._elapsedTime=0:this.complete=!0))},t.prototype.reset=function(t){t&&t>=0&&(this.interval=t),this.complete=!1,this._elapsedTime=0},t.prototype.getTimeRunning=function(){return this._totalTimeAlive},t.prototype.pause=function(){this._paused=!0},t.prototype.unpause=function(){this._paused=!1},t.prototype.cancel=function(){this.scene&&this.scene.cancelTimer(this)},t}();i.id=0,e.Timer=i}),i("Collision/CollisionContact",["require","exports","Actor","Algebra","Physics","Events","Util/Util"],function(t,e,i,o,r,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e,i,o,r){this.bodyA=t,this.bodyB=e,this.mtv=i,this.point=o,this.normal=r}return t.prototype.resolve=function(t){if(t===r.CollisionResolutionStrategy.RigidBody)this._resolveRigidBodyCollision();else{if(t!==r.CollisionResolutionStrategy.Box)throw new Error("Unknown collision resolution strategy");this._resolveBoxCollision()}},t.prototype._applyBoxImpulse=function(t,e,o){if(t.collisionType===i.CollisionType.Active&&e.collisionType!==i.CollisionType.Passive){if(t.collisionType===i.CollisionType.Active&&e.collisionType===i.CollisionType.Active&&(o=o.scale(.5)),t.pos.y+=o.y,t.pos.x+=o.x,0!==this.mtv.x){var r=0;t.vel.x<0&&e.vel.x<0?r=Math.min(t.vel.x,e.vel.x):t.vel.x>0&&e.vel.x>0?r=Math.max(t.vel.x,e.vel.x):e.collisionType===i.CollisionType.Fixed&&(r=t.pos.sub(e.pos).dot(t.vel)>0?t.vel.x:e.vel.x),t.vel.x=r}if(0!==this.mtv.y){var a=0;t.vel.y<0&&e.vel.y<0?a=Math.min(t.vel.y,e.vel.y):t.vel.y>0&&e.vel.y>0?a=Math.max(t.vel.y,e.vel.y):e.collisionType===i.CollisionType.Fixed&&(a=t.pos.sub(e.pos).dot(t.vel)>0?t.vel.y:e.vel.y),t.vel.y=a}t.emit("postcollision",new n.PostCollisionEvent(t,e,s.getSideFromVector(o),o))}},t.prototype._resolveBoxCollision=function(){var t=this.bodyA.body.actor,e=this.bodyB.body.actor,i=s.getSideFromVector(this.mtv),o=this.mtv.negate();t.emit("precollision",new n.PreCollisionEvent(t,e,i,o)),e.emit("precollision",new n.PreCollisionEvent(e,t,s.getOppositeSide(i),o.negate())),this._applyBoxImpulse(t,e,o),this._applyBoxImpulse(e,t,o.negate())},t.prototype._resolveRigidBodyCollision=function(){var t=this.bodyA.body,e=this.bodyB.body,a=this.mtv,h=this.normal;if(t.actor!==e.actor){var l=s.getSideFromVector(this.mtv);if(t.actor.emit("precollision",new n.PreCollisionEvent(this.bodyA.body.actor,this.bodyB.body.actor,l,this.mtv)),e.actor.emit("precollision",new n.PreCollisionEvent(this.bodyB.body.actor,this.bodyA.body.actor,s.getOppositeSide(l),this.mtv.negate())),t.actor.collisionType!==i.CollisionType.Passive&&e.actor.collisionType!==i.CollisionType.Passive){var c=t.actor.collisionType===i.CollisionType.Fixed?0:1/t.mass,u=e.actor.collisionType===i.CollisionType.Fixed?0:1/e.mass,p=t.actor.collisionType===i.CollisionType.Fixed?0:1/t.moi,d=e.actor.collisionType===i.CollisionType.Fixed?0:1/e.moi,f=Math.min(t.restitution,e.restitution),g=Math.min(t.friction,e.friction),y=(h=h.normalize()).normal().normalize(),_=this.point.sub(this.bodyA.getCenter()),v=this.point.sub(this.bodyB.getCenter()),m=e.vel.add(v.cross(-e.rx)).sub(t.vel.sub(_.cross(t.rx))),b=m.dot(h),w=m.dot(y),x=_.dot(y),P=_.dot(h),C=v.dot(y),S=v.dot(h);if(!(b>0)){var A=-(1+f)*b/(c+u+p*x*x+d*C*C);if(t.actor.collisionType===i.CollisionType.Fixed?(e.vel=e.vel.add(h.scale(A*u)),r.Physics.allowRigidBodyRotation&&(e.rx-=A*d*-v.cross(h)),e.addMtv(a)):e.actor.collisionType===i.CollisionType.Fixed?(t.vel=t.vel.sub(h.scale(A*c)),r.Physics.allowRigidBodyRotation&&(t.rx+=A*p*-_.cross(h)),t.addMtv(a.negate())):(e.vel=e.vel.add(h.scale(A*u)),t.vel=t.vel.sub(h.scale(A*c)),r.Physics.allowRigidBodyRotation&&(e.rx-=A*d*-v.cross(h),t.rx+=A*p*-_.cross(h)),e.addMtv(a.scale(.5)),t.addMtv(a.scale(-.5))),g&&w){var E=m.sub(h.scale(m.dot(h))).normalize(),T=m.dot(E)/(c+u+P*P*p+S*S*d),M=new o.Vector(0,0);M=Math.abs(T)<=A*g?E.scale(T).negate():E.scale(-A*g),t.actor.collisionType===i.CollisionType.Fixed?(e.vel=e.vel.add(M.scale(u)),r.Physics.allowRigidBodyRotation&&(e.rx+=M.dot(E)*d*v.cross(E))):e.actor.collisionType===i.CollisionType.Fixed?(t.vel=t.vel.sub(M.scale(c)),r.Physics.allowRigidBodyRotation&&(t.rx-=M.dot(E)*p*_.cross(E))):(e.vel=e.vel.add(M.scale(u)),t.vel=t.vel.sub(M.scale(c)),r.Physics.allowRigidBodyRotation&&(e.rx+=M.dot(E)*d*v.cross(E),t.rx-=M.dot(E)*p*_.cross(E)))}t.actor.emit("postcollision",new n.PostCollisionEvent(this.bodyA.body.actor,this.bodyB.body.actor,l,this.mtv)),e.actor.emit("postcollision",new n.PostCollisionEvent(this.bodyB.body.actor,this.bodyA.body.actor,s.getOppositeSide(l),this.mtv.negate()))}}}},t}();e.CollisionContact=a}),i("Collision/ICollisionArea",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}),i("Collision/CircleArea",["require","exports","Collision/BoundingBox","Collision/PolygonArea","Collision/EdgeArea","Collision/CollisionJumpTable","Algebra","Physics","Drawing/Color"],function(t,e,i,o,r,n,s,a,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(t){this.pos=s.Vector.Zero.clone(),this.pos=t.pos||s.Vector.Zero.clone(),this.radius=t.radius||0,this.body=t.body||null}return t.prototype.getCenter=function(){return this.body?this.pos.add(this.body.pos):this.pos},t.prototype.contains=function(t){return this.body.pos.distance(t)<=this.radius},t.prototype.rayCast=function(t,e){void 0===e&&(e=1/0);var i=this.getCenter(),o=t.dir,r=t.pos,n=Math.sqrt(Math.pow(o.dot(r.sub(i)),2)-Math.pow(r.sub(i).distance(),2)+Math.pow(this.radius,2));if(n<0)return null;var s=0;if(0===n)return(s=-o.dot(r.sub(i)))>0&&s<e?t.getPoint(s):null;var a=-o.dot(r.sub(i))+n,h=-o.dot(r.sub(i))-n,l=Math.min(a,h);return l<=e?t.getPoint(l):null},t.prototype.collide=function(e){if(e instanceof t)return n.CollisionJumpTable.CollideCircleCircle(this,e);if(e instanceof o.PolygonArea)return n.CollisionJumpTable.CollideCirclePolygon(this,e);if(e instanceof r.EdgeArea)return n.CollisionJumpTable.CollideCircleEdge(this,e);throw new Error("Circle could not collide with unknown ICollisionArea "+typeof e)},t.prototype.getFurthestPoint=function(t){return this.getCenter().add(t.normalize().scale(this.radius))},t.prototype.getBounds=function(){return new i.BoundingBox(this.pos.x+this.body.pos.x-this.radius,this.pos.y+this.body.pos.y-this.radius,this.pos.x+this.body.pos.x+this.radius,this.pos.y+this.body.pos.y+this.radius)},t.prototype.getAxes=function(){return null},t.prototype.getMomentOfInertia=function(){return(this.body?this.body.mass:a.Physics.defaultMass)*this.radius*this.radius/2},t.prototype.testSeparatingAxisTheorem=function(t){var e=t.getAxes(),i=t.getCenter(),o=t.getFurthestPoint(this.pos.sub(i));e.push(this.pos.sub(o).normalize());for(var r=Number.MAX_VALUE,n=null,s=-1,a=0;a<e.length;a++){var h=t.project(e[a]),l=this.project(e[a]),c=h.getOverlap(l);if(c<=0)return null;c<r&&(r=c,n=e[a],s=a)}return s<0?null:n.normalize().scale(r)},t.prototype.recalc=function(){},t.prototype.project=function(t){var e=[],i=this.getCenter().dot(t);return e.push(i),e.push(i+this.radius),e.push(i-this.radius),new s.Projection(Math.min.apply(Math,e),Math.max.apply(Math,e))},t.prototype.debugDraw=function(t,e){void 0===e&&(e=h.Color.Green.clone());var i=this.body?this.body.pos.add(this.pos):this.pos,o=this.body?this.body.rotation:0;t.beginPath(),t.strokeStyle=e.toString(),t.arc(i.x,i.y,this.radius,0,2*Math.PI),t.closePath(),t.stroke(),t.beginPath(),t.moveTo(i.x,i.y),t.lineTo(Math.cos(o)*this.radius+i.x,Math.sin(o)*this.radius+i.y),t.closePath(),t.stroke()},t}();e.CircleArea=l}),i("Collision/CollisionJumpTable",["require","exports","Collision/CollisionContact","Collision/PolygonArea"],function(t,e,i,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CollisionJumpTable={CollideCircleCircle:function(t,e){var o=t.radius+e.radius,r=t.body.pos.add(t.pos),n=e.body.pos.add(e.pos);if(r.distance(n)>o)return null;var s=n.sub(r).normalize(),a=s.scale(o-n.distance(r)),h=t.getFurthestPoint(s);return new i.CollisionContact(t,e,a,h,s)},CollideCirclePolygon:function(t,e){var o=t.testSeparatingAxisTheorem(e);if(!o)return null;o=o.dot(e.getCenter().sub(t.getCenter()))<0?o.negate():o;var r=[],n=e.getFurthestPoint(o.negate()),s=t.getFurthestPoint(o);return t.contains(n)&&r.push(n),e.contains(s)&&r.push(s),0===r.length?null:new i.CollisionContact(t,e,o,2===r.length?r[0].average(r[1]):r[0],o.normalize())},CollideCircleEdge:function(t,e){var o=t.getCenter(),r=e.end.sub(e.begin),n=r.dot(e.end.sub(o)),s=r.dot(o.sub(e.begin));if(s<=0){var a=e.begin.sub(o),h=a.dot(a);return h>t.radius*t.radius?null:new i.CollisionContact(t,e,a.normalize().scale(t.radius-Math.sqrt(h)),e.begin,a.normalize())}if(n<=0){var l=e.end.sub(o),c=l.dot(l);return c>t.radius*t.radius?null:new i.CollisionContact(t,e,l.normalize().scale(t.radius-Math.sqrt(c)),e.end,l.normalize())}var u=r.dot(r),p=e.begin.scale(n).add(e.end.scale(s)).scale(1/u),d=o.sub(p),f=d.dot(d);if(f>t.radius*t.radius)return null;var g=r.perpendicular();g.dot(o.sub(e.begin))<0&&(g.x=-g.x,g.y=-g.y);var y=(g=g.normalize()).scale(Math.abs(t.radius-Math.sqrt(f)));return new i.CollisionContact(t,e,y.negate(),p,g.negate())},CollideEdgeEdge:function(){return null},CollidePolygonEdge:function(t,e){var r=e.end.sub(e.begin).normal();if(t.contains(e.begin)){var n=t.getClosestFace(e.begin),s=n.distance,a=n.face;if(s)return new i.CollisionContact(t,e,s.negate(),e.begin.add(s.negate()),a.normal().negate())}if(t.contains(e.end)){var h=t.getClosestFace(e.end);if(s=h.distance,a=h.face,s)return new i.CollisionContact(t,e,s.negate(),e.end.add(s.negate()),a.normal().negate())}var l=t.getCenter(),c=e.getCenter().sub(l).normalize(),u=new o.PolygonArea({points:[e.begin,e.end,e.end.add(c.scale(30)),e.begin.add(c.scale(30))]}),p=t.testSeparatingAxisTheorem(u);return p?(r=r.dot(c)<0?r.negate():r,p=p.dot(c)<0?p.negate():p,new i.CollisionContact(t,e,p,t.getFurthestPoint(r),r)):null},CollidePolygonPolygon:function(t,e){var o=t.testSeparatingAxisTheorem(e);if(!o)return null;o=o.dot(e.getCenter().sub(t.getCenter()))<0?o.negate():o;var r=[],n=t.getFurthestPoint(o),s=e.getFurthestPoint(o.negate());e.contains(n)&&r.push(n),t.contains(s)&&r.push(s),0===r.length&&r.push(s);var a=2===r.length?r[0].add(r[1]).scale(.5):r[0];return new i.CollisionContact(t,e,o,a,o.normalize())}}}),i("Collision/PolygonArea",["require","exports","Drawing/Color","Physics","Collision/BoundingBox","Collision/EdgeArea","Collision/CollisionJumpTable","Collision/CircleArea","Algebra"],function(t,e,i,o,r,n,s,a,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(t){this._transformedPoints=[],this._axes=[],this._sides=[],this.pos=t.pos||h.Vector.Zero.clone();var e=!!t.clockwiseWinding;this.points=(e?t.points.reverse():t.points)||[],this.body=t.body||null,this._calculateTransformation()}return t.prototype.getCenter=function(){return this.body?this.body.pos.add(this.pos):this.pos},t.prototype._calculateTransformation=function(){var t=this.body?this.body.pos.add(this.pos):this.pos,e=this.body?this.body.rotation:0,i=this.points.length;this._transformedPoints.length=0;for(var o=0;o<i;o++)this._transformedPoints[o]=this.points[o].rotate(e).add(t)},t.prototype.getTransformedPoints=function(){return this._transformedPoints.length||this._calculateTransformation(),this._transformedPoints},t.prototype.getSides=function(){if(this._sides.length)return this._sides;for(var t=[],e=this.getTransformedPoints(),i=e.length,o=0;o<i;o++)t.push(new h.Line(e[o],e[(o-1+i)%i]));return this._sides=t,this._sides},t.prototype.recalc=function(){this._sides.length=0,this._axes.length=0,this._transformedPoints.length=0,this.getTransformedPoints(),this.getAxes(),this.getSides()},t.prototype.contains=function(t){var e=new h.Ray(t,new h.Vector(1,0));return this.getSides().reduce(function(t,i){return e.intersect(i)>=0?t+1:t},0)%2!=0},t.prototype.collide=function(e){if(e instanceof a.CircleArea)return s.CollisionJumpTable.CollideCirclePolygon(e,this);if(e instanceof t)return s.CollisionJumpTable.CollidePolygonPolygon(this,e);if(e instanceof n.EdgeArea)return s.CollisionJumpTable.CollidePolygonEdge(this,e);throw new Error("Polygon could not collide with unknown ICollisionArea "+typeof e)},t.prototype.getFurthestPoint=function(t){for(var e=this.getTransformedPoints(),i=null,o=-Number.MAX_VALUE,r=0;r<e.length;r++){var n=t.dot(e[r]);n>o&&(o=n,i=e[r])}return i},t.prototype.getClosestFace=function(t){for(var e=this.getSides(),i=Number.POSITIVE_INFINITY,o=-1,r=-1,n=0;n<e.length;n++){var s=e[n].distanceToPoint(t);s<i&&(i=s,o=n,r=s)}return-1!==o?{distance:e[o].normal().scale(r),face:e[o]}:null},t.prototype.getBounds=function(){var t=this.getTransformedPoints(),e=t.reduce(function(t,e){return Math.min(t,e.x)},999999999),i=t.reduce(function(t,e){return Math.max(t,e.x)},-99999999),o=t.reduce(function(t,e){return Math.min(t,e.y)},9999999999),n=t.reduce(function(t,e){return Math.max(t,e.y)},-9999999999);return new r.BoundingBox(e,o,i,n)},t.prototype.getMomentOfInertia=function(){for(var t=this.body?this.body.mass:o.Physics.defaultMass,e=0,i=0,r=0;r<this.points.length;r++){var n=(r+1)%this.points.length,s=this.points[n].cross(this.points[r]);e+=s*(this.points[r].dot(this.points[r])+this.points[r].dot(this.points[n])+this.points[n].dot(this.points[n])),i+=s}return t/6*(e/i)},t.prototype.rayCast=function(t,e){void 0===e&&(e=1/0);for(var i=this.getSides(),o=i.length,r=Number.MAX_VALUE,n=-1,s=0;s<o;s++){var a=t.intersect(i[s]);a>=0&&a<r&&a<=e&&(r=a,n=s)}return n>=0?t.getPoint(r):null},t.prototype.getAxes=function(){if(this._axes.length)return this._axes;for(var t=[],e=this.getTransformedPoints(),i=e.length,o=0;o<i;o++)t.push(e[o].sub(e[(o+1)%i]).normal());return this._axes=t,this._axes},t.prototype.testSeparatingAxisTheorem=function(t){for(var e=t,i=this.getAxes().concat(e.getAxes()),o=Number.MAX_VALUE,r=null,n=-1,s=0;s<i.length;s++){var a=this.project(i[s]),h=e.project(i[s]),l=a.getOverlap(h);if(l<=0)return null;l<o&&(o=l,r=i[s],n=s)}return-1===n?null:r.normalize().scale(o)},t.prototype.project=function(t){for(var e=this.getTransformedPoints(),i=e.length,o=Number.MAX_VALUE,r=-Number.MAX_VALUE,n=0;n<i;n++){var s=e[n].dot(t);o=Math.min(o,s),r=Math.max(r,s)}return new h.Projection(o,r)},t.prototype.debugDraw=function(t,e){void 0===e&&(e=i.Color.Red.clone()),t.beginPath(),t.strokeStyle=e.toString();var o=this.getTransformedPoints()[0];t.moveTo(o.x,o.y),this.getTransformedPoints().forEach(function(e){t.lineTo(e.x,e.y)}),t.lineTo(o.x,o.y),t.closePath(),t.stroke()},t}();e.PolygonArea=l}),i("Collision/BoundingBox",["require","exports","Collision/PolygonArea","Algebra","Drawing/Color"],function(t,e,i,o,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,i,o){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===o&&(o=0),this.left=t,this.top=e,this.right=i,this.bottom=o}return t.fromPoints=function(e){for(var i=1/0,o=1/0,r=-1/0,n=-1/0,s=0;s<e.length;s++)e[s].x<i&&(i=e[s].x),e[s].x>r&&(r=e[s].x),e[s].y<o&&(o=e[s].y),e[s].y>n&&(n=e[s].y);return new t(i,o,r,n)},t.prototype.getWidth=function(){return this.right-this.left},t.prototype.getHeight=function(){return this.bottom-this.top},t.prototype.rotate=function(e,i){void 0===i&&(i=o.Vector.Zero.clone());var r=this.getPoints().map(function(t){return t.rotate(e,i)});return t.fromPoints(r)},t.prototype.getPerimeter=function(){return 2*(this.getWidth()+this.getHeight())},t.prototype.getPoints=function(){var t=[];return t.push(new o.Vector(this.left,this.top)),t.push(new o.Vector(this.right,this.top)),t.push(new o.Vector(this.right,this.bottom)),t.push(new o.Vector(this.left,this.bottom)),t},t.prototype.toPolygon=function(t){return new i.PolygonArea({body:t?t.body:null,points:this.getPoints(),pos:o.Vector.Zero.clone()})},t.prototype.rayCast=function(t,e){void 0===e&&(e=1/0);var i=-1/0,o=1/0,r=0===t.dir.x?Number.MAX_VALUE:1/t.dir.x,n=0===t.dir.y?Number.MAX_VALUE:1/t.dir.y,s=(this.left-t.pos.x)*r,a=(this.right-t.pos.x)*r;i=Math.min(s,a),o=Math.max(s,a);var h=(this.top-t.pos.y)*n,l=(this.bottom-t.pos.y)*n;return i=Math.max(i,Math.min(h,l)),(o=Math.min(o,Math.max(h,l)))>=Math.max(0,i)&&i<e},t.prototype.rayCastTime=function(t,e){void 0===e&&(e=1/0);var i=-1/0,o=1/0,r=0===t.dir.x?Number.MAX_VALUE:1/t.dir.x,n=0===t.dir.y?Number.MAX_VALUE:1/t.dir.y,s=(this.left-t.pos.x)*r,a=(this.right-t.pos.x)*r;i=Math.min(s,a),o=Math.max(s,a);var h=(this.top-t.pos.y)*n,l=(this.bottom-t.pos.y)*n;return i=Math.max(i,Math.min(h,l)),(o=Math.min(o,Math.max(h,l)))>=Math.max(0,i)&&i<e?i:-1},t.prototype.contains=function(e){return e instanceof o.Vector?this.left<=e.x&&this.top<=e.y&&this.bottom>=e.y&&this.right>=e.x:e instanceof t&&this.left<e.left&&this.top<e.top&&e.bottom<this.bottom&&e.right<this.right},t.prototype.combine=function(e){return new t(Math.min(this.left,e.left),Math.min(this.top,e.top),Math.max(this.right,e.right),Math.max(this.bottom,e.bottom))},t.prototype.collides=function(e){if(e instanceof t){var i=e,r=this.combine(i);if(r.getWidth()<i.getWidth()+this.getWidth()&&r.getHeight()<i.getHeight()+this.getHeight()){var n=0;n=this.right>=i.left&&this.right<=i.right?i.left-this.right:i.right-this.left;var s=0;return s=this.top<=i.bottom&&this.top>=i.top?i.bottom-this.top:i.top-this.bottom,Math.abs(n)<Math.abs(s)?new o.Vector(n,0):new o.Vector(0,s)}return null}return null},t.prototype.debugDraw=function(t,e){void 0===e&&(e=r.Color.Yellow),t.strokeStyle=e.toString(),t.strokeRect(this.left,this.top,this.getWidth(),this.getHeight())},t}();e.BoundingBox=n}),i("Collision/EdgeArea",["require","exports","Collision/BoundingBox","Collision/CollisionJumpTable","Collision/CircleArea","Collision/PolygonArea","Algebra","Physics","Drawing/Color"],function(t,e,i,o,r,n,s,a,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(t){this.begin=t.begin||s.Vector.Zero.clone(),this.end=t.end||s.Vector.Zero.clone(),this.body=t.body||null,this.pos=this.getCenter()}return t.prototype.getCenter=function(){return this.begin.average(this.end).add(this._getBodyPos())},t.prototype._getBodyPos=function(){var t=s.Vector.Zero.clone();return this.body.pos&&(t=this.body.pos),t},t.prototype._getTransformedBegin=function(){var t=this.body?this.body.rotation:0;return this.begin.rotate(t).add(this._getBodyPos())},t.prototype._getTransformedEnd=function(){var t=this.body?this.body.rotation:0;return this.end.rotate(t).add(this._getBodyPos())},t.prototype.getSlope=function(){var t=this._getTransformedBegin(),e=this._getTransformedEnd(),i=t.distance(e);return e.sub(t).scale(1/i)},t.prototype.getLength=function(){var t=this._getTransformedBegin(),e=this._getTransformedEnd();return t.distance(e)},t.prototype.contains=function(){return!1},t.prototype.rayCast=function(t,e){void 0===e&&(e=1/0);var i=this._getTransformedBegin().sub(t.pos);if(0===t.dir.cross(this.getSlope())&&0!==i.cross(t.dir))return null;var o=t.dir.cross(this.getSlope());if(0===o)return null;var r=i.cross(this.getSlope())/o;if(r>=0&&r<=e){var n=i.cross(t.dir)/o/this.getLength();if(n>=0&&n<=1)return t.getPoint(r)}return null},t.prototype.collide=function(e){if(e instanceof r.CircleArea)return o.CollisionJumpTable.CollideCircleEdge(e,this);if(e instanceof n.PolygonArea)return o.CollisionJumpTable.CollidePolygonEdge(e,this);if(e instanceof t)return o.CollisionJumpTable.CollideEdgeEdge();throw new Error("Edge could not collide with unknown ICollisionArea "+typeof e)},t.prototype.getFurthestPoint=function(t){var e=this._getTransformedBegin(),i=this._getTransformedEnd();return t.dot(e)>0?e:i},t.prototype.getBounds=function(){var t=this._getTransformedBegin(),e=this._getTransformedEnd();return new i.BoundingBox(Math.min(t.x,e.x),Math.min(t.y,e.y),Math.max(t.x,e.x),Math.max(t.y,e.y))},t.prototype.getAxes=function(){var t=this._getTransformedEnd().sub(this._getTransformedBegin()).normal(),e=[];return e.push(t),e.push(t.negate()),e.push(t.normal()),e.push(t.normal().negate()),e},t.prototype.getMomentOfInertia=function(){var t=this.body?this.body.mass:a.Physics.defaultMass,e=this.end.sub(this.begin).distance()/2;return t*e*e},t.prototype.recalc=function(){},t.prototype.project=function(t){for(var e=[],i=[this._getTransformedBegin(),this._getTransformedEnd()],o=i.length,r=0;r<o;r++)e.push(i[r].dot(t));return new s.Projection(Math.min.apply(Math,e),Math.max.apply(Math,e))},t.prototype.debugDraw=function(t,e){void 0===e&&(e=h.Color.Red.clone()),t.strokeStyle=e.toString(),t.beginPath(),t.moveTo(this.begin.x,this.begin.y),t.lineTo(this.end.x,this.end.y),t.closePath(),t.stroke()},t}();e.EdgeArea=l}),i("Util/DrawUtil",["require","exports","Drawing/Color"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.line=function(t,e,o,r,n,s,a,h){void 0===e&&(e=i.Color.Red.clone()),void 0===a&&(a=1),void 0===h&&(h="butt"),t.beginPath(),t.lineWidth=a,t.lineCap=h,t.strokeStyle=e.toString(),t.moveTo(o,r),t.lineTo(n,s),t.closePath(),t.stroke()},e.point=function(t,e,o){void 0===e&&(e=i.Color.Red.clone()),t.beginPath(),t.strokeStyle=e.toString(),t.arc(o.x,o.y,5,0,2*Math.PI),t.closePath(),t.stroke()},e.vector=function(t,e,i,o,r){void 0===r&&(r=1);var n=e?e.toString():"blue",s=o.scale(r);t.beginPath(),t.strokeStyle=n,t.moveTo(i.x,i.y),t.lineTo(i.x+s.x,i.y+s.y),t.closePath(),t.stroke()},e.roundRect=function(t,e,o,r,n,s,a,h){var l;if(void 0===s&&(s=5),void 0===a&&(a=i.Color.White),void 0===h&&(h=null),"number"==typeof s)l={tl:s,tr:s,br:s,bl:s};else{var c={tl:0,tr:0,br:0,bl:0};for(var u in c)if(c.hasOwnProperty(u)){var p=u;l[p]=s[p]||c[p]}}t.beginPath(),t.moveTo(e+l.tl,o),t.lineTo(e+r-l.tr,o),t.quadraticCurveTo(e+r,o,e+r,o+l.tr),t.lineTo(e+r,o+n-l.br),t.quadraticCurveTo(e+r,o+n,e+r-l.br,o+n),t.lineTo(e+l.bl,o+n),t.quadraticCurveTo(e,o+n,e,o+n-l.bl),t.lineTo(e,o+l.tl),t.quadraticCurveTo(e,o,e+l.tl,o),t.closePath(),h&&(t.fillStyle=h.toString(),t.fill()),a&&(t.strokeStyle=a.toString(),t.stroke())},e.circle=function(t,e,o,r,n,s){void 0===n&&(n=i.Color.White),void 0===s&&(s=null),t.beginPath(),t.arc(e,o,r,0,2*Math.PI),t.closePath(),s&&(t.fillStyle=s.toString(),t.fill()),n&&(t.strokeStyle=n.toString(),t.stroke())}}),i("Collision/Pair",["require","exports","Physics","Drawing/Color","Actor","Util/DrawUtil"],function(t,e,i,o,r,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(e,i){this.bodyA=e,this.bodyB=i,this.id=null,this.collision=null,this.id=t.calculatePairHash(e,i)}return Object.defineProperty(t.prototype,"canCollide",{get:function(){var t=this.bodyA.actor,e=this.bodyB.actor;return(t.collisionType!==r.CollisionType.Fixed||e.collisionType!==r.CollisionType.Fixed)&&e.collisionType!==r.CollisionType.PreventCollision&&!e.isKilled()},enumerable:!0,configurable:!0}),t.prototype.collide=function(){this.collision=this.bodyA.collisionArea.collide(this.bodyB.collisionArea)},t.prototype.resolve=function(t){this.collision&&this.collision.resolve(t)},t.calculatePairHash=function(t,e){return t.actor.id<e.actor.id?"#"+t.actor.id+"+"+e.actor.id:"#"+e.actor.id+"+"+t.actor.id},t.prototype.debugDraw=function(t){this.collision&&(i.Physics.showContacts&&n.point(t,o.Color.Red,this.collision.point),i.Physics.showCollisionNormals&&n.vector(t,o.Color.Cyan,this.collision.point,this.collision.normal,30))},t}();e.Pair=s}),i("Collision/Body",["require","exports","Physics","Collision/EdgeArea","Collision/CircleArea","Collision/PolygonArea","Collision/Pair","Algebra","Drawing/Color","Util/DrawUtil"],function(t,e,i,o,r,n,s,a,h,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(){function t(t){this.actor=t,this.collisionArea=null,this.pos=new a.Vector(0,0),this.oldPos=new a.Vector(0,0),this.vel=new a.Vector(0,0),this.oldVel=new a.Vector(0,0),this.acc=new a.Vector(0,0),this.torque=0,this.mass=1,this.moi=1e3,this.motion=10,this.friction=.99,this.restitution=.2,this.rotation=0,this.rx=0,this._totalMtv=a.Vector.Zero.clone()}return t.prototype.addMtv=function(t){this._totalMtv.addEqual(t)},t.prototype.applyMtv=function(){this.pos.addEqual(this._totalMtv),this._totalMtv.setTo(0,0)},t.prototype.getBounds=function(){return i.Physics.collisionResolutionStrategy===i.CollisionResolutionStrategy.Box?this.actor.getBounds():this.collisionArea.getBounds()},t.prototype.getRelativeBounds=function(){return i.Physics.collisionResolutionStrategy,i.CollisionResolutionStrategy.Box,this.actor.getRelativeBounds()},t.prototype.update=function(){this.collisionArea&&this.collisionArea.recalc()},t.prototype.useBoxCollision=function(t){void 0===t&&(t=a.Vector.Zero.clone()),this.collisionArea=new n.PolygonArea({body:this,points:this.actor.getRelativeBounds().getPoints(),pos:t}),this.moi=this.collisionArea.getMomentOfInertia()||this.moi},t.prototype.usePolygonCollision=function(t,e){void 0===e&&(e=a.Vector.Zero.clone()),this.collisionArea=new n.PolygonArea({body:this,points:t,pos:e}),this.moi=this.collisionArea.getMomentOfInertia()||this.moi},t.prototype.useCircleCollision=function(t,e){void 0===e&&(e=a.Vector.Zero.clone()),t||(t=this.actor.getWidth()/2),this.collisionArea=new r.CircleArea({body:this,radius:t,pos:e}),this.moi=this.collisionArea.getMomentOfInertia()||this.moi},t.prototype.useEdgeCollision=function(t,e){this.collisionArea=new o.EdgeArea({begin:t,end:e,body:this}),this.moi=this.collisionArea.getMomentOfInertia()||this.moi},t.prototype.debugDraw=function(t){i.Physics.showMotionVectors&&(l.vector(t,h.Color.Yellow,this.pos,this.acc.add(i.Physics.acc)),l.vector(t,h.Color.Red,this.pos,this.vel),l.point(t,h.Color.Red,this.pos)),i.Physics.showBounds&&this.getBounds().debugDraw(t,h.Color.Yellow),i.Physics.showArea&&this.collisionArea.debugDraw(t,h.Color.Green)},t.prototype.touching=function(t){var e=new s.Pair(this,t.body);return e.collide(),!!e.collision},t}();e.Body=c}),i("DebugFlags",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}),i("Debug",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){this.stats={currFrame:new o,prevFrame:new o}};e.Debug=i;var o=function(){function t(){this._id=0,this._delta=0,this._fps=0,this._actorStats={alive:0,killed:0,ui:0,get remaining(){return this.alive-this.killed},get total(){return this.remaining+this.ui}},this._durationStats={update:0,draw:0,get total(){return this.update+this.draw}},this._physicsStats=new r}return t.prototype.reset=function(t){t?(this.id=t.id,this.delta=t.delta,this.fps=t.fps,this.actors.alive=t.actors.alive,this.actors.killed=t.actors.killed,this.actors.ui=t.actors.ui,this.duration.update=t.duration.update,this.duration.draw=t.duration.draw,this._physicsStats.reset(t.physics)):(this.id=this.delta=this.fps=0,this.actors.alive=this.actors.killed=this.actors.ui=0,this.duration.update=this.duration.draw=0,this._physicsStats.reset())},t.prototype.clone=function(){var e=new t;return e.reset(this),e},Object.defineProperty(t.prototype,"id",{get:function(){return this._id},set:function(t){this._id=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"delta",{get:function(){return this._delta},set:function(t){this._delta=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fps",{get:function(){return this._fps},set:function(t){this._fps=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"actors",{get:function(){return this._actorStats},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){return this._durationStats},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"physics",{get:function(){return this._physicsStats},enumerable:!0,configurable:!0}),t}();e.FrameStats=o;var r=function(){function t(){this._pairs=0,this._collisions=0,this._collidersHash={},this._fastBodies=0,this._fastBodyCollisions=0,this._broadphase=0,this._narrowphase=0}return t.prototype.reset=function(t){t?(this.pairs=t.pairs,this.collisions=t.collisions,this.collidersHash=t.collidersHash,this.fastBodies=t.fastBodies,this.fastBodyCollisions=t.fastBodyCollisions,this.broadphase=t.broadphase,this.narrowphase=t.narrowphase):(this.pairs=this.collisions=this.fastBodies=0,this.fastBodyCollisions=this.broadphase=this.narrowphase=0,this.collidersHash={})},t.prototype.clone=function(){var e=new t;return e.reset(this),e},Object.defineProperty(t.prototype,"pairs",{get:function(){return this._pairs},set:function(t){this._pairs=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"collisions",{get:function(){return this._collisions},set:function(t){this._collisions=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"collidersHash",{get:function(){return this._collidersHash},set:function(t){this._collidersHash=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fastBodies",{get:function(){return this._fastBodies},set:function(t){this._fastBodies=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fastBodyCollisions",{get:function(){return this._fastBodyCollisions},set:function(t){this._fastBodyCollisions=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"broadphase",{get:function(){return this._broadphase},set:function(t){this._broadphase=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"narrowphase",{get:function(){return this._narrowphase},set:function(t){this._narrowphase=t},enumerable:!0,configurable:!0}),t}();e.PhysicsStats=r}),i("Collision/ICollisionResolver",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}),i("Collision/DynamicTree",["require","exports","Physics","Collision/BoundingBox","Util/Log"],function(t,e,i,o,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.parent=t,this.parent=t||null,this.body=null,this.bounds=new o.BoundingBox,this.left=null,this.right=null,this.height=0}return t.prototype.isLeaf=function(){return!this.left&&!this.right},t}();e.TreeNode=n;var s=function(){function t(t){void 0===t&&(t=new o.BoundingBox(-Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)),this.worldBounds=t,this.root=null,this.nodes={}}return t.prototype._insert=function(t){if(null===this.root)return this.root=t,void(this.root.parent=null);for(var e=t.bounds,i=this.root;!i.isLeaf();){var o,r=i.left,s=i.right,a=i.bounds.getPerimeter(),h=i.bounds.combine(e).getPerimeter(),l=2*h,c=2*(h-a),u=0,p=e.combine(r.bounds);r.isLeaf()?u=p.getPerimeter()+c:(o=r.bounds.getPerimeter(),u=p.getPerimeter()-o+c);var d=0,f=e.combine(s.bounds);if(s.isLeaf()?d=f.getPerimeter()+c:(o=s.bounds.getPerimeter(),d=f.getPerimeter()-o+c),l<u&&l<d)break;i=u<d?r:s}var g=i.parent,y=new n(g);y.bounds=e.combine(i.bounds),y.height=i.height+1,null!==g?(g.left===i?g.left=y:g.right=y,y.left=i,y.right=t,i.parent=y,t.parent=y):(y.left=i,y.right=t,i.parent=y,t.parent=y,this.root=y);for(var _=t.parent;_;){if(!(_=this._balance(_)).left)throw new Error("Parent of current leaf cannot have a null left child"+_);if(!_.right)throw new Error("Parent of current leaf cannot have a null right child"+_);_.height=1+Math.max(_.left.height,_.right.height),_.bounds=_.left.bounds.combine(_.right.bounds),_=_.parent}},t.prototype._remove=function(t){if(t!==this.root){var e,i=t.parent,o=i.parent;if(e=i.left===t?i.right:i.left,o){o.left===i?o.left=e:o.right=e,e.parent=o;for(var r=o;r;)(r=this._balance(r)).bounds=r.left.bounds.combine(r.right.bounds),r.height=1+Math.max(r.left.height,r.right.height),r=r.parent}else this.root=e,e.parent=null}else this.root=null},t.prototype.trackBody=function(t){var e=new n;e.body=t,e.bounds=t.getBounds(),e.bounds.left-=2,e.bounds.top-=2,e.bounds.right+=2,e.bounds.bottom+=2,this.nodes[t.actor.id]=e,this._insert(e)},t.prototype.updateBody=function(t){var e=this.nodes[t.actor.id];if(!e)return!1;var o=t.getBounds();if(!this.worldBounds.contains(o))return r.Logger.getInstance().warn("Actor with id "+t.actor.id+" is outside the world bounds and will no longer be tracked for physics"),this.untrackBody(t),!1;if(e.bounds.contains(o))return!1;this._remove(e),o.left-=i.Physics.boundsPadding,o.top-=i.Physics.boundsPadding,o.right+=i.Physics.boundsPadding,o.bottom+=i.Physics.boundsPadding;var n=t.vel.x*i.Physics.dynamicTreeVelocityMultiplyer,s=t.vel.y*i.Physics.dynamicTreeVelocityMultiplyer;return n<0?o.left+=n:o.right+=n,s<0?o.top+=s:o.bottom+=s,e.bounds=o,this._insert(e),!0},t.prototype.untrackBody=function(t){var e=this.nodes[t.actor.id];e&&(this._remove(e),this.nodes[t.actor.id]=null,delete this.nodes[t.actor.id])},t.prototype._balance=function(t){if(null===t)throw new Error("Cannot balance at null node");if(t.isLeaf()||t.height<2)return t;var e=t.left,i=t.right,o=t,r=e,n=i,s=e.left,a=e.right,h=i.left,l=i.right,c=n.height-r.height;if(c>1)return n.left=o,n.parent=o.parent,o.parent=n,n.parent?n.parent.left===o?n.parent.left=n:n.parent.right=n:this.root=n,h.height>l.height?(n.right=h,o.right=l,l.parent=o,o.bounds=r.bounds.combine(l.bounds),n.bounds=o.bounds.combine(h.bounds),o.height=1+Math.max(r.height,l.height),n.height=1+Math.max(o.height,h.height)):(n.right=l,o.right=h,h.parent=o,o.bounds=r.bounds.combine(h.bounds),n.bounds=o.bounds.combine(l.bounds),o.height=1+Math.max(r.height,h.height),n.height=1+Math.max(o.height,l.height)),n;if(c<-1){if(r.left=o,r.parent=o.parent,o.parent=r,r.parent)if(r.parent.left===o)r.parent.left=r;else{if(r.parent.right!==o)throw"Error rotating Dynamic Tree";r.parent.right=r}else this.root=r;return s.height>a.height?(r.right=s,o.left=a,a.parent=o,o.bounds=n.bounds.combine(a.bounds),r.bounds=o.bounds.combine(s.bounds),o.height=1+Math.max(n.height,a.height),r.height=1+Math.max(o.height,s.height)):(r.right=a,o.left=s,s.parent=o,o.bounds=n.bounds.combine(s.bounds),r.bounds=o.bounds.combine(a.bounds),o.height=1+Math.max(n.height,s.height),r.height=1+Math.max(o.height,a.height)),r}return t},t.prototype.getHeight=function(){return null===this.root?0:this.root.height},t.prototype.query=function(t,e){var i=t.getBounds(),o=function(r){if(r&&r.bounds.collides(i)){if(!r.isLeaf()||r.body===t)return o(r.left)||o(r.right);if(e.call(t,r.body))return!0}return!1};o(this.root)},t.prototype.rayCastQuery=function(t,e,i){void 0===e&&(e=1/0);var o=function(r){if(r&&r.bounds.rayCast(t,e)){if(!r.isLeaf())return o(r.left)||o(r.right);if(i.call(t,r.body))return!0}return!1};o(this.root)},t.prototype.getNodes=function(){var t=function(e){return e?[e].concat(t(e.left),t(e.right)):[]};return t(this.root)},t.prototype.debugDraw=function(t){var e=function(i){i&&(i.isLeaf()?(t.lineWidth=1,t.strokeStyle="green"):(t.lineWidth=1,t.strokeStyle="white"),i.bounds.debugDraw(t),i.left&&e(i.left),i.right&&e(i.right))};e(this.root)},t}();e.DynamicTree=s}),i("Collision/DynamicTreeCollisionBroadphase",["require","exports","Physics","Collision/DynamicTree","Collision/Pair","Algebra","Actor","Util/Log","Events"],function(t,e,i,o,r,n,s,a,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(){this._dynamicCollisionTree=new o.DynamicTree,this._collisionHash={},this._collisionPairCache=[],this._lastFramePairs=[],this._lastFramePairsHash={}}return t.prototype.track=function(t){t?this._dynamicCollisionTree.trackBody(t):a.Logger.getInstance().warn("Cannot track null physics body")},t.prototype.untrack=function(t){t?this._dynamicCollisionTree.untrackBody(t):a.Logger.getInstance().warn("Cannot untrack a null physics body")},t.prototype._canCollide=function(t,e){var i=r.Pair.calculatePairHash(t.body,e.body);return!(this._collisionHash[i]||t.collisionType===s.CollisionType.Fixed&&e.collisionType===s.CollisionType.Fixed||e.collisionType===s.CollisionType.PreventCollision||e.isKilled())},t.prototype.broadphase=function(t,e,o){var a=this,h=e/1e3,l=t.filter(function(t){return!t.isKilled()&&t.collisionType!==s.CollisionType.PreventCollision});this._collisionPairCache=[],this._collisionHash={};for(var c=0,u=l.length;c<u;c++)f=l[c],this._dynamicCollisionTree.query(f.body,function(t){if(a._canCollide(f,t.actor)){var e=new r.Pair(f.body,t);a._collisionHash[e.id]=!0,a._collisionPairCache.push(e)}return!1});if(o&&(o.physics.pairs=this._collisionPairCache.length),i.Physics.checkForFastBodies)for(var p=0,d=l;p<d.length;p++){var f;if((f=d[p]).collisionType===s.CollisionType.Active){var g=f.vel.magnitude()*h+.5*f.acc.magnitude()*h*h,y=Math.min(f.body.getBounds().getHeight(),f.body.getBounds().getWidth());if(i.Physics.disableMinimumSpeedForFastBody||g>y/2){o&&o.physics.fastBodies++;var _,v=f.pos.sub(f.oldPos),m=f.body.collisionArea.getCenter(),b=f.body.collisionArea.getFurthestPoint(f.vel),w=b.sub(v),x=new n.Ray(w,f.vel);x.pos=x.pos.add(x.dir.scale(-2*i.Physics.surfaceEpsilon));var P=new n.Vector(1/0,1/0);if(this._dynamicCollisionTree.rayCastQuery(x,g+2*i.Physics.surfaceEpsilon,function(t){if(f.body!==t&&t.collisionArea){var e=t.collisionArea.rayCast(x,g+10*i.Physics.surfaceEpsilon);if(e){var o=e.sub(w);o.magnitude()<P.magnitude()&&(P=o,_=t)}}return!1}),_&&n.Vector.isValid(P)){var C=new r.Pair(f.body,_);this._collisionHash[C.id]||(this._collisionHash[C.id]=!0,this._collisionPairCache.push(C));var S=m.sub(b);f.pos=w.add(S).add(P).add(x.dir.scale(2*i.Physics.surfaceEpsilon)),f.body.collisionArea.recalc(),o&&o.physics.fastBodyCollisions++}}}}return this._collisionPairCache},t.prototype.narrowphase=function(t,e){for(var i=0;i<t.length;i++)t[i].collide(),e&&t[i].collision&&(e.physics.collisions++,e.physics.collidersHash[t[i].id]=t[i]);return t.filter(function(t){return t.collision})},t.prototype.resolve=function(t,e,o){for(var r=0,n=t;r<n.length;r++){var s=n[r];s.resolve(o),s.collision&&(s.bodyA.applyMtv(),s.bodyB.applyMtv(),s.bodyA.actor.integrate(e*i.Physics.collisionShift),s.bodyB.actor.integrate(e*i.Physics.collisionShift))}return t.filter(function(t){return t.canCollide})},t.prototype.runCollisionStartEnd=function(t){for(var e={},i=0,o=t;i<o.length;i++)if(e[(l=o[i]).id]=l,!this._lastFramePairsHash[l.id]){var r=l.bodyA.actor,n=l.bodyB.actor;r.emit("collisionstart",new h.CollisionStartEvent(r,n,l)),n.emit("collisionstart",new h.CollisionStartEvent(n,r,l))}for(var s=0,a=this._lastFramePairs;s<a.length;s++){var l;e[(l=a[s]).id]||(r=l.bodyA.actor,n=l.bodyB.actor,r.emit("collisionend",new h.CollisionEndEvent(r,n)),n.emit("collisionend",new h.CollisionEndEvent(n,r)))}this._lastFramePairs=t,this._lastFramePairsHash=e},t.prototype.update=function(t){for(var e=0,i=0,o=t.length;i<o;i++)this._dynamicCollisionTree.updateBody(t[i].body)&&e++;return e},t.prototype.debugDraw=function(t){if(i.Physics.broadphaseDebug&&this._dynamicCollisionTree.debugDraw(t),i.Physics.showContacts||i.Physics.showCollisionNormals)for(var e=0,o=this._collisionPairCache;e<o.length;e++)o[e].debugDraw(t)},t}();e.DynamicTreeCollisionBroadphase=l}),i("Util/SortedList",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){this._getComparable=t}return t.prototype.find=function(t){return this._find(this._root,t)},t.prototype._find=function(t,e){return null!=t&&(this._getComparable.call(e)===t.getKey()?t.getData().indexOf(e)>-1:this._getComparable.call(e)<t.getKey()?this._find(t.getLeft(),e):this._find(t.getRight(),e))},t.prototype.get=function(t){return this._get(this._root,t)},t.prototype._get=function(t,e){return null==t?[]:e===t.getKey()?t.getData():e<t.getKey()?this._get(t.getLeft(),e):this._get(t.getRight(),e)},t.prototype.add=function(t){return null==this._root?(this._root=new o(this._getComparable.call(t),[t],null,null),!0):this._insert(this._root,t)},t.prototype._insert=function(t,e){return null!=t&&(this._getComparable.call(e)===t.getKey()?!(t.getData().indexOf(e)>-1||(t.getData().push(e),0)):this._getComparable.call(e)<t.getKey()?null==t.getLeft()?(t.setLeft(new o(this._getComparable.call(e),[e],null,null)),!0):this._insert(t.getLeft(),e):null==t.getRight()?(t.setRight(new o(this._getComparable.call(e),[e],null,null)),!0):this._insert(t.getRight(),e))},t.prototype.removeByComparable=function(t){this._root=this._remove(this._root,t)},t.prototype._remove=function(t,e){if(null==t)return null;if(this._getComparable.call(e)!==t.getKey())return this._getComparable.call(e)<t.getKey()?(t.setLeft(this._remove(t.getLeft(),e)),t):(t.setRight(this._remove(t.getRight(),e)),t);var i=t.getData().indexOf(e);if(i>-1){if(t.getData().splice(i,1),0===t.getData().length){if(null==t.getLeft()&&null==t.getRight())return null;if(null==t.getLeft())return t.getRight();if(null==t.getRight())return t.getLeft();var o=this._findMinNode(t.getRight());return t.setKey(o.getKey()),t.setData(o.getData()),t.setRight(this._cleanup(t.getRight(),o)),t}return t}return null},t.prototype._cleanup=function(t,e){var i=e.getKey();if(null==t)return null;if(i===t.getKey()){if(null==t.getLeft()&&null==t.getRight())return null;if(null==t.getLeft())return t.getRight();if(null==t.getRight())return t.getLeft();var o=this._findMinNode(t.getRight());return t.setKey(o.getKey()),t.setData(o.getData()),t.setRight(this._cleanup(t.getRight(),o)),t}return this._getComparable.call(e)<t.getKey()?(t.setLeft(this._cleanup(t.getLeft(),e)),t):(t.setRight(this._cleanup(t.getRight(),e)),t)},t.prototype._findMinNode=function(t){for(var e=t;null!=e.getLeft();)e=e.getLeft();return e},t.prototype.list=function(){var t=new Array;return this._list(this._root,t),t},t.prototype._list=function(t,e){null!=t&&(this._list(t.getLeft(),e),t.getData().forEach(function(t){e.push(t)}),this._list(t.getRight(),e))},t}();e.SortedList=i;var o=function(){function t(t,e,i,o){this._key=t,this._data=e,this._left=i,this._right=o}return t.prototype.getKey=function(){return this._key},t.prototype.setKey=function(t){this._key=t},t.prototype.getData=function(){return this._data},t.prototype.setData=function(t){this._data=t},t.prototype.getLeft=function(){return this._left},t.prototype.setLeft=function(t){this._left=t},t.prototype.getRight=function(){return this._right},t.prototype.setRight=function(t){this._right=t},t}();e.BinaryTreeNode=o;var r=function(){function t(t){this._key=0,this._key=t}return t.prototype.getTheKey=function(){return this._key},t.prototype.setKey=function(t){this._key=t},t}();e.MockedElement=r}),i("Actions/ActionContext",["require","exports","Actions/Action","Promises","Util/EasingFunctions"],function(t,e,i,o,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){this._actors=[],this._queues=[],null!==arguments&&(this._actors=Array.prototype.slice.call(arguments,0),this._queues=this._actors.map(function(t){return t.actionQueue}))}return t.prototype.clearActions=function(){for(var t=0,e=this._queues.length;t<e;t++)this._queues[t].clearActions()},t.prototype.addActorToContext=function(t){this._actors.push(t),this._queues.push(t.actionQueue)},t.prototype.removeActorFromContext=function(t){var e=this._actors.indexOf(t);e>-1&&(this._actors.splice(e,1),this._queues.splice(e,1))},t.prototype.easeTo=function(t,e,o,n){void 0===n&&(n=r.EasingFunctions.Linear);for(var s=0,a=this._queues.length;s<a;s++)this._queues[s].add(new i.EaseTo(this._actors[s],t,e,o,n));return this},t.prototype.moveTo=function(t,e,o){for(var r=0,n=this._queues.length;r<n;r++)this._queues[r].add(new i.MoveTo(this._actors[r],t,e,o));return this},t.prototype.moveBy=function(t,e,o){for(var r=0,n=this._queues.length;r<n;r++)this._queues[r].add(new i.MoveBy(this._actors[r],t,e,o));return this},t.prototype.rotateTo=function(t,e,o){for(var r=0,n=this._queues.length;r<n;r++)this._queues[r].add(new i.RotateTo(this._actors[r],t,e,o));return this},t.prototype.rotateBy=function(t,e,o){for(var r=0,n=this._queues.length;r<n;r++)this._queues[r].add(new i.RotateBy(this._actors[r],t,e,o));return this},t.prototype.scaleTo=function(t,e,o,r){for(var n=0,s=this._queues.length;n<s;n++)this._queues[n].add(new i.ScaleTo(this._actors[n],t,e,o,r));return this},t.prototype.scaleBy=function(t,e,o){for(var r=0,n=this._queues.length;r<n;r++)this._queues[r].add(new i.ScaleBy(this._actors[r],t,e,o));return this},t.prototype.blink=function(t,e,o){void 0===o&&(o=1);for(var r=0,n=this._queues.length;r<n;r++)this._queues[r].add(new i.Blink(this._actors[r],t,e,o));return this},t.prototype.fade=function(t,e){for(var o=0,r=this._queues.length;o<r;o++)this._queues[o].add(new i.Fade(this._actors[o],t,e));return this},t.prototype.delay=function(t){for(var e=0,o=this._queues.length;e<o;e++)this._queues[e].add(new i.Delay(this._actors[e],t));return this},t.prototype.die=function(){for(var t=0,e=this._queues.length;t<e;t++)this._queues[t].add(new i.Die(this._actors[t]));return this},t.prototype.callMethod=function(t){for(var e=0,o=this._queues.length;e<o;e++)this._queues[e].add(new i.CallMethod(this._actors[e],t));return this},t.prototype.repeat=function(t){if(!t)return this.repeatForever(),this;for(var e=0,o=this._queues.length;e<o;e++)this._queues[e].add(new i.Repeat(this._actors[e],t,this._actors[e].actionQueue.getActions()));return this},t.prototype.repeatForever=function(){for(var t=0,e=this._queues.length;t<e;t++)this._queues[t].add(new i.RepeatForever(this._actors[t],this._actors[t].actionQueue.getActions()));return this},t.prototype.follow=function(t,e){for(var o=0,r=this._queues.length;o<r;o++)void 0===e?this._queues[o].add(new i.Follow(this._actors[o],t)):this._queues[o].add(new i.Follow(this._actors[o],t,e));return this},t.prototype.meet=function(t,e){for(var o=0,r=this._queues.length;o<r;o++)void 0===e?this._queues[o].add(new i.Meet(this._actors[o],t)):this._queues[o].add(new i.Meet(this._actors[o],t,e));return this},t.prototype.asPromise=function(){var t=this,e=this._queues.map(function(e,r){var n=new o.Promise;return e.add(new i.CallMethod(t._actors[r],function(){n.resolve()})),n});return o.Promise.join.apply(this,e)},t}();e.ActionContext=n}),i("Interfaces/IEvented",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}),i("Actions/IActionable",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}),i("EventDispatcher",["require","exports","Events"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t){this._handlers={},this._wiredEventDispatchers=[],this._target=t}return t.prototype.emit=function(t,e){if(t){t=t.toLowerCase();var o,r,n=this._target;if(e||(e=new i.GameEvent),e.target=n,this._handlers[t])for(o=0,r=this._handlers[t].length;o<r;o++)this._handlers[t][o].call(n,e);for(o=0,r=this._wiredEventDispatchers.length;o<r;o++)this._wiredEventDispatchers[o].emit(t,e)}},t.prototype.on=function(t,e){t=t.toLowerCase(),this._handlers[t]||(this._handlers[t]=[]),this._handlers[t].push(e),"unsubscribe"!==t&&"subscribe"!==t&&this.emit("subscribe",new i.SubscribeEvent(t,e))},t.prototype.off=function(t,e){t=t.toLowerCase();var o=this._handlers[t];if(o)if(e){var r=o.indexOf(e);this._handlers[t].splice(r,1)}else this._handlers[t].length=0;"unsubscribe"!==t&&"subscribe"!==t&&this.emit("unsubscribe",new i.UnsubscribeEvent(t,e))},t.prototype.once=function(t,e){var o=this;this.on(t,function(r){var n=r||new i.GameEvent;n.target=n.target||o._target,o.off(t,e),e.call(n.target,n)})},t.prototype.wire=function(t){t._wiredEventDispatchers.push(this)},t.prototype.unwire=function(t){var e=t._wiredEventDispatchers.indexOf(this);e>-1&&t._wiredEventDispatchers.splice(e,1)},t}();e.EventDispatcher=o}),i("Class",["require","exports","EventDispatcher"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(){this.eventDispatcher=new i.EventDispatcher(this)}return t.prototype.on=function(t,e){this.eventDispatcher.on(t,e)},t.prototype.off=function(t,e){this.eventDispatcher.off(t,e)},t.prototype.emit=function(t,e){this.eventDispatcher.emit(t,e)},t.prototype.once=function(t,e){this.eventDispatcher.once(t,e)},t.extend=function(e){var i,o=this;i=e&&e.hasOwnProperty("constructor")?e.constructor:function(){return o.apply(this,arguments)};var r=function(){this.constructor=i};if(r.prototype=o.prototype,i.prototype=new r,e)for(var n in e)e.hasOwnProperty(n)&&(i.prototype[n]=e[n]);return i.extend=t.extend,i},t}();e.Class=o}),i("Group",["require","exports","Algebra","Actions/ActionContext","Actor","Util/Log","Class"],function(t,e,i,o,n,s,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=function(t){function e(e,i){var r=t.call(this)||this;return r.name=e,r.scene=i,r._logger=s.Logger.getInstance(),r._members=[],r.actions=new o.ActionContext,null==i?r._logger.error("Invalid constructor arguments passed to Group: ",e,", scene must not be null!"):(i.groups[e]&&r._logger.warn("Group with name",e,"already exists. This new group will replace it."),i.groups[e]=r),r}return r(e,t),e.prototype.add=function(t){t instanceof n.Actor&&(t=[].concat(t));for(var e=0,i=t.length;e<i;e++)-1===this.getMembers().indexOf(t[e])&&(this._members.push(t[e]),this.scene.add(t[e]),this.actions.addActorToContext(t[e]),this.eventDispatcher.wire(t[e].eventDispatcher))},e.prototype.remove=function(t){var e=this._members.indexOf(t);e>-1&&(this._members.splice(e,1),this.actions.removeActorFromContext(t),this.eventDispatcher.unwire(t.eventDispatcher))},e.prototype.move=function(t){var e=0,o=this.getMembers(),r=o.length;if(1===arguments.length&&t instanceof i.Vector)for(;e<r;e++)o[e].pos.x+=t.x,o[e].pos.y+=t.y;else if("number"==typeof arguments[0]&&"number"==typeof arguments[1])for(var n=arguments[0],s=arguments[1];e<r;e++)o[e].pos.x+=n,o[e].pos.y+=s;else this._logger.error("Invalid arguments passed to group move",this.name,"args:",arguments)},e.prototype.rotate=function(t){if("number"==typeof t)for(var e=0,i=this.getMembers();e<i.length;e++)i[e].rotation+=t;else this._logger.error("Invalid arguments passed to group rotate",this.name,"args:",arguments)},e.prototype.on=function(t,e){this.eventDispatcher.on(t,e)},e.prototype.off=function(t,e){this.eventDispatcher.off(t,e)},e.prototype.emit=function(t,e){this.eventDispatcher.emit(t,e)},e.prototype.contains=function(t){return this.getMembers().indexOf(t)>-1},e.prototype.getMembers=function(){return this._members},e.prototype.getRandomMember=function(){return this._members[Math.floor(Math.random()*this._members.length)]},e.prototype.getBounds=function(){return this.getMembers().map(function(t){return t.getBounds()}).reduce(function(t,e){return t.combine(e)})},e}(a.Class);e.Group=h}),i("Drawing/SpriteEffects",["require","exports","Drawing/Color"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(){}return t.prototype.updatePixel=function(t,e,i){var o=4*(t+e*i.width),r=i.data,n=(r[o+0]+r[o+1]+r[o+2])/3;r[o+0]=n,r[o+1]=n,r[o+2]=n},t}();e.Grayscale=o;var r=function(){function t(){}return t.prototype.updatePixel=function(t,e,i){var o=4*(t+e*i.width),r=i.data;r[o+0]=255-r[o+0],r[o+1]=255-r[o+1],r[o+2]=255-r[o+2]},t}();e.Invert=r;var n=function(){function t(t){this.opacity=t}return t.prototype.updatePixel=function(t,e,i){var o=4*(t+e*i.width),r=i.data;0!==r[o+3]&&(r[o+3]=Math.round(this.opacity*r[o+3]))},t}();e.Opacity=n;var s=function(){function t(t){this.color=t}return t.prototype.updatePixel=function(t,e,i){var o=4*(t+e*i.width),r=i.data;0!==r[o+3]&&(r[o+0]=(r[o+0]+this.color.r)/2,r[o+1]=(r[o+1]+this.color.g)/2,r[o+2]=(r[o+2]+this.color.b)/2)},t}();e.Colorize=s;var a=function(){function t(t){void 0===t&&(t=.1),this.factor=t}return t.prototype.updatePixel=function(t,e,o){var r=4*(t+e*o.width),n=o.data,s=i.Color.fromRGB(n[r+0],n[r+1],n[r+2],n[r+3]).lighten(this.factor);n[r+0]=s.r,n[r+1]=s.g,n[r+2]=s.b,n[r+3]=s.a},t}();e.Lighten=a;var h=function(){function t(t){void 0===t&&(t=.1),this.factor=t}return t.prototype.updatePixel=function(t,e,o){var r=4*(t+e*o.width),n=o.data,s=i.Color.fromRGB(n[r+0],n[r+1],n[r+2],n[r+3]).darken(this.factor);n[r+0]=s.r,n[r+1]=s.g,n[r+2]=s.b,n[r+3]=s.a},t}();e.Darken=h;var l=function(){function t(t){void 0===t&&(t=.1),this.factor=t}return t.prototype.updatePixel=function(t,e,o){var r=4*(t+e*o.width),n=o.data,s=i.Color.fromRGB(n[r+0],n[r+1],n[r+2],n[r+3]).saturate(this.factor);n[r+0]=s.r,n[r+1]=s.g,n[r+2]=s.b,n[r+3]=s.a},t}();e.Saturate=l;var c=function(){function t(t){void 0===t&&(t=.1),this.factor=t}return t.prototype.updatePixel=function(t,e,o){var r=4*(t+e*o.width),n=o.data,s=i.Color.fromRGB(n[r+0],n[r+1],n[r+2],n[r+3]).desaturate(this.factor);n[r+0]=s.r,n[r+1]=s.g,n[r+2]=s.b,n[r+3]=s.a},t}();e.Desaturate=c;var u=function(){function t(t){this.color=t}return t.prototype.updatePixel=function(t,e,i){var o=4*(t+e*i.width),r=i.data;0!==r[o+3]&&(r[o+0]=this.color.r,r[o+1]=this.color.g,r[o+2]=this.color.b)},t}();e.Fill=u}),i("Interfaces/IDrawable",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}),i("Interfaces/ILoadable",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}),i("Resources/Resource",["require","exports","Class","Promises","Util/Log"],function(t,e,i,o,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(t){function e(e,i,o){void 0===o&&(o=!0);var r=t.call(this)||this;return r.path=e,r.responseType=i,r.bustCache=o,r.data=null,r.logger=n.Logger.getInstance(),r.onprogress=function(){},r.oncomplete=function(){},r.onerror=function(){},r}return r(e,t),e.prototype.isLoaded=function(){return null!==this.data},e.prototype.wireEngine=function(t){},e.prototype._cacheBust=function(t){return/\?\w*=\w*/.test(t)?t+="&__="+Date.now():t+="?__="+Date.now(),t},e.prototype._start=function(){this.logger.debug("Started loading resource "+this.path)},e.prototype.load=function(){var t=this,e=new o.Promise;if(null!==this.data)return this.logger.debug("Already have data for resource",this.path),e.resolve(this.data),this.oncomplete(),e;var i=new XMLHttpRequest;return i.open("GET",this.bustCache?this._cacheBust(this.path):this.path,!0),i.responseType=this.responseType,i.onloadstart=function(){t._start()},i.onprogress=this.onprogress,i.onerror=this.onerror,i.onload=function(){if(0!==i.status&&200!==i.status)return t.logger.error("Failed to load resource ",t.path," server responded with error code",i.status),t.onerror(i.response),void e.resolve(i.response);t.data=t.processData(i.response),t.oncomplete(),t.logger.debug("Completed loading resource",t.path),e.resolve(t.data)},i.send(),e},e.prototype.getData=function(){return this.data},e.prototype.setData=function(t){this.data=this.processData(t)},e.prototype.processData=function(t){return"blob"===this.responseType?URL.createObjectURL(t):t},e}(i.Class);e.Resource=s}),i("Resources/Texture",["require","exports","Resources/Resource","Promises","Drawing/Sprite"],function(t,e,i,o,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(t){function e(e,i){void 0===i&&(i=!0);var r=t.call(this,e,"blob",i)||this;return r.path=e,r.bustCache=i,r.loaded=new o.Promise,r._isLoaded=!1,r._sprite=null,r._sprite=new n.Sprite(r,0,0,0,0),r}return r(e,t),e.prototype.isLoaded=function(){return this._isLoaded},e.prototype.load=function(){var e=this,i=new o.Promise;return t.prototype.load.call(this).then(function(){e.image=new Image,e.image.addEventListener("load",function(){e._isLoaded=!0,e.width=e._sprite.width=e.image.naturalWidth,e.height=e._sprite.height=e.image.naturalHeight,e.loaded.resolve(e.image),i.resolve(e.image)}),e.image.src=t.prototype.getData.call(e)},function(){i.reject("Error loading texture.")}),i},e.prototype.asSprite=function(){return this._sprite},e}(i.Resource);e.Texture=s}),i("Configurable",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Configurable=function(t){return function(t){function e(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var o=t.apply(this,e)||this;return 1!==e.filter(function(t){return void 0!==t}).length||!e[0]||"object"!=typeof e[0]||e[0]instanceof Array||o.assign(e[0]),o}return r(e,t),e.prototype.assign=function(t){for(var e in t)"function"!=typeof this[e]&&(this[e]=t[e])},e}(t)}}),i("Util/Decorators",["require","exports","Util/Log","Util/Util"],function(t,e,i,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.obsolete=function(t){return t=o.extend({},{message:"This method will be removed in future versions of Excalibur.",alternateMethod:null},t),function(e,r,n){if("function"!=typeof n.value&&"function"!=typeof n.get&&"function"!=typeof n.set)throw new SyntaxError("Only functions/getters/setters can be marked as obsolete");var s=(e.name||"")+(e.name?".":"")+r+" is marked obsolete: "+t.message+(t.alternateMethod?" Use "+t.alternateMethod+" instead":""),a=o.extend({},n);return n.value?(a.value=function(){return i.Logger.getInstance().warn(s),n.value.apply(this,arguments)},a):(n.get&&(a.get=function(){return i.Logger.getInstance().warn(s),n.get.apply(this,arguments)}),n.set&&(a.set=function(){return i.Logger.getInstance().warn(s),n.set.apply(this,arguments)}),a)}}}),i("Drawing/Sprite",["require","exports","Drawing/SpriteEffects","Drawing/Color","Resources/Texture","Algebra","Util/Log","Util/Util","Configurable","Util/Decorators"],function(t,e,i,o,s,a,h,l,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var p=function(){function t(t,e,i,o,r){var n=this;this.x=0,this.y=0,this.rotation=0,this.anchor=new a.Vector(0,0),this.scale=new a.Vector(1,1),this.logger=h.Logger.getInstance(),this.flipVertical=!1,this.flipHorizontal=!1,this.effects=[],this.width=0,this.height=0,this._spriteCanvas=null,this._spriteCtx=null,this._pixelData=null,this._pixelsLoaded=!1,this._dirtyEffect=!1;var l=t;if(t&&!(t instanceof s.Texture)&&(e=t.x||t.sx,i=t.y||t.sy,o=t.drawWidth||t.swidth,r=t.drawHeight||t.sheight,!(l=t.image)))throw new Error("An image texture is required to contsruct a sprite");this.x=e||0,this.y=i||0,this._texture=l,this._spriteCanvas=document.createElement("canvas"),this._spriteCanvas.width=o,this._spriteCanvas.height=r,this._spriteCtx=this._spriteCanvas.getContext("2d"),this._texture.loaded.then(function(){n._spriteCanvas.width=n._spriteCanvas.width||n._texture.image.naturalWidth,n._spriteCanvas.height=n._spriteCanvas.height||n._texture.image.naturalHeight,n._loadPixels(),n._dirtyEffect=!0}).error(function(t){n.logger.error("Error loading texture ",n._texture.path,t)}),this.width=o,this.height=r}return Object.defineProperty(t.prototype,"drawWidth",{get:function(){return this.width*this.scale.x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"drawHeight",{get:function(){return this.height*this.scale.y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sx",{get:function(){return this.x},set:function(t){this.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sy",{get:function(){return this.y},set:function(t){this.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"swidth",{get:function(){return this.width},set:function(t){this.width=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sheight",{get:function(){return this.height},set:function(t){this.height=t},enumerable:!0,configurable:!0}),t.prototype._loadPixels=function(){if(this._texture.isLoaded()&&!this._pixelsLoaded){var t=this._texture.image.naturalWidth||0,e=this._texture.image.naturalHeight||0;this.width>t&&this.logger.warn("The sprite width "+this.width+" exceeds the width \n                              "+t+" of the backing texture "+this._texture.path),this.height>e&&this.logger.warn("The sprite height "+this.height+" exceeds the height \n                              "+e+" of the backing texture "+this._texture.path),this._spriteCtx.drawImage(this._texture.image,l.clamp(this.x,0,t),l.clamp(this.y,0,e),l.clamp(this.width,0,t),l.clamp(this.height,0,e),0,0,this.width,this.height),this._pixelsLoaded=!0}},t.prototype.opacity=function(t){this.addEffect(new i.Opacity(t))},t.prototype.grayscale=function(){this.addEffect(new i.Grayscale)},t.prototype.invert=function(){this.addEffect(new i.Invert)},t.prototype.fill=function(t){this.addEffect(new i.Fill(t))},t.prototype.colorize=function(t){this.addEffect(new i.Colorize(t))},t.prototype.lighten=function(t){void 0===t&&(t=.1),this.addEffect(new i.Lighten(t))},t.prototype.darken=function(t){void 0===t&&(t=.1),this.addEffect(new i.Darken(t))},t.prototype.saturate=function(t){void 0===t&&(t=.1),this.addEffect(new i.Saturate(t))},t.prototype.desaturate=function(t){void 0===t&&(t=.1),this.addEffect(new i.Desaturate(t))},t.prototype.addEffect=function(t){this.effects.push(t),this._texture.isLoaded()&&this._pixelsLoaded?this._applyEffects():this._dirtyEffect=!0},t.prototype.removeEffect=function(t){var e=-1;(e="number"==typeof t?t:this.effects.indexOf(t))<0||e>=this.effects.length||(this.effects.splice(e,1),this._texture.isLoaded()&&this._pixelsLoaded?this._applyEffects():this._dirtyEffect=!0)},t.prototype._applyEffects=function(){var t=this._texture.image.naturalWidth||0,e=this._texture.image.naturalHeight||0;this._spriteCtx.clearRect(0,0,this.width,this.height),this._spriteCtx.drawImage(this._texture.image,l.clamp(this.x,0,t),l.clamp(this.y,0,e),l.clamp(this.width,0,t),l.clamp(this.height,0,e),0,0,this.width,this.height),this._pixelData=this._spriteCtx.getImageData(0,0,this.width,this.height);for(var i=0,o=0,r=0,n=this.effects.length;i<n;i++)for(r=0;r<this.height;r++)for(o=0;o<this.width;o++)this.effects[i].updatePixel(o,r,this._pixelData);this._spriteCtx.clearRect(0,0,this.width,this.height),this._spriteCtx.putImageData(this._pixelData,0,0),this._dirtyEffect=!1},t.prototype.clearEffects=function(){this.effects.length=0,this._applyEffects()},t.prototype.reset=function(){},t.prototype.debugDraw=function(t,e,i){t.save(),t.translate(e,i),t.rotate(this.rotation);var r=this.drawWidth*this.anchor.x,n=this.drawHeight*this.anchor.y;t.strokeStyle=o.Color.Black.toString(),t.strokeRect(-r,-n,this.drawWidth,this.drawHeight),t.restore()},t.prototype.draw=function(t,e,i){this._dirtyEffect&&this._applyEffects(),t.save();var o=this.drawWidth*this.anchor.x,r=this.drawHeight*this.anchor.y;t.translate(e,i),t.rotate(this.rotation),this.flipHorizontal&&(t.translate(this.drawWidth,0),t.scale(-1,1)),this.flipVertical&&(t.translate(0,this.drawHeight),t.scale(1,-1)),t.drawImage(this._spriteCanvas,0,0,this.width,this.height,-o,-r,this.drawWidth,this.drawHeight),t.restore()},t.prototype.clone=function(){var t=new d(this._texture,this.x,this.y,this.width,this.height);t.scale=this.scale.clone(),t.rotation=this.rotation,t.flipHorizontal=this.flipHorizontal,t.flipVertical=this.flipVertical;for(var e=0,i=this.effects.length;e<i;e++)t.addEffect(this.effects[e]);return t},t}();n([u.obsolete({message:"ex.Sprite.sx will be deprecated in 0.17.0",alternateMethod:"x"})],p.prototype,"sx",null),n([u.obsolete({message:"ex.Sprite.sy will be deprecated in 0.17.0",alternateMethod:"y"})],p.prototype,"sy",null),n([u.obsolete({message:"ex.Sprite.swidth will be deprecated in 0.17.0",alternateMethod:"width"})],p.prototype,"swidth",null),n([u.obsolete({message:"ex.Sprite.sheight will be deprecated in 0.17.0",alternateMethod:"height"})],p.prototype,"sheight",null),e.SpriteImpl=p;var d=function(t){function e(e,i,o,r,n){return t.call(this,e,i,o,r,n)||this}return r(e,t),e}(c.Configurable(p));e.Sprite=d}),i("Drawing/Animation",["require","exports","Drawing/SpriteEffects","Algebra","Engine","Util/Util","Configurable"],function(t,e,i,o,n,s,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=function(){function t(t,e,i,r){this.sprites=[],this.currentFrame=0,this._oldTime=Date.now(),this.anchor=new o.Vector(0,0),this.rotation=0,this.scale=new o.Vector(1,1),this.loop=!0,this.freezeFrame=-1,this.flipVertical=!1,this.flipHorizontal=!1,this.drawWidth=0,this.drawHeight=0,this.width=0,this.height=0;var s=t;if(t&&!(t instanceof n.Engine)){var a=t;s=a.engine,e=a.sprites,i=a.speed,r=a.loop}this.sprites=e,this.speed=i,this._engine=s,null!=r&&(this.loop=r),e&&e[0]&&(this.drawHeight=e[0]?e[0].drawHeight:0,this.drawWidth=e[0]?e[0].drawWidth:0,this.width=e[0]?e[0].width:0,this.height=e[0]?e[0].height:0,this.freezeFrame=e.length-1)}return t.prototype.opacity=function(t){this.addEffect(new i.Opacity(t))},t.prototype.grayscale=function(){this.addEffect(new i.Grayscale)},t.prototype.invert=function(){this.addEffect(new i.Invert)},t.prototype.fill=function(t){this.addEffect(new i.Fill(t))},t.prototype.colorize=function(t){this.addEffect(new i.Colorize(t))},t.prototype.lighten=function(t){void 0===t&&(t=.1),this.addEffect(new i.Lighten(t))},t.prototype.darken=function(t){void 0===t&&(t=.1),this.addEffect(new i.Darken(t))},t.prototype.saturate=function(t){void 0===t&&(t=.1),this.addEffect(new i.Saturate(t))},t.prototype.desaturate=function(t){void 0===t&&(t=.1),this.addEffect(new i.Desaturate(t))},t.prototype.addEffect=function(t){for(var e in this.sprites)this.sprites[e].addEffect(t)},t.prototype.removeEffect=function(t){for(var e in this.sprites)this.sprites[e].removeEffect(t)},t.prototype.clearEffects=function(){for(var t in this.sprites)this.sprites[t].clearEffects()},t.prototype._setAnchor=function(t){for(var e in this.sprites)this.sprites[e].anchor.setTo(t.x,t.y)},t.prototype._setRotation=function(t){for(var e in this.sprites)this.sprites[e].rotation=t},t.prototype._setScale=function(t){for(var e in this.sprites)this.sprites[e].scale=t},t.prototype.reset=function(){this.currentFrame=0},t.prototype.isDone=function(){return!this.loop&&this.currentFrame>=this.sprites.length},t.prototype.tick=function(){var t=Date.now();t-this._oldTime>this.speed&&(this.currentFrame=this.loop?(this.currentFrame+1)%this.sprites.length:this.currentFrame+1,this._oldTime=t)},t.prototype._updateValues=function(){this._setAnchor(this.anchor),this._setRotation(this.rotation),this._setScale(this.scale)},t.prototype.skip=function(t){this.currentFrame=(this.currentFrame+t)%this.sprites.length},t.prototype.draw=function(t,e,i){var o;this.tick(),this._updateValues(),this.currentFrame<this.sprites.length&&(o=this.sprites[this.currentFrame],this.flipVertical&&(o.flipVertical=this.flipVertical),this.flipHorizontal&&(o.flipHorizontal=this.flipHorizontal),o.draw(t,e,i)),-1!==this.freezeFrame&&this.currentFrame>=this.sprites.length&&(o=this.sprites[s.clamp(this.freezeFrame,0,this.sprites.length-1)]).draw(t,e,i),o&&(this.drawWidth=o.drawWidth,this.drawHeight=o.drawHeight)},t.prototype.play=function(t,e){this.reset(),this._engine.playAnimation(this,t,e)},t}();e.AnimationImpl=h;var l=function(t){function e(e,i,o,r){return t.call(this,e,i,o,r)||this}return r(e,t),e}(a.Configurable(h));e.Animation=l}),i("Label",["require","exports","Drawing/Color","Actor","Configurable"],function(t,e,i,o,n){"use strict";var s,a,h,l;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.Em=0]="Em",t[t.Rem=1]="Rem",t[t.Px=2]="Px",t[t.Pt=3]="Pt",t[t.Percent=4]="Percent"}(s=e.FontUnit||(e.FontUnit={})),function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Center=2]="Center",t[t.Start=3]="Start",t[t.End=4]="End"}(a=e.TextAlign||(e.TextAlign={})),function(t){t[t.Top=0]="Top",t[t.Hanging=1]="Hanging",t[t.Middle=2]="Middle",t[t.Alphabetic=3]="Alphabetic",t[t.Ideographic=4]="Ideographic",t[t.Bottom=5]="Bottom"}(h=e.BaseAlign||(e.BaseAlign={})),function(t){t[t.Normal=0]="Normal",t[t.Italic=1]="Italic",t[t.Oblique=2]="Oblique"}(l=e.FontStyle||(e.FontStyle={}));var c=function(t){function e(e,r,n,c,u){var p=t.call(this,e&&"object"==typeof e?{x:e.x,y:e.y}:{x:r,y:n})||this;p.bold=!1,p.fontSize=10,p.fontStyle=l.Normal,p.fontUnit=s.Px,p.textAlign=a.Left,p.baseAlign=h.Bottom,p.letterSpacing=0,p.caseInsensitive=!0;var d="";return e&&"object"==typeof e?(c=e.fontFamily,u=e.spriteFont,d=e.text):d=e,p.text=d||"",p.color=i.Color.Black.clone(),p.spriteFont=u,p.collisionType=o.CollisionType.PreventCollision,p.fontFamily=c||"sans-serif",p._textShadowOn=!1,p._shadowOffsetX=0,p._shadowOffsetY=0,p}return r(e,t),e.prototype.getTextWidth=function(t){var e=t.font;t.font=this._fontString;var i=t.measureText(this.text).width;return t.font=e,i},e.prototype._lookupFontUnit=function(t){switch(t){case s.Em:return"em";case s.Rem:return"rem";case s.Pt:return"pt";case s.Px:return"px";case s.Percent:return"%";default:return"px"}},e.prototype._lookupTextAlign=function(t){switch(t){case a.Left:return"left";case a.Right:return"right";case a.Center:return"center";case a.End:return"end";case a.Start:default:return"start"}},e.prototype._lookupBaseAlign=function(t){switch(t){case h.Alphabetic:return"alphabetic";case h.Bottom:return"bottom";case h.Hanging:return"hangin";case h.Ideographic:return"ideographic";case h.Middle:return"middle";case h.Top:return"top";default:return"alphabetic"}},e.prototype._lookupFontStyle=function(t){var e=this.bold?" bold":"";switch(t){case l.Italic:return"italic"+e;case l.Normal:return"normal"+e;case l.Oblique:return"oblique"+e;default:return"normal"+e}},e.prototype.setTextShadow=function(t,e,i){this.spriteFont.setTextShadow(t,e,i)},e.prototype.useTextShadow=function(t){this.spriteFont.useTextShadow(t)},e.prototype.clearTextShadow=function(){this._textShadowOn=!1,this._shadowOffsetX=0,this._shadowOffsetY=0},e.prototype.update=function(e,i){t.prototype.update.call(this,e,i)},e.prototype.draw=function(e,i){e.save(),e.translate(this.pos.x,this.pos.y),e.scale(this.scale.x,this.scale.y),e.rotate(this.rotation),this._textShadowOn&&(e.save(),e.translate(this._shadowOffsetX,this._shadowOffsetY),this._fontDraw(e),e.restore()),this._fontDraw(e),t.prototype.draw.call(this,e,i),e.restore()},e.prototype._fontDraw=function(t){if(this.spriteFont)this.spriteFont.draw(t,this.text,0,0,{color:this.color.clone(),baseAlign:this.baseAlign,textAlign:this.textAlign,fontSize:this.fontSize,letterSpacing:this.letterSpacing,opacity:this.opacity});else{var e=t.textAlign,i=t.textBaseline;t.textAlign=this._lookupTextAlign(this.textAlign),t.textBaseline=this._lookupBaseAlign(this.baseAlign),this.color&&(this.color.a=this.opacity),t.fillStyle=this.color.toString(),t.font=this._fontString,this.maxWidth?t.fillText(this.text,0,0,this.maxWidth):t.fillText(this.text,0,0),t.textAlign=e,t.textBaseline=i}},Object.defineProperty(e.prototype,"_fontString",{get:function(){return this._lookupFontStyle(this.fontStyle)+" "+this.fontSize+this._lookupFontUnit(this.fontUnit)+" "+this.fontFamily},enumerable:!0,configurable:!0}),e.prototype.debugDraw=function(e){t.prototype.debugDraw.call(this,e)},e}(o.Actor);e.LabelImpl=c;var u=function(t){function e(e,i,o,r,n){return t.call(this,e,i,o,r,n)||this}return r(e,t),e}(n.Configurable(c));e.Label=u}),i("Drawing/SpriteSheet",["require","exports","Drawing/Sprite","Drawing/Animation","Drawing/Color","Drawing/SpriteEffects","Resources/Texture","Util/Log","Label","Configurable"],function(t,e,i,o,n,s,a,h,l,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(t,e,o,r,n){this.sprites=[],this.image=null,this.columns=0,this.rows=0,this.spWidth=0,this.spHeight=0;var s=!1;if(t instanceof Array?this.sprites=t:(!t||t instanceof a.Texture?(this.image=t,this.columns=e,this.rows=o,this.spWidth=r,this.spHeight=n):(this.columns=t.columns,this.rows=t.rows,this.spWidth=t.spWidth,this.spHeight=t.spHeight,this.image=t.image),this.sprites=new Array(this.columns*this.rows),s=!0),s){var h=0,l=0;for(h=0;h<this.rows;h++)for(l=0;l<this.columns;l++)this.sprites[l+h*this.columns]=new i.Sprite(this.image,l*this.spWidth,h*this.spHeight,this.spWidth,this.spHeight)}}return t.prototype.getAnimationByIndices=function(t,e,i){var r=this,n=e.map(function(t){return r.sprites[t]});return n=n.map(function(t){return t.clone()}),new o.Animation(t,n,i)},t.prototype.getAnimationBetween=function(t,e,i,r){var n=this.sprites.slice(e,i);return n=n.map(function(t){return t.clone()}),new o.Animation(t,n,r)},t.prototype.getAnimationForAll=function(t,e){var i=this.sprites.map(function(t){return t.clone()});return new o.Animation(t,i,e)},t.prototype.getSprite=function(t){if(t>=0&&t<this.sprites.length)return this.sprites[t];throw new Error("Invalid index: "+t)},t.prototype.getAnimationByCoords=function(t,e,r){for(var n=0,s=0,a=new Array(e.length),h=0;h<e.length;h++){var l=e[h];l.image=l.image||this.image,n=Math.max(n,l.drawWidth),s=Math.max(s,l.drawHeight),a[h]=new i.Sprite(l)}var c=new o.Animation(t,a,r);return c.drawWidth=n,c.drawHeight=s,c},t}();e.SpriteSheetImpl=u;var p=function(t){function e(e,i,o,r,n){return t.call(this,e,i,o,r,n)||this}return r(e,t),e}(c.Configurable(u));e.SpriteSheet=p;var d=function(t){function e(e,i,o,r,s,h,l){var c=t.call(this,e instanceof a.Texture?{image:e,spWidth:h,spHeight:l,rows:s,columns:r}:e)||this;return c._currentColor=n.Color.Black.clone(),c._currentOpacity=1,c._sprites={},c._textShadowOn=!1,c._textShadowDirty=!0,c._textShadowColor=n.Color.Black.clone(),c._textShadowSprites={},c._shadowOffsetX=5,c._shadowOffsetY=5,!e||e instanceof a.Texture||(i=e.alphabet,o=e.caseInsensitive),c._alphabet=i,c._caseInsensitive=o,c._sprites=c.getTextSprites(),c}return r(e,t),e.prototype.getTextSprites=function(){for(var t={},e=0;e<this._alphabet.length;e++){var i=this._alphabet[e];this._caseInsensitive&&(i=i.toLowerCase()),t[i]=this.sprites[e].clone()}return t},e.prototype.setTextShadow=function(t,e,i){for(var o in this._textShadowOn=!0,this._shadowOffsetX=t,this._shadowOffsetY=e,this._textShadowColor=i.clone(),this._textShadowDirty=!0,this._sprites)this._textShadowSprites[o]=this._sprites[o].clone()},e.prototype.useTextShadow=function(t){this._textShadowOn=t,t&&this.setTextShadow(5,5,this._textShadowColor)},e.prototype.draw=function(t,e,i,o,r){if(r=this._parseOptions(r),this._currentColor.toString()!==r.color.toString()||this._currentOpacity!==r.opacity)for(var n in this._currentOpacity=r.opacity,this._currentColor=r.color,this._sprites)this._sprites[n].clearEffects(),this._sprites[n].fill(r.color),this._sprites[n].opacity(r.opacity);if(this._textShadowOn&&this._textShadowDirty&&this._textShadowColor){for(var a in this._textShadowSprites)this._textShadowSprites[a].clearEffects(),this._textShadowSprites[a].addEffect(new s.Fill(this._textShadowColor.clone()));this._textShadowDirty=!1}var c=this.sprites[0],u=c.drawHeight,p=r.fontSize/u,d=e.length*c.drawWidth*p+e.length*r.letterSpacing,f=i;r.textAlign===l.TextAlign.Left||r.textAlign===l.TextAlign.Start?f=i:r.textAlign===l.TextAlign.Right||r.textAlign===l.TextAlign.End?f=i-d:r.textAlign===l.TextAlign.Center&&(f=i-d/2);var g=o-u*p;r.baseAlign===l.BaseAlign.Top||r.baseAlign===l.BaseAlign.Hanging?g=o:r.baseAlign===l.BaseAlign.Ideographic||r.baseAlign===l.BaseAlign.Bottom||r.baseAlign===l.BaseAlign.Alphabetic?g=o-u*p:r.baseAlign===l.BaseAlign.Middle&&(g=o-u*p/2);for(var y=0;y<e.length;y++){var _=e[y];this._caseInsensitive&&(_=_.toLowerCase());try{this._textShadowOn&&(this._textShadowSprites[_].scale.x=p,this._textShadowSprites[_].scale.y=p,this._textShadowSprites[_].draw(t,f+this._shadowOffsetX,g+this._shadowOffsetY));var v=this._sprites[_];v.scale.x=p,v.scale.y=p,v.draw(t,f,g),f+=v.drawWidth+r.letterSpacing}catch(t){h.Logger.getInstance().error("SpriteFont Error drawing char "+_)}}},e.prototype._parseOptions=function(t){return{fontSize:t.fontSize||10,letterSpacing:t.letterSpacing||0,color:t.color||n.Color.Black.clone(),textAlign:void 0===typeof t.textAlign?l.TextAlign.Left:t.textAlign,baseAlign:void 0===typeof t.baseAlign?l.BaseAlign.Bottom:t.baseAlign,maxWidth:t.maxWidth||-1,opacity:t.opacity||0}},e}(p);e.SpriteFontImpl=d;var f=function(t){function e(e,i,o,r,n,s,a){return t.call(this,e,i,o,r,n,s,a)||this}return r(e,t),e}(c.Configurable(d));e.SpriteFont=f}),i("TileMap",["require","exports","Collision/BoundingBox","Drawing/Color","Class","Algebra","Util/Log","Events","Configurable"],function(t,e,i,o,n,s,a,h,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(t){function e(e,i,o,r,n,s){var h,l=t.call(this)||this;if(l._collidingX=-1,l._collidingY=-1,l._onScreenXStart=0,l._onScreenXEnd=9999,l._onScreenYStart=0,l._onScreenYEnd=9999,l._spriteSheets={},l.logger=a.Logger.getInstance(),l.data=[],e&&"object"==typeof e){var c=e;e=c.x,i=c.y,o=c.cellWidth,r=c.cellHeight,n=c.rows,s=c.cols}l.data=new Array(n*s);for(var u=0;u<s;u++)for(var p=0;p<n;p++)h=new f(u*o+e,p*r+i,o,r,u+p*s),l.data[u+p*s]=h;return l}return r(e,t),e.prototype.on=function(e,i){t.prototype.on.call(this,e,i)},e.prototype.registerSpriteSheet=function(t,e){this._spriteSheets[t]=e},e.prototype.collides=function(t){for(var e=t.pos.x+t.getWidth(),i=t.pos.y+t.getHeight(),o=t.getBounds(),r=[],n=o.left;n<=e;n+=Math.min(t.getWidth()/2,this.cellWidth/2))for(var a=o.top;a<=i;a+=Math.min(t.getHeight()/2,this.cellHeight/2)){var h=this.getCellByPoint(n,a);if(h&&h.solid){var l=o.collides(h.getBounds()),c=t.getCenter().sub(h.getCenter());l&&l.dot(c)>0&&r.push(l)}}return 0===r.length?null:r.reduce(function(t,e){var i=t.x,o=t.y;return Math.abs(t.x)<Math.abs(e.x)&&(i=e.x),Math.abs(t.y)<Math.abs(e.y)&&(o=e.y),new s.Vector(i,o)})},e.prototype.getCellByIndex=function(t){return this.data[t]},e.prototype.getCell=function(t,e){return t<0||e<0||t>=this.cols||e>=this.rows?null:this.data[t+e*this.cols]},e.prototype.getCellByPoint=function(t,e){t=Math.floor((t-this.x)/this.cellWidth),e=Math.floor((e-this.y)/this.cellHeight);var i=this.getCell(t,e);return t>=0&&e>=0&&t<this.cols&&e<this.rows&&i?i:null},e.prototype.update=function(t,e){this.emit("preupdate",new h.PreUpdateEvent(t,e,this));var i=t.screenToWorldCoordinates(new s.Vector(0,0)),o=t.screenToWorldCoordinates(new s.Vector(t.canvas.clientWidth,t.canvas.clientHeight));this._onScreenXStart=Math.max(Math.floor((i.x-this.x)/this.cellWidth)-2,0),this._onScreenYStart=Math.max(Math.floor((i.y-this.y)/this.cellHeight)-2,0),this._onScreenXEnd=Math.max(Math.floor((o.x-this.x)/this.cellWidth)+2,0),this._onScreenYEnd=Math.max(Math.floor((o.y-this.y)/this.cellHeight)+2,0),this.emit("postupdate",new h.PostUpdateEvent(t,e,this))},e.prototype.draw=function(t,e){this.emit("predraw",new h.PreDrawEvent(t,e,this)),t.save(),t.translate(this.x,this.y);for(var i,o,r,n=this._onScreenXStart,s=Math.min(this._onScreenXEnd,this.cols),a=this._onScreenYStart,l=Math.min(this._onScreenYEnd,this.rows);n<s;n++){for(;a<l;a++)for(o=0,r=(i=this.getCell(n,a).sprites.filter(function(t){return t.spriteId>-1})).length;o<r;o++){var c=this._spriteSheets[i[o].spriteSheetKey];if(c){var u=c.getSprite(i[o].spriteId);u?u.draw(t,n*this.cellWidth,a*this.cellHeight):this.logger.warn("Sprite does not exist for id",i[o].spriteId,"in sprite sheet",i[o].spriteSheetKey,u,c)}else this.logger.warn("Sprite sheet",i[o].spriteSheetKey,"does not exist",c)}a=this._onScreenYStart}t.restore(),this.emit("postdraw",new h.PostDrawEvent(t,e,this))},e.prototype.debugDraw=function(t){var e=this.cols*this.cellWidth,i=this.rows*this.cellHeight;t.save(),t.strokeStyle=o.Color.Red.toString();for(var r=0;r<this.cols+1;r++)t.beginPath(),t.moveTo(this.x+r*this.cellWidth,this.y),t.lineTo(this.x+r*this.cellWidth,this.y+i),t.stroke();for(var n=0;n<this.rows+1;n++)t.beginPath(),t.moveTo(this.x,this.y+n*this.cellHeight),t.lineTo(this.x+e,this.y+n*this.cellHeight),t.stroke();var s=o.Color.Red.clone();s.a=.3,this.data.filter(function(t){return t.solid}).forEach(function(e){t.fillStyle=s.toString(),t.fillRect(e.x,e.y,e.width,e.height)}),this._collidingY>-1&&this._collidingX>-1&&(t.fillStyle=o.Color.Cyan.toString(),t.fillRect(this.x+this._collidingX*this.cellWidth,this.y+this._collidingY*this.cellHeight,this.cellWidth,this.cellHeight)),t.restore()},e}(n.Class);e.TileMapImpl=c;var u=function(t){function e(e,i,o,r,n,s){return t.call(this,e,i,o,r,n,s)||this}return r(e,t),e}(l.Configurable(c));e.TileMap=u;var p=function(t,e){this.spriteSheetKey=t,this.spriteId=e};e.TileSprite=p;var d=function(){function t(t,e,o,r,n,s,a){if(void 0===s&&(s=!1),void 0===a&&(a=[]),this.solid=!1,this.sprites=[],t&&"object"==typeof t){var h=t;t=h.x,e=h.y,o=h.width,r=h.height,n=h.index,s=h.solid,a=h.sprites}this.x=t,this.y=e,this.width=o,this.height=r,this.index=n,this.solid=s,this.sprites=a,this._bounds=new i.BoundingBox(this.x,this.y,this.x+this.width,this.y+this.height)}return t.prototype.getBounds=function(){return this._bounds},t.prototype.getCenter=function(){return new s.Vector(this.x+this.width/2,this.y+this.height/2)},t.prototype.pushSprite=function(t){this.sprites.push(t)},t.prototype.removeSprite=function(t){var e;(e=this.sprites.indexOf(t))>-1&&this.sprites.splice(e,1)},t.prototype.clearSprites=function(){this.sprites.length=0},t}();e.CellImpl=d;var f=function(t){function e(e,i,o,r,n,s,a){return t.call(this,e,i,o,r,n,s,a)||this}return r(e,t),e}(l.Configurable(d));e.Cell=f}),i("Trigger",["require","exports","Drawing/Color","Actions/Action","EventDispatcher","Actor","Algebra","Events","Util/Util"],function(t,e,i,o,n,s,a,h,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c={pos:a.Vector.Zero.clone(),width:10,height:10,visible:!1,action:function(){},filter:function(){return!0},repeat:-1},u=function(t){function e(e){var i=t.call(this,e.pos.x,e.pos.y,e.width,e.height)||this;return i.action=function(){},i.filter=function(){return!0},i.repeat=-1,e=l.extend({},c,e),i.filter=e.filter||i.filter,i.repeat=e.repeat||i.repeat,i.action=e.action||i.action,e.target&&(i.target=e.target),i.visible=e.visible,i.collisionType=s.CollisionType.Passive,i.eventDispatcher=new n.EventDispatcher(i),i.actionQueue=new o.ActionQueue(i),i.on("collisionstart",function(t){i.filter(t.other)&&(i.emit("enter",new h.EnterTriggerEvent(i,t.other)),i._dispatchAction(),0===i.repeat&&i.kill())}),i.on("collisionend",function(t){i.filter(t.other)&&i.emit("exit",new h.ExitTriggerEvent(i,t.other))}),i}return r(e,t),Object.defineProperty(e.prototype,"target",{get:function(){return this._target},set:function(t){this._target=t,this.filter=function(e){return e===t}},enumerable:!0,configurable:!0}),e.prototype._initialize=function(e){t.prototype._initialize.call(this,e)},e.prototype._dispatchAction=function(){this.action.call(this),this.repeat--},e.prototype.debugDraw=function(e){t.prototype.debugDraw.call(this,e),e.save(),e.translate(this.pos.x,this.pos.y);var o=this.getBounds(),r=this.getWorldPos();o.left=o.left-r.x,o.right=o.right-r.x,o.top=o.top-r.y,o.bottom=o.bottom-r.y,e.fillStyle=i.Color.Violet.toString(),e.strokeStyle=i.Color.Violet.toString(),e.fillText("Trigger",10,10),o.debugDraw(e),e.restore()},e}(s.Actor);e.Trigger=u}),i("Util/Actors",["require","exports","UIActor","Label","Trigger"],function(t,e,i,o,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isVanillaActor=function(t){return!(t instanceof i.UIActor||t instanceof r.Trigger||t instanceof o.Label)},e.isUIActor=function(t){return t instanceof i.UIActor}}),i("Scene",["require","exports","UIActor","Physics","Events","Util/Log","Timer","Collision/DynamicTreeCollisionBroadphase","Util/SortedList","Group","TileMap","Camera","Actor","Class","Util/Util","Util/Actors","Trigger"],function(t,e,i,o,n,s,a,h,l,c,u,p,d,f,g,y,_){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var v=function(t){function e(e){var i=t.call(this)||this;return i.actors=[],i.triggers=[],i.tileMaps=[],i.groups={},i.uiActors=[],i._isInitialized=!1,i._sortedDrawingTree=new l.SortedList(d.Actor.prototype.getZIndex),i._broadphase=new h.DynamicTreeCollisionBroadphase,i._killQueue=[],i._triggerKillQueue=[],i._timers=[],i._cancelQueue=[],i._logger=s.Logger.getInstance(),i.camera=new p.BaseCamera,e&&(i.camera.x=e.halfDrawWidth,i.camera.y=e.halfDrawHeight),i}return r(e,t),e.prototype.on=function(e,i){t.prototype.on.call(this,e,i)},e.prototype.once=function(e,i){t.prototype.once.call(this,e,i)},e.prototype.off=function(e,i){t.prototype.off.call(this,e,i)},e.prototype.onInitialize=function(t){},e.prototype.onActivate=function(t,e){},e.prototype.onDeactivate=function(t,e){},e.prototype.onPreUpdate=function(t,e){},e.prototype.onPostUpdate=function(t,e){},e.prototype.onPreDraw=function(t,e){},e.prototype.onPostDraw=function(t,e){},e.prototype._initializeChildren=function(){for(var t=0,e=this.actors;t<e.length;t++)e[t]._initialize(this.engine)},Object.defineProperty(e.prototype,"isInitialized",{get:function(){return this._isInitialized},enumerable:!0,configurable:!0}),e.prototype._initialize=function(t){this.isInitialized||(this.camera&&(this.camera.x=t.halfDrawWidth,this.camera.y=t.halfDrawHeight),this._initializeChildren(),this._logger.debug("Scene.onInitialize",this,t),this.eventDispatcher.emit("initialize",new n.InitializeEvent(t,this)),this.onInitialize.call(this,t),this._isInitialized=!0)},e.prototype._activate=function(t,e){this._logger.debug("Scene.onActivate",this),this.onActivate(t,e)},e.prototype._deactivate=function(t,e){this._logger.debug("Scene.onDectivate",this),this.onDeactivate(t,e)},e.prototype._preupdate=function(t,e){this.emit("preupdate",new n.PreUpdateEvent(t,e,this)),this.onPreUpdate(t,e)},e.prototype._postupdate=function(t,e){this.emit("postupdate",new n.PostUpdateEvent(t,e,this)),this.onPostUpdate(t,e)},e.prototype._predraw=function(t,e){this.emit("predraw",new n.PreDrawEvent(t,e,this)),this.onPreDraw(t,e)},e.prototype._postdraw=function(t,e){this.emit("postdraw",new n.PostDrawEvent(t,e,this)),this.onPostDraw(t,e)},e.prototype.update=function(t,e){var i,r;for(this._preupdate(t,e),i=0,r=this._cancelQueue.length;i<r;i++)this.removeTimer(this._cancelQueue[i]);this._cancelQueue.length=0;for(var n=0,s=this._timers;n<s.length;n++)s[n].update(e);for(i=0,r=this.uiActors.length;i<r;i++)this.uiActors[i].update(t,e);for(i=0,r=this.tileMaps.length;i<r;i++)this.tileMaps[i].update(t,e);for(i=0,r=this.actors.length;i<r;i++)this.actors[i].update(t,e);for(i=0,r=this.triggers.length;i<r;i++)this.triggers[i].update(t,e);if(this._collectActorStats(t),this._broadphase&&o.Physics.enabled){var a=Date.now();this._broadphase.update(this.actors,e);for(var h=this._broadphase.broadphase(this.actors,e,t.stats.currFrame),l=Date.now(),c=Date.now(),u=o.Physics.collisionPasses,p=e/u;u>0;)h=this._broadphase.narrowphase(h,t.stats.currFrame),h=this._broadphase.resolve(h,p,o.Physics.collisionResolutionStrategy),this._broadphase.runCollisionStartEnd(h),u--;var d=Date.now();t.stats.currFrame.physics.broadphase=l-a,t.stats.currFrame.physics.narrowphase=d-c}t.stats.currFrame.actors.killed=this._killQueue.length+this._triggerKillQueue.length,this._processKillQueue(this._killQueue,this.actors),this._processKillQueue(this._triggerKillQueue,this.triggers),this.camera&&this.camera.update(t,e),this._postupdate(t,e)},e.prototype._processKillQueue=function(t,e){for(var i,o=0,r=t;o<r.length;o++){var n=r[o];(i=e.indexOf(n))>-1&&(this._sortedDrawingTree.removeByComparable(n),e.splice(i,1))}t.length=0},e.prototype.draw=function(t,e){var i,o;for(this._predraw(t,e),t.save(),this.camera&&this.camera.draw(t),i=0,o=this.tileMaps.length;i<o;i++)this.tileMaps[i].draw(t,e);var r=this._sortedDrawingTree.list();for(i=0,o=r.length;i<o;i++)r[i].visible&&!r[i].isOffScreen&&r[i].draw(t,e);for(this.engine&&this.engine.isDebug&&(t.strokeStyle="yellow",this.debugDraw(t)),t.restore(),i=0,o=this.uiActors.length;i<o;i++)this.uiActors[i].visible&&this.uiActors[i].draw(t,e);if(this.engine&&this.engine.isDebug)for(i=0,o=this.uiActors.length;i<o;i++)this.uiActors[i].debugDraw(t);this._postdraw(t,e)},e.prototype.debugDraw=function(t){var e,i;for(this.emit("predebugdraw",new n.PreDebugDrawEvent(t,this)),e=0,i=this.tileMaps.length;e<i;e++)this.tileMaps[e].debugDraw(t);for(e=0,i=this.actors.length;e<i;e++)this.actors[e].debugDraw(t);for(e=0,i=this.triggers.length;e<i;e++)this.triggers[e].debugDraw(t);this._broadphase.debugDraw(t,20),this.camera.debugDraw(t),this.emit("postdebugdraw",new n.PostDebugDrawEvent(t,this))},e.prototype.contains=function(t){return this.actors.indexOf(t)>-1},e.prototype.add=function(t){t instanceof d.Actor&&t.unkill(),t instanceof i.UIActor?g.contains(this.uiActors,t)||this.addUIActor(t):t instanceof d.Actor?g.contains(this.actors,t)||this._addChild(t):t instanceof a.Timer?g.contains(this._timers,t)||this.addTimer(t):t instanceof u.TileMap&&(g.contains(this.tileMaps,t)||this.addTileMap(t))},e.prototype.remove=function(t){t instanceof i.UIActor?this.removeUIActor(t):(t instanceof d.Actor&&(this._broadphase.untrack(t.body),this._removeChild(t)),t instanceof a.Timer&&this.removeTimer(t),t instanceof u.TileMap&&this.removeTileMap(t))},e.prototype.addUIActor=function(t){this.uiActors.push(t),t.scene=this},e.prototype.removeUIActor=function(t){var e=this.uiActors.indexOf(t);e>-1&&this.uiActors.splice(e,1)},e.prototype._addChild=function(t){this._broadphase.track(t.body),t.scene=this,t instanceof _.Trigger?this.triggers.push(t):this.actors.push(t),this._sortedDrawingTree.add(t)},e.prototype.addTileMap=function(t){this.tileMaps.push(t)},e.prototype.removeTileMap=function(t){var e=this.tileMaps.indexOf(t);e>-1&&this.tileMaps.splice(e,1)},e.prototype._removeChild=function(t){this._broadphase.untrack(t.body),t instanceof _.Trigger?this._triggerKillQueue.push(t):this._killQueue.push(t),t.parent=null},e.prototype.addTimer=function(t){return this._timers.push(t),t.scene=this,t},e.prototype.removeTimer=function(t){var e=this._timers.indexOf(t);return-1!==e&&this._timers.splice(e,1),t},e.prototype.cancelTimer=function(t){return this._cancelQueue.push(t),t},e.prototype.isTimerActive=function(t){return this._timers.indexOf(t)>-1&&!t.complete},e.prototype.createGroup=function(t){return new c.Group(t,this)},e.prototype.getGroup=function(t){return this.groups[t]},e.prototype.removeGroup=function(t){"string"==typeof t?delete this.groups[t]:t instanceof c.Group?delete this.groups[t.name]:this._logger.error("Invalid arguments to removeGroup",t)},e.prototype.cleanupDrawTree=function(t){this._sortedDrawingTree.removeByComparable(t)},e.prototype.updateDrawTree=function(t){this._sortedDrawingTree.add(t)},e.prototype._collectActorStats=function(t){for(var e=0,i=this.uiActors;e<i.length;e++)i[e],t.stats.currFrame.actors.ui++;for(var o=0,r=this.actors;o<r.length;o++){var n=r[o];t.stats.currFrame.actors.alive++;for(var s=0,a=n.children;s<a.length;s++){var h=a[s];y.isUIActor(h)?t.stats.currFrame.actors.ui++:t.stats.currFrame.actors.alive++}}},e}(f.Class);e.Scene=v}),i("Input/Gamepad",["require","exports","Class","Events"],function(t,e,i,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){var e=t.call(this)||this;return e.enabled=!1,e.supported=!!navigator.getGamepads,e._gamePadTimeStamps=[0,0,0,0],e._oldPads=[],e._pads=[],e._initSuccess=!1,e._navigator=navigator,e._minimumConfiguration=null,e}return r(e,t),e.prototype.init=function(){this.supported&&(this._initSuccess||(this._oldPads=this._clonePads(this._navigator.getGamepads()),this._oldPads.length&&this._oldPads[0]&&(this._initSuccess=!0)))},e.prototype.setMinimumGamepadConfiguration=function(t){this._enableAndUpdate(),this._minimumConfiguration=t},e.prototype._enableAndUpdate=function(){this.enabled||(this.enabled=!0,this.update())},e.prototype._isGamepadValid=function(t){if(!this._minimumConfiguration)return!0;if(!t)return!1;var e=t.axes.filter(function(t){return void 0!==typeof t}).length,i=t.buttons.filter(function(t){return void 0!==typeof t}).length;return e>=this._minimumConfiguration.axis&&i>=this._minimumConfiguration.buttons&&t.connected},e.prototype.on=function(e,i){this._enableAndUpdate(),t.prototype.on.call(this,e,i)},e.prototype.off=function(e,i){this._enableAndUpdate(),t.prototype.off.call(this,e,i)},e.prototype.update=function(){if(this.enabled&&this.supported){this.init();for(var t=this._navigator.getGamepads(),e=0;e<t.length;e++)if(t[e]){if(!this.at(e).connected&&this._isGamepadValid(t[e])&&this.eventDispatcher.emit("connect",new o.GamepadConnectEvent(e,this.at(e))),this.at(e).connected=!0,!t[e].timestamp||t[e].timestamp!==this._gamePadTimeStamps[e]){var i,r,n,h,l;for(i in this._gamePadTimeStamps[e]=t[e].timestamp,this.at(e).navigatorGamepad=t[e],s)"number"==typeof(r=s[i])&&t[e].buttons[r]&&(l=t[e].buttons[r].value)!==this._oldPads[e].getButton(r)&&(t[e].buttons[r].pressed?(this.at(e).updateButton(r,l),this.at(e).eventDispatcher.emit("button",new o.GamepadButtonEvent(r,l,this.at(e)))):this.at(e).updateButton(r,0));for(n in a)"number"==typeof(h=a[n])&&(l=t[e].axes[h])!==this._oldPads[e].getAxes(h)&&(this.at(e).updateAxes(h,l),this.at(e).eventDispatcher.emit("axis",new o.GamepadAxisEvent(h,l,this.at(e))));this._oldPads[e]=this._clonePad(t[e])}}else{var c=this.at(e);c.connected&&this.eventDispatcher.emit("disconnect",new o.GamepadDisconnectEvent(e,c)),c.connected=!1}}},e.prototype.at=function(t){if(this._enableAndUpdate(),t>=this._pads.length)for(var e=this._pads.length-1,i=t;e<i;e++)this._pads.push(new h),this._oldPads.push(new h);return this._pads[t]},e.prototype.getValidGamepads=function(){this._enableAndUpdate();for(var t=[],e=0;e<this._pads.length;e++)this._isGamepadValid(this.at(e).navigatorGamepad)&&this.at(e).connected&&t.push(this.at(e));return t},e.prototype.count=function(){return this._pads.filter(function(t){return t.connected}).length},e.prototype._clonePads=function(t){for(var e=[],i=0,o=t.length;i<o;i++)e.push(this._clonePad(t[i]));return e},e.prototype._clonePad=function(t){var e,i,o=new h;if(!t)return o;for(e=0,i=t.buttons.length;e<i;e++)t.buttons[e]&&o.updateButton(e,t.buttons[e].value);for(e=0,i=t.axes.length;e<i;e++)o.updateAxes(e,t.axes[e]);return o},e}(i.Class);n.MinAxisMoveThreshold=.05,e.Gamepads=n;var s,a,h=function(t){function e(){var e,i=t.call(this)||this;for(i.connected=!1,i._buttons=new Array(16),i._axes=new Array(4),e=0;e<i._buttons.length;e++)i._buttons[e]=0;for(e=0;e<i._axes.length;e++)i._axes[e]=0;return i}return r(e,t),e.prototype.isButtonPressed=function(t,e){return void 0===e&&(e=1),this._buttons[t]>=e},e.prototype.getButton=function(t){return this._buttons[t]},e.prototype.getAxes=function(t){var e=this._axes[t];return Math.abs(e)<n.MinAxisMoveThreshold?0:e},e.prototype.updateButton=function(t,e){this._buttons[t]=e},e.prototype.updateAxes=function(t,e){this._axes[t]=e},e}(i.Class);e.Gamepad=h,function(t){t[t.Face1=0]="Face1",t[t.Face2=1]="Face2",t[t.Face3=2]="Face3",t[t.Face4=3]="Face4",t[t.LeftBumper=4]="LeftBumper",t[t.RightBumper=5]="RightBumper",t[t.LeftTrigger=6]="LeftTrigger",t[t.RightTrigger=7]="RightTrigger",t[t.Select=8]="Select",t[t.Start=9]="Start",t[t.LeftStick=10]="LeftStick",t[t.RightStick=11]="RightStick",t[t.DpadUp=12]="DpadUp",t[t.DpadDown=13]="DpadDown",t[t.DpadLeft=14]="DpadLeft",t[t.DpadRight=15]="DpadRight"}(s=e.Buttons||(e.Buttons={})),function(t){t[t.LeftStickX=0]="LeftStickX",t[t.LeftStickY=1]="LeftStickY",t[t.RightStickX=2]="RightStickX",t[t.RightStickY=3]="RightStickY"}(a=e.Axes||(e.Axes={}))}),i("Input/Pointer",["require","exports","Engine","Events","Algebra","Class","Util/Actors","Util/Util","Util/Decorators"],function(t,e,i,o,s,a,h,l,c){"use strict";var u,p,d;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.Touch=0]="Touch",t[t.Mouse=1]="Mouse",t[t.Pen=2]="Pen",t[t.Unknown=3]="Unknown"}(u=e.PointerType||(e.PointerType={})),function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Unknown=3]="Unknown"}(p=e.PointerButton||(e.PointerButton={})),function(t){t[t.Pixel=0]="Pixel",t[t.Line=1]="Line",t[t.Page=2]="Page"}(d=e.WheelDeltaMode||(e.WheelDeltaMode={})),function(t){t[t.Canvas=0]="Canvas",t[t.Document=1]="Document"}(e.PointerScope||(e.PointerScope={}));var f=function(t){function e(e,i,o,r,n,s){var a=t.call(this)||this;return a.coordinates=e,a.pointer=i,a.index=o,a.pointerType=r,a.button=n,a.ev=s,a}return r(e,t),Object.defineProperty(e.prototype,"x",{get:function(){return this.coordinates.worldPos.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.coordinates.worldPos.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"worldX",{get:function(){return this.coordinates.worldPos.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"worldY",{get:function(){return this.coordinates.worldPos.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pageX",{get:function(){return this.coordinates.pagePos.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pageY",{get:function(){return this.coordinates.pagePos.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"screenX",{get:function(){return this.coordinates.screenPos.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"screenY",{get:function(){return this.coordinates.screenPos.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"worldPos",{get:function(){return this.coordinates.worldPos.clone()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pagePos",{get:function(){return this.coordinates.pagePos.clone()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"screenPos",{get:function(){return this.coordinates.screenPos.clone()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pos",{get:function(){return this.coordinates.worldPos.clone()},enumerable:!0,configurable:!0}),e}(o.GameEvent);n([c.obsolete({message:"PointerEvent.x will be removed in the 0.17 release",alternateMethod:"PointerEvent.worldPos.x"})],f.prototype,"x",null),n([c.obsolete({message:"PointerEvent.y will be removed in the 0.17 release",alternateMethod:"PointerEvent.worldPos.y"})],f.prototype,"y",null),n([c.obsolete({message:"PointerEvent.worldX will be removed in the 0.17 release",alternateMethod:"PointerEvent.worldPos.x"})],f.prototype,"worldX",null),n([c.obsolete({message:"PointerEvent.worldY will be removed in the 0.17 release",alternateMethod:"PointerEvent.worldPos.y"})],f.prototype,"worldY",null),n([c.obsolete({message:"PointerEvent.pageX will be removed in the 0.17 release",alternateMethod:"PointerEvent.pagePos.x"})],f.prototype,"pageX",null),n([c.obsolete({message:"PointerEvent.pageY will be removed in the 0.17 release",alternateMethod:"PointerEvent.pagePos.y"})],f.prototype,"pageY",null),n([c.obsolete({message:"PointerEvent.screenX will be removed in the 0.17 release",alternateMethod:"PointerEvent.screenPos.x"})],f.prototype,"screenX",null),n([c.obsolete({message:"PointerEvent.screenY will be removed in the 0.17 release",alternateMethod:"PointerEvent.screenPos.y"})],f.prototype,"screenY",null),e.PointerEvent=f;var g=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e}(f);e.PointerDragEvent=g;var y=function(t){function e(e,i,o,r,n,s,a,h,l,c,u,p){var d=t.call(this)||this;return d.x=e,d.y=i,d.pageX=o,d.pageY=r,d.screenX=n,d.screenY=s,d.index=a,d.deltaX=h,d.deltaY=l,d.deltaZ=c,d.deltaMode=u,d.ev=p,d}return r(e,t),e}(o.GameEvent);e.WheelEvent=y;var _=function(t){function e(e){var i=t.call(this)||this;return i._pointerDown=[],i._pointerUp=[],i._pointerMove=[],i._pointerCancel=[],i._wheel=[],i._pointers=[],i._activePointers=[],i._engine=e,i._pointers.push(new v),i._activePointers=[-1],i.primary=i._pointers[0],i}return r(e,t),e.prototype.on=function(e,i){t.prototype.on.call(this,e,i)},e.prototype.init=function(t){(t=t||this._engine.canvas).addEventListener("touchstart",this._handleTouchEvent("down",this._pointerDown)),t.addEventListener("touchend",this._handleTouchEvent("up",this._pointerUp)),t.addEventListener("touchmove",this._handleTouchEvent("move",this._pointerMove)),t.addEventListener("touchcancel",this._handleTouchEvent("cancel",this._pointerCancel)),window.PointerEvent?(this._engine.canvas.style.touchAction="none",t.addEventListener("pointerdown",this._handlePointerEvent("down",this._pointerDown)),t.addEventListener("pointerup",this._handlePointerEvent("up",this._pointerUp)),t.addEventListener("pointermove",this._handlePointerEvent("move",this._pointerMove)),t.addEventListener("pointercancel",this._handlePointerEvent("cancel",this._pointerCancel))):window.MSPointerEvent?(this._engine.canvas.style.msTouchAction="none",t.addEventListener("MSPointerDown",this._handlePointerEvent("down",this._pointerDown)),t.addEventListener("MSPointerUp",this._handlePointerEvent("up",this._pointerUp)),t.addEventListener("MSPointerMove",this._handlePointerEvent("move",this._pointerMove)),t.addEventListener("MSPointerCancel",this._handlePointerEvent("cancel",this._pointerCancel))):(t.addEventListener("mousedown",this._handleMouseEvent("down",this._pointerDown)),t.addEventListener("mouseup",this._handleMouseEvent("up",this._pointerUp)),t.addEventListener("mousemove",this._handleMouseEvent("move",this._pointerMove))),"onwheel"in document.createElement("div")?t.addEventListener("wheel",this._handleWheelEvent("wheel",this._wheel)):void 0!==document.onmousewheel?t.addEventListener("mousewheel",this._handleWheelEvent("wheel",this._wheel)):t.addEventListener("MozMousePixelScroll",this._handleWheelEvent("wheel",this._wheel))},e.prototype.update=function(){this._pointerUp.length=0,this._pointerDown.length=0,this._pointerMove.length=0,this._pointerCancel.length=0,this._wheel.length=0;for(var t=0;t<this._pointers.length;t++)this._pointers[t].update()},e.prototype.at=function(t){if(t>=this._pointers.length)for(var e=this._pointers.length-1,i=t;e<i;e++)this._pointers.push(new v),this._activePointers.push(-1);return this._pointers[t]},e.prototype.count=function(){return this._pointers.length},e.prototype.propogate=function(t){var e,i,o=!h.isUIActor(t),r=0,n=0;for(r=0,n=this._pointerDown.length;r<n;r++)i=(e=this._pointerDown[r]).pointer,t.contains(i.lastWorldPos.x,i.lastWorldPos.y,o)&&(t.eventDispatcher.emit("pointerdown",e),i.isDragStart&&t.capturePointer.captureDragEvents&&t.eventDispatcher.emit("pointerdragstart",e));for(r=0,n=this._pointerUp.length;r<n;r++)i=(e=this._pointerUp[r]).pointer,t.contains(i.lastWorldPos.x,i.lastWorldPos.y,o)&&(t.eventDispatcher.emit("pointerup",e),i.isDragEnd&&t.capturePointer.captureDragEvents&&t.eventDispatcher.emit("pointerdragend",e));if(t.capturePointer.captureMoveEvents)for(r=0,n=this._pointerMove.length;r<n;r++)i=(e=this._pointerMove[r]).pointer,t.contains(i.lastWorldPos.x,i.lastWorldPos.y,o)&&(i.actorsUnderPointer[t.id]||(i.actorsUnderPointer[t.id]=t,t.eventDispatcher.emit("pointerenter",e),i.isDragging&&t.capturePointer.captureDragEvents&&t.eventDispatcher.emit("pointerdragenter",e)),t.eventDispatcher.emit("pointermove",e),i.isDragging&&t.capturePointer.captureDragEvents&&t.eventDispatcher.emit("pointerdragmove",e)),t.contains(i.lastWorldPos.x,i.lastWorldPos.y,o)||i.actorsUnderPointer[t.id]&&(delete i.actorsUnderPointer[t.id],t.eventDispatcher.emit("pointerleave",e),i.isDragging&&t.capturePointer.captureDragEvents&&t.eventDispatcher.emit("pointerdragleave",e));for(r=0,n=this._pointerCancel.length;r<n;r++)i=(e=this._pointerCancel[r]).pointer,t.contains(i.lastWorldPos.x,i.lastWorldPos.y,o)&&t.eventDispatcher.emit("pointercancel",e);for(r=0,n=this._wheel.length;r<n;r++)t.contains(this._wheel[r].x,this._wheel[r].y,o)&&t.eventDispatcher.emit("pointerwheel",this._wheel[r])},e.prototype._handleMouseEvent=function(t,e){var i=this;return function(o){o.preventDefault();var r=i.at(0),n=s.GlobalCoordinates.fromPagePosition(o.pageX,o.pageY,i._engine),a=new f(n,r,0,u.Mouse,o.button,o);e.push(a),r.eventDispatcher.emit(t,a)}},e.prototype._handleTouchEvent=function(t,e){var i=this;return function(o){o.preventDefault();for(var r=0,n=o.changedTouches.length;r<n;r++){var a=i._pointers.length>1?i._getPointerIndex(o.changedTouches[r].identifier):0;if(-1!==a){var h=i.at(a),l=s.GlobalCoordinates.fromPagePosition(o.changedTouches[r].pageX,o.changedTouches[r].pageY,i._engine),c=new f(l,h,a,u.Touch,p.Unknown,o);e.push(c),h.eventDispatcher.emit(t,c),i._pointers.length>1&&("up"===t?i._activePointers[a]=-1:"down"===t&&(i._activePointers[a]=o.changedTouches[r].identifier))}}}},e.prototype._handlePointerEvent=function(t,e){var i=this;return function(o){o.preventDefault();var r=i._pointers.length>1?i._getPointerIndex(o.pointerId):0;if(-1!==r){var n=i.at(r),a=s.GlobalCoordinates.fromPagePosition(o.pageX,o.pageY,i._engine),h=new f(a,n,r,i._stringToPointerType(o.pointerType),o.button,o);e.push(h),n.eventDispatcher.emit(t,h),i._pointers.length>1&&("up"===t?i._activePointers[r]=-1:"down"===t&&(i._activePointers[r]=o.pointerId))}}},e.prototype._handleWheelEvent=function(t,e){var o=this;return function(r){(o._engine.pageScrollPreventionMode===i.ScrollPreventionMode.All||o._engine.pageScrollPreventionMode===i.ScrollPreventionMode.Canvas&&r.target===o._engine.canvas)&&r.preventDefault();var n=r.pageX-l.getPosition(o._engine.canvas).x,a=r.pageY-l.getPosition(o._engine.canvas).y,h=o._engine.screenToWorldCoordinates(new s.Vector(n,a)),c=r.deltaX||-.025*r.wheelDeltaX||0,u=r.deltaY||-.025*r.wheelDeltaY||-.025*r.wheelDelta||r.detail||0,p=r.deltaZ||0,f=d.Pixel;r.deltaMode&&(1===r.deltaMode?f=d.Line:2===r.deltaMode&&(f=d.Page));var g=new y(h.x,h.y,r.pageX,r.pageY,n,a,0,c,u,p,f,r);e.push(g),o.at(0).eventDispatcher.emit(t,g)}},e.prototype._getPointerIndex=function(t){var e;if((e=this._activePointers.indexOf(t))>-1)return e;for(var i=0;i<this._activePointers.length;i++)if(-1===this._activePointers[i])return i;return-1},e.prototype._stringToPointerType=function(t){switch(t){case"touch":return u.Touch;case"mouse":return u.Mouse;case"pen":return u.Pen;default:return u.Unknown}},e}(a.Class);e.Pointers=_;var v=function(t){function e(){var e=t.call(this)||this;return e._isDown=!1,e._wasDown=!1,e.lastPagePos=null,e.lastScreenPos=null,e.lastWorldPos=null,e.actorsUnderPointer={},e.on("move",e._onPointerMove),e.on("down",e._onPointerDown),e.on("up",e._onPointerUp),e}return r(e,t),Object.defineProperty(e.prototype,"isDragging",{get:function(){return this._isDown},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isDragStart",{get:function(){return!this._wasDown&&this._isDown},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isDragEnd",{get:function(){return this._wasDown&&!this._isDown},enumerable:!0,configurable:!0}),e.prototype.update=function(){this._wasDown&&!this._isDown?this._wasDown=!1:!this._wasDown&&this._isDown&&(this._wasDown=!0)},e.prototype._onPointerMove=function(t){this.lastPagePos=new s.Vector(t.pagePos.x,t.pagePos.y),this.lastScreenPos=new s.Vector(t.screenPos.x,t.screenPos.y),this.lastWorldPos=new s.Vector(t.worldPos.x,t.worldPos.y)},e.prototype._onPointerDown=function(){this._isDown=!0},e.prototype._onPointerUp=function(){this._isDown=!1},e}(a.Class);e.Pointer=v}),i("Input/Keyboard",["require","exports","Class","Events"],function(t,e,i,o){"use strict";var n;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.Num1=97]="Num1",t[t.Num2=98]="Num2",t[t.Num3=99]="Num3",t[t.Num4=100]="Num4",t[t.Num5=101]="Num5",t[t.Num6=102]="Num6",t[t.Num7=103]="Num7",t[t.Num8=104]="Num8",t[t.Num9=105]="Num9",t[t.Num0=96]="Num0",t[t.Numlock=144]="Numlock",t[t.Semicolon=186]="Semicolon",t[t.A=65]="A",t[t.B=66]="B",t[t.C=67]="C",t[t.D=68]="D",t[t.E=69]="E",t[t.F=70]="F",t[t.G=71]="G",t[t.H=72]="H",t[t.I=73]="I",t[t.J=74]="J",t[t.K=75]="K",t[t.L=76]="L",t[t.M=77]="M",t[t.N=78]="N",t[t.O=79]="O",t[t.P=80]="P",t[t.Q=81]="Q",t[t.R=82]="R",t[t.S=83]="S",t[t.T=84]="T",t[t.U=85]="U",t[t.V=86]="V",t[t.W=87]="W",t[t.X=88]="X",t[t.Y=89]="Y",t[t.Z=90]="Z",t[t.Shift=16]="Shift",t[t.Alt=18]="Alt",t[t.Up=38]="Up",t[t.Down=40]="Down",t[t.Left=37]="Left",t[t.Right=39]="Right",t[t.Space=32]="Space",t[t.Esc=27]="Esc"}(n=e.Keys||(e.Keys={}));var s=function(t){function e(e){var i=t.call(this)||this;return i.key=e,i}return r(e,t),e}(o.GameEvent);e.KeyEvent=s;var a=function(t){function e(){var e=t.call(this)||this;return e._keys=[],e._keysUp=[],e._keysDown=[],e}return r(e,t),e.prototype.on=function(e,i){t.prototype.on.call(this,e,i)},e.prototype.init=function(t){var e=this;(t=t||window).addEventListener("blur",function(){e._keys.length=0}),t.addEventListener("keyup",function(t){var i=e._normalizeKeyCode(t.keyCode),o=e._keys.indexOf(i);e._keys.splice(o,1),e._keysUp.push(i);var r=new s(i);e.eventDispatcher.emit("up",r),e.eventDispatcher.emit("release",r)}),t.addEventListener("keydown",function(t){var i=e._normalizeKeyCode(t.keyCode);if(-1===e._keys.indexOf(i)){e._keys.push(i),e._keysDown.push(i);var o=new s(i);e.eventDispatcher.emit("down",o),e.eventDispatcher.emit("press",o)}})},e.prototype.update=function(){this._keysDown.length=0,this._keysUp.length=0;for(var t=0;t<this._keys.length;t++)this.eventDispatcher.emit("hold",new s(this._keys[t]))},e.prototype.getKeys=function(){return this._keys},e.prototype.wasPressed=function(t){return this._keysDown.indexOf(t)>-1},e.prototype.isHeld=function(t){return this._keys.indexOf(t)>-1},e.prototype.wasReleased=function(t){return this._keysUp.indexOf(t)>-1},e.prototype._normalizeKeyCode=function(t){switch(t){case 59:return n.Semicolon;default:return t}},e}(i.Class);e.Keyboard=a}),i("Input/IEngineInput",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}),i("Input/Index",["require","exports","Input/Gamepad","Input/Pointer","Input/Keyboard"],function(t,e,i,o,r){"use strict";function n(t){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}Object.defineProperty(e,"__esModule",{value:!0}),n(i),n(o),n(r)}),i("Events",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){};e.GameEvent=i;var o=function(t){function e(e){var i=t.call(this)||this;return i.target=e,i}return r(e,t),e}(i);e.KillEvent=o;var n=function(t){function e(e){var i=t.call(this)||this;return i.target=e,i}return r(e,t),e}(i);e.PreKillEvent=n;var s=function(t){function e(e){var i=t.call(this)||this;return i.target=e,i}return r(e,t),e}(i);e.PostKillEvent=s;var a=function(t){function e(e){var i=t.call(this)||this;return i.target=e,i}return r(e,t),e}(i);e.GameStartEvent=a;var h=function(t){function e(e){var i=t.call(this)||this;return i.target=e,i}return r(e,t),e}(i);e.GameStopEvent=h;var l=function(t){function e(e,i,o){var r=t.call(this)||this;return r.ctx=e,r.delta=i,r.target=o,r}return r(e,t),e}(i);e.PreDrawEvent=l;var c=function(t){function e(e,i,o){var r=t.call(this)||this;return r.ctx=e,r.delta=i,r.target=o,r}return r(e,t),e}(i);e.PostDrawEvent=c;var u=function(t){function e(e,i){var o=t.call(this)||this;return o.ctx=e,o.target=i,o}return r(e,t),e}(i);e.PreDebugDrawEvent=u;var p=function(t){function e(e,i){var o=t.call(this)||this;return o.ctx=e,o.target=i,o}return r(e,t),e}(i);e.PostDebugDrawEvent=p;var d=function(t){function e(e,i,o){var r=t.call(this)||this;return r.engine=e,r.delta=i,r.target=o,r}return r(e,t),e}(i);e.PreUpdateEvent=d;var f=function(t){function e(e,i,o){var r=t.call(this)||this;return r.engine=e,r.delta=i,r.target=o,r}return r(e,t),e}(i);e.PostUpdateEvent=f;var g=function(t){function e(e,i){var o=t.call(this)||this;return o.engine=e,o.prevStats=i,o.target=e,o}return r(e,t),e}(i);e.PreFrameEvent=g;var y=function(t){function e(e,i){var o=t.call(this)||this;return o.engine=e,o.stats=i,o.target=e,o}return r(e,t),e}(i);e.PostFrameEvent=y;var _=function(t){function e(e,i){var o=t.call(this)||this;return o.index=e,o.gamepad=i,o.target=i,o}return r(e,t),e}(i);e.GamepadConnectEvent=_;var v=function(t){function e(e,i){var o=t.call(this)||this;return o.index=e,o.gamepad=i,o.target=i,o}return r(e,t),e}(i);e.GamepadDisconnectEvent=v;var m=function(t){function e(e,i,o){var r=t.call(this)||this;return r.button=e,r.value=i,r.target=o,r}return r(e,t),e}(i);e.GamepadButtonEvent=m;var b=function(t){function e(e,i,o){var r=t.call(this)||this;return r.axis=e,r.value=i,r.target=o,r}return r(e,t),e}(i);e.GamepadAxisEvent=b;var w=function(t){function e(e,i){var o=t.call(this)||this;return o.topic=e,o.handler=i,o}return r(e,t),e}(i);e.SubscribeEvent=w;var x=function(t){function e(e,i){var o=t.call(this)||this;return o.topic=e,o.handler=i,o}return r(e,t),e}(i);e.UnsubscribeEvent=x;var P=function(t){function e(e){var i=t.call(this)||this;return i.target=e,i}return r(e,t),e}(i);e.VisibleEvent=P;var C=function(t){function e(e){var i=t.call(this)||this;return i.target=e,i}return r(e,t),e}(i);e.HiddenEvent=C;var S=function(t){function e(e,i,o,r){var n=t.call(this)||this;return n.actor=e,n.other=i,n.side=o,n.intersection=r,n.target=e,n}return r(e,t),e}(i);e.PreCollisionEvent=S;var A=function(t){function e(e,i,o,r){var n=t.call(this)||this;return n.actor=e,n.other=i,n.side=o,n.intersection=r,n.target=e,n}return r(e,t),e}(i);e.PostCollisionEvent=A;var E=function(t){function e(e,i,o){var r=t.call(this)||this;return r.actor=e,r.other=i,r.pair=o,r.target=e,r}return r(e,t),e}(i);e.CollisionStartEvent=E;var T=function(t){function e(e,i){var o=t.call(this)||this;return o.actor=e,o.other=i,o.target=e,o}return r(e,t),e}(i);e.CollisionEndEvent=T;var M=function(t){function e(e,i){var o=t.call(this)||this;return o.engine=e,o.target=i,o}return r(e,t),e}(i);e.InitializeEvent=M;var D=function(t){function e(e,i){var o=t.call(this)||this;return o.oldScene=e,o.target=i,o}return r(e,t),e}(i);e.ActivateEvent=D;var O=function(t){function e(e,i){var o=t.call(this)||this;return o.newScene=e,o.target=i,o}return r(e,t),e}(i);e.DeactivateEvent=O;var I=function(t){function e(e){var i=t.call(this)||this;return i.target=e,i}return r(e,t),e}(i);e.ExitViewPortEvent=I;var B=function(t){function e(e){var i=t.call(this)||this;return i.target=e,i}return r(e,t),e}(i);e.EnterViewPortEvent=B;var R=function(t){function e(e,i){var o=t.call(this)||this;return o.target=e,o.actor=i,o}return r(e,t),e}(i);e.EnterTriggerEvent=R;var k=function(t){function e(e,i){var o=t.call(this)||this;return o.target=e,o.actor=i,o}return r(e,t),e}(i);e.ExitTriggerEvent=k}),i("Interfaces/LifecycleEvents",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}),i("Camera",["require","exports","Util/EasingFunctions","Promises","Algebra","Util/Util","Events","Class"],function(t,e,i,o,n,s,a,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l,c=function(){function t(t){this.camera=t}return t.prototype.lockToActor=function(t){this.camera.addStrategy(new u(t))},t.prototype.lockToActorAxis=function(t,e){this.camera.addStrategy(new p(t,e))},t.prototype.elasticToActor=function(t,e,i){this.camera.addStrategy(new d(t,e,i))},t.prototype.radiusAroundActor=function(t,e){this.camera.addStrategy(new f(t,e))},t}();e.StrategyContainer=c,function(t){t[t.X=0]="X",t[t.Y=1]="Y"}(l=e.Axis||(e.Axis={}));var u=function(t){this.target=t,this.action=function(t,e,i,o){return t.getCenter()}};e.LockCameraToActorStrategy=u;var p=function(t,e){var i=this;this.target=t,this.axis=e,this.action=function(t,e,o,r){var s=t.getCenter(),a=e.getFocus();return i.axis===l.X?new n.Vector(s.x,a.y):new n.Vector(a.x,s.y)}};e.LockCameraToActorAxisStrategy=p;var d=function(t,e,i){var o=this;this.target=t,this.cameraElasticity=e,this.cameraFriction=i,this.action=function(t,e,i,r){var s=t.getCenter(),a=e.getFocus(),h=new n.Vector(e.dx,e.dy),l=s.sub(a).scale(o.cameraElasticity),c=(h=h.add(l)).scale(-1).scale(o.cameraFriction);return h=h.add(c),a=a.add(h)}};e.ElasticToActorStrategy=d;var f=function(t,e){var i=this;this.target=t,this.radius=e,this.action=function(t,e,o,r){var n=t.getCenter(),s=e.getFocus(),a=n.sub(s),h=a.magnitude();if(h>=i.radius){var l=h-i.radius;return s.add(a.normalize().scale(l))}return s}};e.RadiusAroundActorStrategy=f;var g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._cameraStrategies=[],e.strategy=new c(e),e.z=1,e.dx=0,e.dy=0,e.dz=0,e.ax=0,e.ay=0,e.az=0,e.rotation=0,e.rx=0,e._x=0,e._y=0,e._cameraMoving=!1,e._currentLerpTime=0,e._lerpDuration=1e3,e._lerpStart=null,e._lerpEnd=null,e._isShaking=!1,e._shakeMagnitudeX=0,e._shakeMagnitudeY=0,e._shakeDuration=0,e._elapsedShakeTime=0,e._xShake=0,e._yShake=0,e._isZooming=!1,e._maxZoomScale=1,e._zoomIncrement=.01,e._easing=i.EasingFunctions.EaseInOutCubic,e._isInitialized=!1,e}return r(e,t),Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(t){this._follow||this._cameraMoving||(this._x=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(t){this._follow||this._cameraMoving||(this._y=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pos",{get:function(){return new n.Vector(this.x,this.y)},set:function(t){this.x=t.x,this.y=t.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vel",{get:function(){return new n.Vector(this.dx,this.dy)},set:function(t){this.dx=t.x,this.dy=t.y},enumerable:!0,configurable:!0}),e.prototype.getFocus=function(){return new n.Vector(this.x,this.y)},e.prototype.move=function(t,e,r){if(void 0===r&&(r=i.EasingFunctions.EaseInOutCubic),"function"!=typeof r)throw"Please specify an EasingFunction";return this._follow?(new o.Promise).reject(t):(this._lerpPromise&&this._lerpPromise.state()===o.PromiseState.Pending&&this._lerpPromise.resolve(t),this._lerpPromise=new o.Promise,this._lerpStart=this.getFocus().clone(),this._lerpDuration=e,this._lerpEnd=t,this._currentLerpTime=0,this._cameraMoving=!0,this._easing=r,this._lerpPromise)},e.prototype.shake=function(t,e,i){this._isShaking=!0,this._shakeMagnitudeX=t,this._shakeMagnitudeY=e,this._shakeDuration=i},e.prototype.zoom=function(t,e){return void 0===e&&(e=0),this._zoomPromise=new o.Promise,e?(this._isZooming=!0,this._maxZoomScale=t,this._zoomIncrement=(t-this.z)/e):(this._isZooming=!1,this.z=t,this._zoomPromise.resolve(!0)),this._zoomPromise},e.prototype.getZoom=function(){return this.z},e.prototype.addStrategy=function(t){this._cameraStrategies.push(t)},e.prototype.removeStrategy=function(t){s.removeItemFromArray(t,this._cameraStrategies)},e.prototype.clearAllStrategies=function(){this._cameraStrategies.length=0},e.prototype._preupdate=function(t,e){this.emit("preupdate",new a.PreUpdateEvent(t,e,this)),this.onPreUpdate(t,e)},e.prototype.onPreUpdate=function(t,e){},e.prototype._postupdate=function(t,e){this.emit("postupdate",new a.PostUpdateEvent(t,e,this)),this.onPostUpdate(t,e)},e.prototype.onPostUpdate=function(t,e){},Object.defineProperty(e.prototype,"isInitialized",{get:function(){return this._isInitialized},enumerable:!0,configurable:!0}),e.prototype._initialize=function(e){this.isInitialized||(this.onInitialize(e),t.prototype.emit.call(this,"initialize",new a.InitializeEvent(e,this)),this._isInitialized=!0)},e.prototype.onInitialize=function(t){},e.prototype.on=function(e,i){t.prototype.on.call(this,e,i)},e.prototype.off=function(e,i){t.prototype.off.call(this,e,i)},e.prototype.once=function(e,i){t.prototype.once.call(this,e,i)},e.prototype.update=function(t,e){if(this._initialize(t),this._preupdate(t,e),this._x+=this.dx*e/1e3,this._y+=this.dy*e/1e3,this.z+=this.dz*e/1e3,this.dx+=this.ax*e/1e3,this.dy+=this.ay*e/1e3,this.dz+=this.az*e/1e3,this.rotation+=this.rx*e/1e3,this._isZooming){var i=this.z+this._zoomIncrement*e;this.z=i,this._zoomIncrement>0?i>=this._maxZoomScale&&(this._isZooming=!1,this.z=this._maxZoomScale,this._zoomPromise.resolve(!0)):i<=this._maxZoomScale&&(this._isZooming=!1,this.z=this._maxZoomScale,this._zoomPromise.resolve(!0))}this._cameraMoving&&(this._currentLerpTime<this._lerpDuration?(this._lerpEnd.x<this._lerpStart.x?this._x=this._lerpStart.x-(this._easing(this._currentLerpTime,this._lerpEnd.x,this._lerpStart.x,this._lerpDuration)-this._lerpEnd.x):this._x=this._easing(this._currentLerpTime,this._lerpStart.x,this._lerpEnd.x,this._lerpDuration),this._lerpEnd.y<this._lerpStart.y?this._y=this._lerpStart.y-(this._easing(this._currentLerpTime,this._lerpEnd.y,this._lerpStart.y,this._lerpDuration)-this._lerpEnd.y):this._y=this._easing(this._currentLerpTime,this._lerpStart.y,this._lerpEnd.y,this._lerpDuration),this._currentLerpTime+=e):(this._x=this._lerpEnd.x,this._y=this._lerpEnd.y,this._lerpPromise.resolve(this._lerpEnd),this._lerpStart=null,this._lerpEnd=null,this._currentLerpTime=0,this._cameraMoving=!1)),this._isDoneShaking()?(this._isShaking=!1,this._elapsedShakeTime=0,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0,this._xShake=0,this._yShake=0):(this._elapsedShakeTime+=e,this._xShake=1+(Math.random()*this._shakeMagnitudeX|0),this._yShake=1+(Math.random()*this._shakeMagnitudeY|0));for(var o=0,r=this._cameraStrategies;o<r.length;o++){var n=r[o];this.pos=n.action.call(n,n.target,this,t,e)}this._postupdate(t,e)},e.prototype.draw=function(t){var e=this.getFocus(),i=t.canvas.width,o=t.canvas.height,r=window.devicePixelRatio,n=this.getZoom(),s=i/n/r,a=o/n/r;t.scale(n,n),t.translate(-e.x+s/2+this._xShake,-e.y+a/2+this._yShake)},e.prototype.debugDraw=function(t){var e=this.getFocus();t.fillStyle="red",t.strokeStyle="white",t.lineWidth=3,t.beginPath(),t.arc(e.x,e.y,15,0,2*Math.PI),t.closePath(),t.stroke(),t.beginPath(),t.arc(e.x,e.y,5,0,2*Math.PI),t.closePath(),t.stroke()},e.prototype._isDoneShaking=function(){return!this._isShaking||this._elapsedShakeTime>=this._shakeDuration},e}(h.Class);e.BaseCamera=g}),i("Interfaces/IAudio",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}),i("Interfaces/IAudioImplementation",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}),i("Resources/Sound",["require","exports","Util/Log","Util/Util","Promises"],function(t,e,i,o,r){"use strict";if(Object.defineProperty(e,"__esModule",{value:!0}),window.AudioContext)var n=new window.AudioContext;var s=function(){function t(){this.responseType="blob"}return t.prototype.processData=function(t){var e=URL.createObjectURL(t);return r.Promise.resolve(e)},t.prototype.createInstance=function(t){return new c(t)},t}();e.AudioTag=s;var a=function(){function t(){this._logger=i.Logger.getInstance(),this.responseType="arraybuffer"}return t.prototype.processData=function(t){var e=this,i=new r.Promise;return n.decodeAudioData(t,function(t){i.resolve(t)},function(){e._logger.error("Unable to decode  this browser may not fully support this format, or the file may be corrupt, if this is an mp3 try removing id3 tags and album art from the file."),i.resolve(void 0)}),i},t.prototype.createInstance=function(t){return new u(t)},t.unlock=function(){if(!t._unlocked&&n){var e=n.createBuffer(1,1,22050),i=n.createBufferSource(),o=!1;i.buffer=e,i.connect(n.destination),i.onended=function(){return o=!0},i.noteOn?i.noteOn(0):i.start(0),setTimeout(function(){if(i.playbackState){var e=i;e.playbackState!==e.PLAYING_STATE&&e.playbackState!==e.FINISHED_STATE||(t._unlocked=!0)}else(n.currentTime>0||o)&&(t._unlocked=!0)},0)}},t.isUnlocked=function(){return this._unlocked},t}();function h(){return window.AudioContext?new a:new s}a._unlocked=!1,e.WebAudio=a,e.getAudioImplementation=h;var l=function(){function t(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];this._logger=i.Logger.getInstance(),this._data=null,this._tracks=[],this._isLoaded=!1,this._isPaused=!1,this._loop=!1,this._volume=1,this.onprogress=function(){},this.oncomplete=function(){},this.onerror=function(){},this._wasPlayingOnHidden=!1,this.path="";for(var r=0,n=e;r<n.length;r++){var s=n[r];if(t.canPlayFile(s)){this.path=s;break}}this.path||(this._logger.warn("This browser does not support any of the audio files specified:",e.join(", ")),this._logger.warn("Attempting to use",e[0]),this.path=e[0]),this.sound=h()}return t.canPlayFile=function(t){try{var e=new Audio,o=t.match(/.*\.([A-Za-z0-9]+)$/)[1];return!!e.canPlayType("audio/"+o)}catch(t){return i.Logger.getInstance().warn("Cannot determine audio support, assuming no support for the Audio Tag",t),!1}},t.prototype.wireEngine=function(t){var e=this;t&&(this._engine=t,this._engine.on("hidden",function(){t.pauseAudioWhenHidden&&e.isPlaying()&&(e._wasPlayingOnHidden=!0,e.pause())}),this._engine.on("visible",function(){t.pauseAudioWhenHidden&&e._wasPlayingOnHidden&&(e.play(),e._wasPlayingOnHidden=!1)}))},t.prototype.instanceCount=function(){return this._tracks.length},t.prototype.setVolume=function(t){this._volume=t;for(var e=0,i=this._tracks;e<i.length;e++)i[e].setVolume(t);this._logger.debug("Set volume for all instances of sound",this.path,"to",t)},t.prototype.setLoop=function(t){this._loop=t;for(var e=0,i=this._tracks;e<i.length;e++)i[e].setLoop(t);this._logger.debug("Set loop for all instances of sound",this.path,"to",t)},t.prototype.isPlaying=function(){return this._tracks.some(function(t){return t.isPlaying()})},t.prototype.play=function(t){var e=this;if(this._isLoaded){for(var i=[],n=0,s=this._tracks;n<s.length;n++){var a=s[n];i.push(a.play())}if(this._isPaused)return this._isPaused=!1,this._logger.debug("Resuming paused instances for sound",this.path,this._tracks),r.Promise.join(i);var h=this.sound.createInstance(this._data);return h.setLoop(this._loop),t?h.setVolume(o.clamp(t,0,1)):h.setVolume(this._volume),this._tracks.push(h),this._logger.debug("Playing new instance for sound",this.path),h.play().then(function(){return e._tracks.splice(e._tracks.indexOf(h),1),!0})}return r.Promise.resolve(!0)},t.prototype.pause=function(){for(var t=0,e=this._tracks;t<e.length;t++)e[t].pause();this._isPaused=!0,this._logger.debug("Paused all instances of sound",this.path)},t.prototype.stop=function(){this._isPaused=!1;for(var t=0,e=this._tracks.concat([]);t<e.length;t++)e[t].stop();this._logger.debug("Stopped all instances of sound",this.path)},t.prototype.isLoaded=function(){return this._isLoaded},t.prototype.load=function(){var t=this,e=new r.Promise;if(this.getData())return this._logger.debug("Already have data for audio resource",this.path),e.resolve(this.sound),this.oncomplete(),e;this._logger.debug("Started loading sound",this.path);try{this._fetchResource(function(i){if(200!==i.status)return t._logger.error("Failed to load audio resource ",t.path," server responded with error code",i.status),t.onerror(i.response),void e.resolve(null);t.setData(i.response).then(function(){t.oncomplete(),t._logger.debug("Completed loading sound",t.path),e.resolve(t.sound)},function(t){return e.resolve(t)})})}catch(t){this._logger.error("Error loading sound! If this is a cross origin error,             you must host your sound with your html and javascript."),this.onerror(t),e.resolve(t)}return e},t.prototype._fetchResource=function(t){var e=new XMLHttpRequest;e.open("GET",this.path,!0),e.responseType=this.sound.responseType,e.onprogress=this.onprogress,e.onerror=this.onerror,e.onload=function(){return t(e)},e.send()},t.prototype.getData=function(){return this._data},t.prototype.setData=function(t){var e=this;return this.sound.processData(t).then(function(t){return e._isLoaded=!0,e._data=e.processData(t),t})},t.prototype.processData=function(t){return t},t}();e.Sound=l;var c=function(){function t(t){this._isPlaying=!1,this._isPaused=!1,this._loop=!1,this._audioElement=new Audio(t)}return t.prototype.isPlaying=function(){return this._isPlaying},Object.defineProperty(t.prototype,"loop",{get:function(){return this._loop},enumerable:!0,configurable:!0}),t.prototype.setLoop=function(t){this._loop=t,this._audioElement.loop=t,this._wireUpOnEnded()},t.prototype.setVolume=function(t){this._audioElement.volume=o.clamp(t,0,1)},t.prototype.play=function(){return this._isPaused?this._resume():this._isPlaying||this._start(),this._playingPromise},t.prototype._start=function(){this._audioElement.load(),this._audioElement.loop=this._loop,this._audioElement.play(),this._isPlaying=!0,this._isPaused=!1,this._playingPromise=new r.Promise,this._wireUpOnEnded()},t.prototype._resume=function(){this._isPaused&&(this._audioElement.play(),this._isPaused=!1,this._isPlaying=!0,this._wireUpOnEnded())},t.prototype.pause=function(){this._isPlaying&&(this._audioElement.pause(),this._isPaused=!0,this._isPlaying=!1)},t.prototype.stop=function(){this._isPlaying&&(this._audioElement.pause(),this._audioElement.currentTime=0,this._handleOnEnded())},t.prototype._wireUpOnEnded=function(){var t=this;this._loop||(this._audioElement.onended=function(){return t._handleOnEnded()})},t.prototype._handleOnEnded=function(){this._isPlaying=!1,this._isPaused=!1,this._playingPromise.resolve(!0)},t}(),u=function(){function t(t){this._buffer=t,this._volumeNode=n.createGain(),this._isPlaying=!1,this._isPaused=!1,this._loop=!1,this._currentOffset=0}return t.prototype.isPlaying=function(){return this._isPlaying},t.prototype.setVolume=function(t){this._volumeNode.gain.setTargetAtTime?this._volumeNode.gain.setTargetAtTime(o.clamp(t,0,1),n.currentTime,0):this._volumeNode.gain.value=o.clamp(t,0,1)},t.prototype.setLoop=function(t){this._loop=t,this._bufferSource&&(this._bufferSource.loop=t,this._wireUpOnEnded())},t.prototype.play=function(){return this._isPaused?this._resume():this._isPlaying||this._start(),this._playingPromise},t.prototype._start=function(){this._volumeNode.connect(n.destination),this._createBufferSource(),this._bufferSource.start(0,0),this._startTime=(new Date).getTime(),this._currentOffset=0,this._isPlaying=!0,this._isPaused=!1,this._playingPromise=new r.Promise,this._wireUpOnEnded()},t.prototype._resume=function(){if(this._isPaused){this._bufferSource.onended=null,this._createBufferSource();var t=1/this._bufferSource.playbackRate.value*this._buffer.duration;this._bufferSource.start(0,this._currentOffset%t),this._isPaused=!1,this._isPlaying=!0,this._wireUpOnEnded()}},t.prototype._createBufferSource=function(){this._bufferSource=n.createBufferSource(),this._bufferSource.buffer=this._buffer,this._bufferSource.loop=this._loop,this._bufferSource.playbackRate.value=1,this._bufferSource.connect(this._volumeNode)},t.prototype.pause=function(){if(this._isPlaying){this._bufferSource.stop(0);var t=1/(this._bufferSource.playbackRate.value||1);this._currentOffset=((new Date).getTime()-this._startTime)*t/1e3,this._isPaused=!0,this._isPlaying=!1}},t.prototype.stop=function(){this._isPlaying&&(this._bufferSource.stop(0),this._bufferSource.onended||this._handleOnEnded(),this._currentOffset=0,this._isPlaying=!1,this._isPaused=!1)},t.prototype._wireUpOnEnded=function(){var t=this;this._loop||(this._bufferSource.onended=function(){return t._handleOnEnded()})},t.prototype._handleOnEnded=function(){this._isPaused||(this._isPlaying=!1,this._playingPromise.resolve(!0))},t}()}),i("Interfaces/ILoader",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}),i("Loader",["require","exports","Drawing/Color","Resources/Sound","Util/Log","Promises","Class","Util/DrawUtil"],function(t,e,i,o,n,s,a,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(t){function e(e){var i=t.call(this)||this;return i._resourceList=[],i._index=0,i._resourceCount=0,i._numLoaded=0,i._progressCounts={},i._totalCounts={},i.logo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdQAAAB2CAYAAABxhGI9AAAACXBIWXMAAAsSAAALEgHS3X78AAAKnUlEQVR42u3dP2wjSx0H8N8hJIonIRmJjsq0SBR+BQ1dcqKhe0lD77SvSwpKkJKGPulpktfRIMUdEqKIqV57rpAokM4dbSiyq7ONPTP7x39ifz7SFbnEnp3xer47O7uzH15fXwMA6OYHmgAABCoACFQAEKgAgEAFAIEKAAIVAAQqACBQAUCgAoBABQCBCgAIVAAQqAAgUAFAoAIAAhUABCoACFQAEKgAgECFLbmOiNeFf2PbAyz68Pr6qhUgbRwR92v+/zwiJrYHMEKFMmcN///UtgcQqFBk1PD/97U9Qx8VCFSgu4EmAIEKAAIVAAQqACBQ4Z25jojP8eX+0WtNAgIVaOY+Im5j+eKh24h41jQgUIEyZ7F5NaPU7wCBCiwYd/w9cOB+qAlgJ3KLLow0EV198803RWvJfvfddx+0lhEqHKu5JgAjVCBvlhmFzjQRXUekHz9+TP79y8uLRjNChXfvoePvAYEKxNtj1e42/O5JoIJABcrdRMRVLM+X3kTEpaaB988cKuzWg9EobTWdMx0Oly8uN4dqhAoARqgnaN3arHfqu7OyH8ItKLVB/P+CEfMTHyGPY3npx1m8zWGDEeoBfUk/xdti57dr/r1Wv2+6EPow3tZ5rRdS72s1neuF97xvWd+XTH0/V+UMttDWqbI/r2nrxfp+jv2uSjSO7S+OXy/A/3lN+9xX5T5HxEUPZZ0tfB71+w57eJ/HFu+z+jkv1u92YX9fbI/HhX3JA9rp5MPr66tWaG9UfUGbrHIzi7cLUyYFf/tpTady03EEeL8mUJ6i7MKYNvWNqr4Pe2jradXO60LrvPAz2PQ5RPX684ah8dxD+2zantnCgVipSVV+m/tgB9W2DDq2Sx/vM95wcHhZhWVJm8yrv58cSgfTdc70+++/X/r522+/tUKSEepBqo+om4ZLPerMjUwuNnQCtx1GWJtee1FwdD5uWd86xLs8UaVt2aNEO1/saZ/Z5rYMW4zq6v34rGV9Bg3q2eZ9SkeNm9qwyUh30OPIHYFKx5FG03C7znSOqYBq+qW/zpQ3anH037TNHluG6f0WPsPhHvab4QFty7ogOeuxDYcNy2/zu2214WNYWxmBurNO8bGn97pNBOO8xy/9uCorZZ4I2r4C7aJgO7ZV9iE49Dm6NvOWx+pWE9CUq3zbdTp9doz38TbXtzqH9RT5CyWe422OaZoZGeZCabrhPQY9HjwsjpTvCg4YtlE2+Ta/j2bzn8fqrDqgm+6yUHOmAvWUjAtGhbNYvsBknDnqH1Qhc7VmxHgeb/NbudA5j/UXlYwif2p6luhAc9teu1npiHKnDs8if6tCm7JLX3NKpgttXe9ruc9mHMd7a83iwdxF5vt8tutARaCeklRnNK9C8WnNF7geJQ4T4XG3JhSnVdilQrG+yOnrlVHfsEGYzhNBn7Lu6tS7+HJafJQ4EMiNlNqWXZ9WPvVgnVYHG5M1ByDXkT6leX2EgTqJtyt45yv7S2qO3sEZjZhDLXeR+YKdJ0Zdk8QocvH9N732KrNtq+FZ/zzIHABcJrYpd+Xv14lOd5ap76SgrduW/VTQ1qcQpqnbgu4ifZvUMNpd9XuoZmvCtPaQ2Y/BCHVLgbrJTeRPDdVf6pfMKDU2fOkHmVFFfXr3MsouLsnNvV5kRoe5+s431PeuoKPqWnaurY/ZPBEeqwceN4l96iwO6H7Mjq4y7VGPVNe10VaZMzVCPVWpI/Z6FZbcv5fMqGCU+dLfFGzj58jP8+bCdJCo7yzKTwdOF0bu9Ug7V4c+yz7FJfYeGoysUss0HssIdVZwYLDujMqlESoCdTtGsZtbHnJBeNdDSJSs0jTKdMJN1HNX54Wv7bvsU9NkVJVa13dX+/wuArV0X/l5RHyo/lnfF4G6p6DrS0kHdtXhy35TGErDPYZUn2WfWqDOo/lVqdMD2O/hKJhD7S/odukymq9s02QN4EEPR/zbaOumZc+r15zK1Zqznl9jsfiemTM1QmV3HUuTkedlg9HIQzRbUD93dfC+2tpj2fIHEH2+RqCCQH13gZq7hWXTNpVu19OB1fc9nQ0AKOKUb5lU0P1kDyOneoWk0lOZ9cIP0x7qu8+2BhCoR2wYu1+e7DmaXzBSsu5vaX1ne2zrpmUPTmxf7PM1Dm4y/vC7ny7Nif7+z/9ZmtM0Z3panPLtPmra9f16bcK0Dpbnwk43Vd/RHtu6zfNQTy1QBy3aqG2g9nVmxml+BOoJyT3NpWmn9xhfFnu4bvDa+44BXhqqfdf3uUF9+yz77AT31Yue2mjecYQ62NLfgkA9ghHqLNEhNem4H1c6vdyDxhf/bpz5m4coW/c39wi6VH2bPtHlcaV9cvXts+zxCe6rTeqc2ndL7uGd93QwM9bFcAzMoZZ7SgTBbWx+asui61h/iq1+RmjqdbnQXQ3T1DNQ63V/U9ucqm/pMzPb1rePsk/1iTOjgvatR4W3Lc8ULB78pELyrnAfeTcj1NU509/86mfJ33/8+Mf00a05UyPUEw7UVCeWG/WNEiExyHRMt5ltW30izUPk18ytt7lNfc8i//DvtvXto+ySA5BjljsLUF8lPkqMPEtW1JomDsiGBZ9Byb4NAvUITSN9GuwsIj6t6UTOqk7jJREkmzqli8xIs96udSO20sX0H1vW92IL9e1a9rgqVyf91gbPsTy9UD9n9lOkT8k+RfkFR5PMNqxOcdSf32PBvg3vilO+zdxE+okx9Wm0ph36XYsRZCpMF993GOk5qvqB3Dct6jvssb67KvuUNJ3frw92bhr8/STSF0JdRPMLpUCgnsgo9S76PZ246ZFk1wWvK5m3vVoYvW1Sz7nN91jfXbQ1ZQc7TW6HeaoOalypG/8/p/rP1aNAc6ZHzSnfdqPUPhdy2PQw6Nz9gSVhuhiqueUHR3uu7y7K3rdDX4u46ZrPbUa0IFBZ0seKQ3XQTRt2vm3W/a2DbNKys++rvm3ep6+y1x2UdP3bWU9lzra47U1GmlctX/sQ23t+aOlByLTh/4NAPaCRxtcdO5HLSJ/6vNtCwGx67VPmPbvWd1q9frKHtp4kAqRJ2HR9j762JfX3bZ//elPtj13PPDx1+D5tqk/Xi6NO8SHz7MmH19dXrdBNfVFP6T2PT1UHNit87/t4m5+aRH+nQBdvqyhZDKJLfZs8h7XPsqdV2ZOV+tanKB8aln0dyxdAXbV4j4gvt4oMOrbP6vbU73NW7TMlbdTnPrWpfqXfh9HKZ9vke7KuTeZRNtXRSe6+1FV//ce/ln5eXfsXgcqXzr6+9261M3moOoa7E6nvTZTfy7iNsmfb7kjfgXGsvxe0vihsEts9HTquPpt1q1vtahu2TqAiUAEEKj0zhwoARqgAu/OnX/442WH+9xc/Wvr58re/Tr7f41/+ZsRqhAoACFQAEKgAcHjMoQJskJsz/eqrr5Z+vvr7v5fmQFevAl5lztQIFQAQqAAgUAHgIJlDBdhgdQ41N2eKESoAIFABQKACwFEwhwoARqgAIFABQKACAAIVAAQqAAhUABCoAIBABQCBCgACFQAEKgAgUAFAoAKAQAUAgQoACFQAEKgAIFABQKACAAIVAAQqAAhUABCoAIBABQCBCgACFQAQqAAgUAFAoAKAQAUAlvwPcFDns1DsH4sAAAAASUVORK5CYII=",i.logoWidth=468,i.logoHeight=118,i.backgroundColor="#176BAA",i.getData=function(){},i.setData=function(){},i.processData=function(){},i.onprogress=function(t){n.Logger.getInstance().debug("[ex.Loader] Loading "+(100*t.loaded/t.total).toFixed(0))},i.oncomplete=function(){},i.onerror=function(){},e&&i.addResources(e),i}return r(e,t),Object.defineProperty(e.prototype,"_image",{get:function(){return this._imageElement||(this._imageElement=new Image,this._imageElement.src=this.logo),this._imageElement},enumerable:!0,configurable:!0}),e.prototype.wireEngine=function(t){this._engine=t},e.prototype.addResource=function(t){var e=this._index++;this._resourceList.push(t),this._progressCounts[e]=0,this._totalCounts[e]=1,this._resourceCount++},e.prototype.addResources=function(t){for(var e=0,i=t.length;e<i;e++)this.addResource(t[e])},e.prototype.isLoaded=function(){return this._numLoaded===this._resourceCount},e.prototype.load=function(){var t=this,e=new s.Promise,i=this;if(0===this._resourceList.length)return i.oncomplete.call(i),e.resolve();var o=new Array(this._resourceList.length),r=this._resourceList.length;return this._resourceList.forEach(function(n,s){t._engine&&n.wireEngine(t._engine),n.onprogress=function(t){var e=t.total,n=t.loaded;o[s]={loaded:n/e*(100/r),total:100};var a=o.reduce(function(t,e){return{loaded:t.loaded+e.loaded,total:100}},{loaded:0,total:100});i.onprogress.call(i,a)},n.oncomplete=n.onerror=function(){i._numLoaded++,i._numLoaded===i._resourceCount&&(i.oncomplete.call(i),e.resolve())}}),function t(e,i){e[i]&&e[i].load().then(function(){t(e,i+1)})}(this._resourceList,0),e},e.prototype.draw=function(t){var e=this._engine.canvasHeight/window.devicePixelRatio,o=this._engine.canvasWidth/window.devicePixelRatio;t.fillStyle=this.backgroundColor,t.fillRect(0,0,o,e);var r=e/2,n=Math.min(this.logoWidth,.75*o),s=o/2-n/2,a=Math.floor(n*(this.logoHeight/this.logoWidth)),l=this._engine.getAntialiasing();this._engine.setAntialiasing(!0),t.drawImage(this._image,0,0,this.logoWidth,this.logoHeight,s,r-a-20,n,a),t.lineWidth=2,h.roundRect(t,s,r,n,20,10);var c=n*(this._numLoaded/this._resourceCount)-10;h.roundRect(t,s+5,r+5,c>0?c:0,10,5,null,i.Color.White),this._engine.setAntialiasing(l)},e.prototype.update=function(t,e){},e}(a.Class);e.Loader=l;var c=function(t){function e(e,i){var r=t.call(this,i)||this;return r._handleOnTrigger=function(){return r._waitPromise.state()===s.PromiseState.Pending&&(o.WebAudio.unlock(),r._waitPromise.resolve(r._loadedValue),r._playTrigger.style.display="none",!1)},r._playTrigger=document.getElementById(e),r._playTrigger.addEventListener("click",r._handleOnTrigger),r}return r(e,t),e.prototype.load=function(){var e=this;return this._waitPromise=new s.Promise,t.prototype.load.call(this).then(function(t){e._loadedValue=t,e._playTrigger.style.display="block"},function(t){e._waitPromise.reject(t)}),this._waitPromise},e}(l);e.PauseAfterLoader=c}),i("Particles",["require","exports","Actor","Drawing/Color","Algebra","Util/Util","Util/DrawUtil","Traits/Index","Configurable","Math/Random"],function(t,e,i,o,n,s,a,h,l,c){"use strict";var u;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.Circle=0]="Circle",t[t.Rectangle=1]="Rectangle"}(u=e.EmitterType||(e.EmitterType={}));var p=function(){function t(t,e,i,r,s,a,h,l,c,u){this.position=new n.Vector(0,0),this.velocity=new n.Vector(0,0),this.acceleration=new n.Vector(0,0),this.particleRotationalVelocity=0,this.currentRotation=0,this.focus=null,this.focusAccel=0,this.opacity=1,this.beginColor=o.Color.White.clone(),this.endColor=o.Color.White.clone(),this.life=300,this.fadeFlag=!1,this._rRate=1,this._gRate=1,this._bRate=1,this._aRate=0,this._currentColor=o.Color.White.clone(),this.emitter=null,this.particleSize=5,this.particleSprite=null,this.sizeRate=0,this.elapsedMultiplier=0;var p=t;if(p&&!(t instanceof g)){var d=t;p=d.emitter,e=d.life,i=d.opacity,s=d.endColor,r=d.beginColor,a=d.position,h=d.velocity,l=d.acceleration,c=d.startSize,u=d.endSize}this.emitter=p,this.life=e||this.life,this.opacity=i||this.opacity,this.endColor=s||this.endColor.clone(),this.beginColor=r||this.beginColor.clone(),this._currentColor=this.beginColor.clone(),this.position=a||this.position,this.velocity=h||this.velocity,this.acceleration=l||this.acceleration,this._rRate=(this.endColor.r-this.beginColor.r)/this.life,this._gRate=(this.endColor.g-this.beginColor.g)/this.life,this._bRate=(this.endColor.b-this.beginColor.b)/this.life,this._aRate=this.opacity/this.life,this.startSize=c||0,this.endSize=u||0,this.endSize>0&&this.startSize>0&&(this.sizeRate=(this.endSize-this.startSize)/this.life,this.particleSize=this.startSize)}return t.prototype.kill=function(){this.emitter.removeParticle(this)},t.prototype.update=function(t){if(this.life=this.life-t,this.elapsedMultiplier=this.elapsedMultiplier+t,this.life<0&&this.kill(),this.fadeFlag&&(this.opacity=s.clamp(this._aRate*this.life,1e-4,1)),this.startSize>0&&this.endSize>0&&(this.particleSize=s.clamp(this.sizeRate*t+this.particleSize,Math.min(this.startSize,this.endSize),Math.max(this.startSize,this.endSize))),this._currentColor.r=s.clamp(this._currentColor.r+this._rRate*t,0,255),this._currentColor.g=s.clamp(this._currentColor.g+this._gRate*t,0,255),this._currentColor.b=s.clamp(this._currentColor.b+this._bRate*t,0,255),this._currentColor.a=s.clamp(this.opacity,1e-4,1),this.focus){var e=this.focus.sub(this.position).normalize().scale(this.focusAccel).scale(t/1e3);this.velocity=this.velocity.add(e)}else this.velocity=this.velocity.add(this.acceleration.scale(t/1e3));this.position=this.position.add(this.velocity.scale(t/1e3)),this.particleRotationalVelocity&&(this.currentRotation=(this.currentRotation+this.particleRotationalVelocity*t/1e3)%(2*Math.PI))},t.prototype.draw=function(t){if(this.particleSprite)return this.particleSprite.rotation=this.currentRotation,this.particleSprite.scale.setTo(this.particleSize,this.particleSize),void this.particleSprite.draw(t,this.position.x,this.position.y);this._currentColor.a=s.clamp(this.opacity,1e-4,1),t.fillStyle=this._currentColor.toString(),t.beginPath(),t.arc(this.position.x,this.position.y,this.particleSize,0,2*Math.PI),t.fill(),t.closePath()},t}();e.ParticleImpl=p;var d=function(t){function e(e,i,o,r,n,s,a,h,l,c){return t.call(this,e,i,o,r,n,s,a,h,l,c)||this}return r(e,t),e}(l.Configurable(p));e.Particle=d;var f=function(t){function e(e,r,a,l){var p=t.call(this,"number"==typeof e?{x:e,y:r,width:a,height:l}:e)||this;p.numParticles=0,p.isEmitting=!0,p.particles=null,p.deadParticles=null,p.minVel=0,p.maxVel=0,p.acceleration=new n.Vector(0,0),p.minAngle=0,p.maxAngle=0,p.emitRate=1,p.particleLife=2e3,p.opacity=1,p.fadeFlag=!1,p.focus=null,p.focusAccel=1,p.startSize=null,p.endSize=null,p.minSize=5,p.maxSize=5,p.beginColor=o.Color.White.clone(),p.endColor=o.Color.White.clone(),p.particleSprite=null,p.emitterType=u.Rectangle,p.radius=0,p.particleRotationalVelocity=0,p.randomRotation=!1,p._particlesToEmit=0,p.collisionType=i.CollisionType.PreventCollision,p.particles=new s.Collection,p.deadParticles=new s.Collection,p.random=new c.Random;for(var d=0;d<p.traits.length;d++)p.traits[d]instanceof h.OffscreenCulling&&p.traits.splice(d,1);return p}return r(e,t),e.prototype.removeParticle=function(t){this.deadParticles.push(t)},e.prototype.emitParticles=function(t){for(var e=0;e<t;e++)this.particles.push(this._createParticle())},e.prototype.clearParticles=function(){this.particles.clear()},e.prototype._createParticle=function(){var t=0,e=0,i=s.randomInRange(this.minAngle,this.maxAngle,this.random),o=s.randomInRange(this.minVel,this.maxVel,this.random),r=this.startSize||s.randomInRange(this.minSize,this.maxSize,this.random),a=o*Math.cos(i),h=o*Math.sin(i);if(this.emitterType===u.Rectangle)t=s.randomInRange(this.pos.x,this.pos.x+this.getWidth(),this.random),e=s.randomInRange(this.pos.y,this.pos.y+this.getHeight(),this.random);else if(this.emitterType===u.Circle){var l=s.randomInRange(0,this.radius,this.random);t=l*Math.cos(i)+this.pos.x,e=l*Math.sin(i)+this.pos.y}var c=new d(this,this.particleLife,this.opacity,this.beginColor,this.endColor,new n.Vector(t,e),new n.Vector(a,h),this.acceleration,this.startSize,this.endSize);return c.fadeFlag=this.fadeFlag,c.particleSize=r,this.particleSprite&&(c.particleSprite=this.particleSprite),c.particleRotationalVelocity=this.particleRotationalVelocity,this.randomRotation&&(c.currentRotation=s.randomInRange(0,2*Math.PI,this.random)),this.focus&&(c.focus=this.focus.add(new n.Vector(this.pos.x,this.pos.y)),c.focusAccel=this.focusAccel),c},e.prototype.update=function(e,i){var o=this;t.prototype.update.call(this,e,i),this.isEmitting&&(this._particlesToEmit+=this.emitRate*(i/1e3),this._particlesToEmit>1&&(this.emitParticles(Math.floor(this._particlesToEmit)),this._particlesToEmit=this._particlesToEmit-Math.floor(this._particlesToEmit))),this.particles.forEach(function(t){return t.update(i)}),this.deadParticles.forEach(function(t){return o.particles.removeElement(t)}),this.deadParticles.clear()},e.prototype.draw=function(t){this.particles.forEach(function(e){return e.draw(t)})},e.prototype.debugDraw=function(e){t.prototype.debugDraw.call(this,e),e.fillStyle=o.Color.Black.toString(),e.fillText("Particles: "+this.particles.count(),this.pos.x,this.pos.y+20),this.focus&&(e.fillRect(this.focus.x+this.pos.x,this.focus.y+this.pos.y,3,3),a.line(e,o.Color.Yellow,this.focus.x+this.pos.x,this.focus.y+this.pos.y,t.prototype.getCenter.call(this).x,t.prototype.getCenter.call(this).y),e.fillText("Focus",this.focus.x+this.pos.x,this.focus.y+this.pos.y))},e}(i.Actor);e.ParticleEmitterImpl=f;var g=function(t){function e(e,i,o,r){return t.call(this,e,i,o,r)||this}return r(e,t),e}(l.Configurable(f));e.ParticleEmitter=g}),i("Actions/Index",["require","exports","Actions/ActionContext","Actions/RotationType","Actions/Action"],function(t,e,i,o,r){"use strict";function n(t){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}Object.defineProperty(e,"__esModule",{value:!0}),n(i),n(o),e.Actions=r,e.Internal={Actions:r}}),i("Collision/IPhysics",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}),i("Collision/NaiveCollisionBroadphase",["require","exports","Physics","Collision/CollisionContact","Collision/Pair","Actor","Events"],function(t,e,i,o,r,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(){this._lastFramePairs=[],this._lastFramePairsHash={}}return t.prototype.track=function(){},t.prototype.untrack=function(){},t.prototype.broadphase=function(t){for(var e,i,s=t.filter(function(t){return!t.isKilled()&&t.collisionType!==n.CollisionType.PreventCollision}),a=[],h=0,l=s.length;h<l;h++){e=s[h];for(var c=h+1;c<l;c++){var u;if(i=s[c],u=e.collides(i)){var p=new r.Pair(e.body,i.body);p.collision=new o.CollisionContact(e.collisionArea,i.collisionArea,u,e.pos,u),a.some(function(t){return t.id===p.id})||a.push(p)}}}return a},t.prototype.narrowphase=function(t){return t},t.prototype.runCollisionStartEnd=function(t){for(var e={},i=0,o=t;i<o.length;i++)if(e[(l=o[i]).id]=l,!this._lastFramePairsHash[l.id]){var r=l.bodyA.actor,n=l.bodyB.actor;r.emit("collisionstart",new s.CollisionStartEvent(r,n,l)),n.emit("collisionstart",new s.CollisionStartEvent(n,r,l))}for(var a=0,h=this._lastFramePairs;a<h.length;a++){var l;e[(l=h[a]).id]||(r=l.bodyA.actor,n=l.bodyB.actor,r.emit("collisionend",new s.CollisionEndEvent(r,n)),n.emit("collisionend",new s.CollisionEndEvent(n,r)))}this._lastFramePairs=t,this._lastFramePairsHash=e},t.prototype.resolve=function(t){for(var e=0,o=t;e<o.length;e++)o[e].resolve(i.Physics.collisionResolutionStrategy);return t.filter(function(t){return t.canCollide})},t.prototype.update=function(){return 0},t.prototype.debugDraw=function(){},t}();e.NaiveCollisionBroadphase=a}),i("Collision/Index",["require","exports","Collision/Body","Collision/BoundingBox","Collision/CircleArea","Collision/CollisionContact","Collision/CollisionJumpTable","Collision/DynamicTree","Collision/DynamicTreeCollisionBroadphase","Collision/EdgeArea","Collision/NaiveCollisionBroadphase","Collision/Pair","Collision/PolygonArea","Collision/Side"],function(t,e,i,o,r,n,s,a,h,l,c,u,p,d){"use strict";function f(t){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}Object.defineProperty(e,"__esModule",{value:!0}),f(i),f(o),f(r),f(n),f(s),f(a),f(h),f(l),f(c),f(u),f(p),f(d)}),i("Drawing/Polygon",["require","exports","Algebra"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t){this.lineWidth=5,this.filled=!1,this._points=[],this.anchor=new i.Vector(0,0),this.rotation=0,this.scale=new i.Vector(1,1),this._points=t;var e=this._points.reduce(function(t,e){return Math.min(t,e.x)},0),o=this._points.reduce(function(t,e){return Math.max(t,e.x)},0);this.drawWidth=o-e;var r=this._points.reduce(function(t,e){return Math.min(t,e.y)},0),n=this._points.reduce(function(t,e){return Math.max(t,e.y)},0);this.drawHeight=n-r,this.height=this.drawHeight,this.width=this.drawWidth}return t.prototype.addEffect=function(){},t.prototype.removeEffect=function(){},t.prototype.clearEffects=function(){},t.prototype.reset=function(){},t.prototype.draw=function(t,e,i){t.save(),t.translate(e+this.anchor.x,i+this.anchor.y),t.scale(this.scale.x,this.scale.y),t.rotate(this.rotation),t.beginPath(),t.lineWidth=this.lineWidth;var o=this._points[0];t.moveTo(o.x,o.y);for(var r=0,n=this._points.length;r<n;r++)t.lineTo(this._points[r].x,this._points[r].y);t.lineTo(o.x,o.y),t.closePath(),this.filled&&(t.fillStyle=this.fillColor.toString(),t.fill()),t.strokeStyle=this.lineColor.toString(),this.flipHorizontal&&(t.translate(this.drawWidth,0),t.scale(-1,1)),this.flipVertical&&(t.translate(0,this.drawHeight),t.scale(1,-1)),t.stroke(),t.restore()},t}();e.Polygon=o}),i("Drawing/Index",["require","exports","Drawing/Animation","Drawing/Color","Drawing/Polygon","Drawing/Sprite","Drawing/SpriteSheet","Drawing/SpriteEffects"],function(t,e,i,o,r,n,s,a){"use strict";function h(t){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}Object.defineProperty(e,"__esModule",{value:!0}),e.Animation=i.Animation,h(o),h(r),e.Sprite=n.Sprite,e.SpriteSheet=s.SpriteSheet,e.SpriteFont=s.SpriteFont,e.Effects=a}),i("Interfaces/IPointerEvents",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}),i("Interfaces/Index",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}),i("Math/PerlinNoise",["require","exports","Math/Random","Drawing/Color","Util/Util"],function(t,e,i,o,r){"use strict";function n(t,e,i){return e+t*(i-e)}function s(t){return t*t*t*(t*(6*t-15)+10)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t){this._perm=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],this._p=new Uint8Array(512),this._defaultPerlinOptions={octaves:1,frequency:1,amplitude:1,persistance:.5},t=r.extend({},this._defaultPerlinOptions,t),this.persistance=t.persistance,this.amplitude=t.amplitude,this.frequency=t.frequency,this.octaves=t.octaves,t.seed?this._random=new i.Random(t.seed):this._random=new i.Random,this._perm=this._random.shuffle(this._perm);for(var e=0;e<512;e++)this._p[e]=255&this._perm[e%256]}return t.prototype.noise=function(){for(var t=this.amplitude,e=this.frequency,i=0,o=0,r=0;r<this.octaves;r++){switch(arguments.length){case 1:i+=this._noise1d(arguments[0]*e)*t;break;case 2:i+=this._noise2d(arguments[0]*e,arguments[1]*e)*t;break;case 3:i+=this._noise3d(arguments[0]*e,arguments[1]*e,arguments[2]*e)*t;break;default:throw new Error("Invalid arguments for perlin noise")}o+=t,t*=this.persistance,e*=2}return i/o},t.prototype.sequence=function(t,e){e||(e=1/t);for(var i=new Array(t),o=0;o<t;o++)i[o]=this.noise(o*e);return i},t.prototype.grid=function(t,e,i){i||(i=1/Math.min(t,e));for(var o=new Array(t*e),r=0;r<e;r++)for(var n=0;n<t;n++)o[n+r*t]=this.noise(n*i,r*i);return o},t.prototype._gradient3d=function(t,e,i,o){var r=15&t,n=r<8?e:i,s=r<4?i:12===r||14===r?e:o;return(0==(1&r)?n:-n)+(0==(2&r)?s:-s)},t.prototype._gradient2d=function(t,e,i){var o=0==(1&t)?e:i;return 0==(2&t)?-o:o},t.prototype._gradient1d=function(t,e){return 0==(1&t)?-e:e},t.prototype._noise1d=function(t){var e=255&Math.floor(t);return(n(s(t-=Math.floor(t)),this._gradient1d(this._p[e],t),this._gradient1d(this._p[e+1],t-1))+1)/2},t.prototype._noise2d=function(t,e){var i=255&Math.floor(t),o=255&Math.floor(e);t-=Math.floor(t),e-=Math.floor(e);var r=s(t),a=s(e),h=this._p[i]+o,l=this._p[i+1]+o;return(n(a,n(r,this._gradient2d(this._p[h],t,e),this._gradient2d(this._p[l],t-1,e)),n(r,this._gradient2d(this._p[h+1],t,e-1),this._gradient2d(this._p[l+1],t-1,e-1)))+1)/2},t.prototype._noise3d=function(t,e,i){var o=255&Math.floor(t),r=255&Math.floor(e),a=255&Math.floor(i);t-=Math.floor(t),e-=Math.floor(e),i-=Math.floor(i);var h=s(t),l=s(e),c=s(i),u=this._p[o]+r,p=this._p[o+1]+r,d=this._p[u]+a,f=this._p[p]+a,g=this._p[u+1]+a,y=this._p[p+1]+a;return(n(c,n(l,n(h,this._gradient3d(this._p[d],t,e,i),this._gradient3d(this._p[f],t-1,e,i)),n(h,this._gradient3d(this._p[g],t,e-1,i),this._gradient3d(this._p[y],t-1,e-1,i))),n(l,n(h,this._gradient3d(this._p[d+1],t,e,i-1),this._gradient3d(this._p[f+1],t-1,e,i-1)),n(h,this._gradient3d(this._p[g+1],t,e-1,i-1),this._gradient3d(this._p[y+1],t-1,e-1,i-1))))+1)/2},t}();e.PerlinGenerator=a;var h=function(){function t(t,e){this.generator=t,this.colorFcn=e,e||(this.colorFcn=function(t){return t<125?o.Color.Black:o.Color.White})}return t.prototype.image=function(t,e){var i=document.createElement("img"),o=document.createElement("canvas");o.width=t,o.height=e;var r=o.getContext("2d");return this.draw(r,0,0,t,e),i.src=o.toDataURL(),i},t.prototype.draw=function(t,e,i,o,r){for(var n=this.generator.grid(o,r),s=t.getImageData(e,i,o,r),a=0;a<r;a++)for(var h=0;h<o;h++){var l=n[h+o*a],c=255&Math.floor(255*l),u=4*(h+a*s.width),p=this.colorFcn(c);s.data[u]=p.r,s.data[u+1]=p.g,s.data[u+2]=p.b,s.data[u+3]=Math.floor(255*p.a)}t.putImageData(s,e,i)},t}();e.PerlinDrawer2D=h}),i("Math/Index",["require","exports","Math/PerlinNoise","Math/Random"],function(t,e,i,o){"use strict";function r(t){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}Object.defineProperty(e,"__esModule",{value:!0}),r(i),r(o)}),i("PostProcessing/IPostProcessor",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}),i("PostProcessing/ColorBlindCorrector",["require","exports","Util/Log"],function(t,e,i){"use strict";var o;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.Protanope=0]="Protanope",t[t.Deuteranope=1]="Deuteranope",t[t.Tritanope=2]="Tritanope"}(o=e.ColorBlindness||(e.ColorBlindness={}));var r=function(){function t(t,e,r){void 0===e&&(e=!1),void 0===r&&(r=o.Protanope),this.engine=t,this.simulate=e,this.colorMode=r,this._vertexShader="attribute vec2 a_position;attribute vec2 a_texCoord;uniform vec2 u_resolution;varying vec2 v_texCoord;void main() {vec2 zeroToOne = a_position / u_resolution;vec2 zeroToTwo = zeroToOne * 2.0;vec2 clipSpace = zeroToTwo - 1.0;gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);v_texCoord = a_texCoord;}",this._fragmentShader="precision mediump float;uniform sampler2D u_image;varying vec2 v_texCoord;void main() {vec4 o =  texture2D(u_image, v_texCoord);float L = (17.8824 * o.r) + (43.5161 * o.g) + (4.11935 * o.b);float M = (3.45565 * o.r) + (27.1554 * o.g) + (3.86714 * o.b);float S = (0.0299566 * o.r) + (0.184309 * o.g) + (1.46709 * o.b);//MODE CODE//vec4 error;error.r = (0.0809444479 * l) + (-0.130504409 * m) + (0.116721066 * s);error.g = (-0.0102485335 * l) + (0.0540193266 * m) + (-0.113614708 * s);error.b = (-0.000365296938 * l) + (-0.00412161469 * m) + (0.693511405 * s);error.a = 1.0;vec4 diff = o - error;vec4 correction;correction.r = 0.0;correction.g =  (diff.r * 0.7) + (diff.g * 1.0);correction.b =  (diff.r * 0.7) + (diff.b * 1.0);correction = o + correction;correction.a = o.a;//SIMULATE//}",this._internalCanvas=document.createElement("canvas"),this._internalCanvas.width=t.drawWidth,this._internalCanvas.height=t.drawHeight,this._gl=this._internalCanvas.getContext("webgl",{preserveDrawingBuffer:!0}),this._program=this._gl.createProgram();var n=this._getShader("Fragment",this._getFragmentShaderByMode(r)),s=this._getShader("Vertex",this._vertexShader);this._gl.attachShader(this._program,s),this._gl.attachShader(this._program,n),this._gl.linkProgram(this._program),this._gl.getProgramParameter(this._program,this._gl.LINK_STATUS)||i.Logger.getInstance().error("Unable to link shader program!"),this._gl.useProgram(this._program)}return t.prototype._getFragmentShaderByMode=function(t){var e="";return t===o.Protanope?e="float l = 0.0 * L + 2.02344 * M + -2.52581 * S;float m = 0.0 * L + 1.0 * M + 0.0 * S;float s = 0.0 * L + 0.0 * M + 1.0 * S;":t===o.Deuteranope?e="float l = 1.0 * L + 0.0 * M + 0.0 * S;float m = 0.494207 * L + 0.0 * M + 1.24827 * S;float s = 0.0 * L + 0.0 * M + 1.0 * S;":t===o.Tritanope&&(e="float l = 1.0 * L + 0.0 * M + 0.0 * S;float m = 0.0 * L + 1.0 * M + 0.0 * S;float s = -0.395913 * L + 0.801109 * M + 0.0 * S;"),this.simulate?this._fragmentShader=this._fragmentShader.replace("//SIMULATE//","gl_FragColor = error.rgba;"):this._fragmentShader=this._fragmentShader.replace("//SIMULATE//","gl_FragColor = correction.rgba;"),this._fragmentShader.replace("//MODE CODE//",e)},t.prototype._setRectangle=function(t,e,i,o){var r=t,n=t+i,s=e,a=e+o;this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array([r,s,n,s,r,a,r,a,n,s,n,a]),this._gl.STATIC_DRAW)},t.prototype._getShader=function(t,e){var o;return"Fragment"===t?o=this._gl.createShader(this._gl.FRAGMENT_SHADER):"Vertex"===t?o=this._gl.createShader(this._gl.VERTEX_SHADER):i.Logger.getInstance().error("Error unknown shader type",t),this._gl.shaderSource(o,e),this._gl.compileShader(o),this._gl.getShaderParameter(o,this._gl.COMPILE_STATUS)?o:(i.Logger.getInstance().error("Unable to compile shader!",this._gl.getShaderInfoLog(o)),null)},t.prototype.process=function(t,e){var i=this._gl.getAttribLocation(this._program,"a_position"),o=this._gl.getAttribLocation(this._program,"a_texCoord"),r=this._gl.createBuffer();this._gl.bindBuffer(this._gl.ARRAY_BUFFER,r),this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),this._gl.STATIC_DRAW),this._gl.enableVertexAttribArray(o),this._gl.vertexAttribPointer(o,2,this._gl.FLOAT,!1,0,0);var n=this._gl.createTexture();this._gl.bindTexture(this._gl.TEXTURE_2D,n),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,1),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t);var s=this._gl.getUniformLocation(this._program,"u_resolution");this._gl.uniform2f(s,this._internalCanvas.width,this._internalCanvas.height);var a=this._gl.createBuffer();this._gl.bindBuffer(this._gl.ARRAY_BUFFER,a),this._gl.enableVertexAttribArray(i),this._gl.vertexAttribPointer(i,2,this._gl.FLOAT,!1,0,0),this._setRectangle(0,0,t.width,t.height),this._gl.drawArrays(this._gl.TRIANGLES,0,6);var h=new Uint8Array(t.width*t.height*4);this._gl.readPixels(0,0,t.width,t.height,this._gl.RGBA,this._gl.UNSIGNED_BYTE,h),t.data.set(h),e.putImageData(t,0,0)},t}();e.ColorBlindCorrector=r}),i("PostProcessing/Index",["require","exports","PostProcessing/ColorBlindCorrector"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}(i)}),i("Resources/Index",["require","exports","Resources/Resource","Resources/Sound","Resources/Texture"],function(t,e,i,o,r){"use strict";function n(t){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}Object.defineProperty(e,"__esModule",{value:!0}),n(i),n(o),n(r)}),i("Util/Index",["require","exports","Util/Util","Util/DrawUtil"],function(t,e,i,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}(i),e.DrawUtil=o}),i("Util/Detector",["require","exports","Util/Log"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o={webgl:"WebGL",webaudio:"WebAudio",gamepadapi:"Gamepad API"},r=function(){function t(){this._features=null,this.failedTests=[],this._criticalTests={canvasSupport:function(){var t=document.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))},arrayBufferSupport:function(){var t=new XMLHttpRequest;t.open("GET","/");try{t.responseType="arraybuffer"}catch(t){return!1}return"arraybuffer"===t.responseType},dataUrlSupport:function(){return 0===document.createElement("canvas").toDataURL("image/png").indexOf("data:image/png")},objectUrlSupport:function(){return"URL"in window&&"revokeObjectURL"in URL&&"createObjectURL"in URL},rgbaSupport:function(){var t=document.createElement("a").style;return t.cssText="background-color:rgba(150,255,150,.5)",(""+t.backgroundColor).indexOf("rgba")>-1}},this._warningTest={webAudioSupport:function(){return!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext)},webglSupport:function(){var t=document.createElement("canvas");return!(!t.getContext||!t.getContext("webgl"))}},this._features=this._loadBrowserFeatures()}return t.prototype.getBrowserFeatures=function(){return null===this._features&&(this._features=this._loadBrowserFeatures()),this._features},t.prototype.logBrowserFeatures=function(){for(var t="%cSUPPORTED BROWSER FEATURES\n==========================%c\n",e=["font-weight: bold; color: navy","font-weight: normal; color: inherit"],i=this.getBrowserFeatures(),r=0,n=Object.keys(o);r<n.length;r++){var s=n[r];i[s]?(t+="(%c✓%c)",e.push("font-weight: bold; color: green"),e.push("font-weight: normal; color: inherit")):(t+="(%c✗%c)",e.push("font-weight: bold; color: red"),e.push("font-weight: normal; color: inherit")),t+=" "+o[s]+"\n"}e.unshift(t),console.log.apply(console,e)},t.prototype._loadBrowserFeatures=function(){var t=this;return{canvas:t._criticalTests.canvasSupport(),arraybuffer:t._criticalTests.arrayBufferSupport(),dataurl:t._criticalTests.dataUrlSupport(),objecturl:t._criticalTests.objectUrlSupport(),rgba:t._criticalTests.rgbaSupport(),webaudio:t._warningTest.webAudioSupport(),webgl:t._warningTest.webglSupport(),gamepadapi:!!navigator.getGamepads}},t.prototype.test=function(){var t=!1;for(var e in this._criticalTests)this._criticalTests[e].call(this)||(this.failedTests.push(e),i.Logger.getInstance().error("Critical browser feature missing, Excalibur requires:",e),t=!0);if(t)return!1;for(var o in this._warningTest)this._warningTest[o]()||i.Logger.getInstance().warn("Warning browser feature missing, Excalibur will have reduced performance:",o);return!0},t}();e.Detector=r}),i("Index",["require","exports","Actor","Algebra","Camera","Class","Configurable","Debug","Engine","EventDispatcher","Events","Group","Label","Loader","Particles","Physics","Promises","Scene","TileMap","Timer","Trigger","UIActor","Actions/Index","Collision/Index","Drawing/Index","Math/Index","PostProcessing/Index","Resources/Index","Events","Input/Index","Traits/Index","Util/Index","Util/Decorators","Util/Detector","Util/CullingBox","Util/EasingFunctions","Util/Log","Util/SortedList"],function(t,e,i,o,r,n,s,a,h,l,c,u,p,d,f,g,y,_,v,m,b,w,x,P,C,S,A,E,T,M,D,O,I,B,R,k,F,L){"use strict";function U(t){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}Object.defineProperty(e,"__esModule",{value:!0}),e.EX_VERSION="0.16.0",e.Actor=i.Actor,e.CollisionType=i.CollisionType,U(o),U(r),U(n),U(s),U(a),U(h),U(l),U(c),U(u),e.Label=p.Label,e.FontStyle=p.FontStyle,e.FontUnit=p.FontUnit,e.TextAlign=p.TextAlign,e.BaseAlign=p.BaseAlign,U(d),e.Particle=f.Particle,e.ParticleEmitter=f.ParticleEmitter,e.EmitterType=f.EmitterType,U(g),U(y),U(_),e.TileMap=v.TileMap,e.Cell=v.Cell,e.TileSprite=v.TileSprite,U(m),U(b),U(w),U(x),U(P),U(C),U(S),U(A),U(E),e.Events=T,e.Input=M,e.Traits=D,e.Util=O,U(I),U(B),U(R),U(k),U(F),U(L)}),i("Engine",["require","exports","Index","Promises","Algebra","UIActor","Actor","Timer","TileMap","Loader","Util/Detector","Events","Util/Log","Drawing/Color","Scene","Debug","Class","Input/Index","Util/Util","Collision/BoundingBox"],function(t,e,i,o,n,s,a,h,l,c,u,p,d,f,g,y,_,v,m,b){"use strict";var w,x;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.FullScreen=0]="FullScreen",t[t.Container=1]="Container",t[t.Fixed=2]="Fixed",t[t.Position=3]="Position"}(w=e.DisplayMode||(e.DisplayMode={})),function(t){t[t.None=0]="None",t[t.Canvas=1]="Canvas",t[t.All=2]="All"}(x=e.ScrollPreventionMode||(e.ScrollPreventionMode={}));var P=function(t){function e(o){var r=t.call(this)||this;r._hasStarted=!1,r.debug=new y.Debug,r.postProcessors=[],r.scenes={},r._animations=[],r.isFullscreen=!1,r.displayMode=w.FullScreen,r._suppressHiDPIScaling=!1,r.pauseAudioWhenHidden=!0,r.isDebug=!1,r.debugColor=new f.Color(255,255,255),r.onFatalException=function(t){d.Logger.getInstance().fatal(t)},r._isSmoothingEnabled=!0,r._timescale=1,r._isLoading=!1,r._isInitialized=!1,o=m.extend({},e._DefaultEngineOptions,o);var n=new u.Detector;if(!o.suppressMinimumBrowserFeatureDetection&&!(r._compatible=n.test())){var s=document.createElement("div");if(s.innerText="Sorry, your browser does not support all the features needed for Excalibur",document.body.appendChild(s),n.failedTests.forEach(function(t){var e=document.createElement("div");e.innerText="Browser feature missing "+t,document.body.appendChild(e)}),o.canvasElementId){var a=document.getElementById(o.canvasElementId);a&&a.parentElement.removeChild(a)}return r}return r._compatible=!0,console.log&&!o.suppressConsoleBootMessage&&(console.log("%cPowered by Excalibur.js (v"+i.EX_VERSION+")","background: #176BAA; color: white; border-radius: 5px; padding: 15px; font-size: 1.5em; line-height: 80px;"),console.log("\n      /| ________________\nO|===|* >________________>\n      \\|"),console.log("Visit","http://excaliburjs.com","for more information")),r._logger=d.Logger.getInstance(),r._logger.defaultLevel===d.LogLevel.Debug&&n.logBrowserFeatures(),r._logger.debug("Building engine..."),r.canvasElementId=o.canvasElementId,o.canvasElementId?(r._logger.debug("Using Canvas element specified: "+o.canvasElementId),r.canvas=document.getElementById(o.canvasElementId)):(r._logger.debug("Using generated canvas element"),r.canvas=document.createElement("canvas")),o.width&&o.height?(void 0===o.displayMode&&(r.displayMode=w.Fixed),r._logger.debug("Engine viewport is size "+o.width+" x "+o.height),r.canvas.width=o.width,r.canvas.height=o.height):o.displayMode||(r._logger.debug("Engine viewport is fullscreen"),r.displayMode=w.FullScreen),o.backgroundColor&&(r.backgroundColor=o.backgroundColor.clone()),r._loader=new c.Loader,r._initialize(o),r.rootScene=r.currentScene=new g.Scene(r),r.addScene("root",r.rootScene),r.goToScene("root"),r}return r(e,t),Object.defineProperty(e.prototype,"canvasWidth",{get:function(){return this.canvas.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"halfCanvasWidth",{get:function(){return this.canvas.width/2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvasHeight",{get:function(){return this.canvas.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"halfCanvasHeight",{get:function(){return this.canvas.height/2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"drawWidth",{get:function(){return this.currentScene&&this.currentScene.camera?this.canvasWidth/this.currentScene.camera.getZoom()/this.pixelRatio:this.canvasWidth/this.pixelRatio},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"halfDrawWidth",{get:function(){return this.drawWidth/2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"drawHeight",{get:function(){return this.currentScene&&this.currentScene.camera?this.canvasHeight/this.currentScene.camera.getZoom()/this.pixelRatio:this.canvasHeight/this.pixelRatio},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"halfDrawHeight",{get:function(){return this.drawHeight/2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isHiDpi",{get:function(){return 1!==this.pixelRatio},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stats",{get:function(){return this.debug.stats},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pixelRatio",{get:function(){return this._suppressHiDPIScaling?1:window.devicePixelRatio||1},enumerable:!0,configurable:!0}),e.prototype.on=function(e,i){t.prototype.on.call(this,e,i)},e.prototype.once=function(e,i){t.prototype.once.call(this,e,i)},e.prototype.off=function(e,i){t.prototype.off.call(this,e,i)},e.prototype.getWorldBounds=function(){var t=this.screenToWorldCoordinates(n.Vector.Zero).x,e=this.screenToWorldCoordinates(n.Vector.Zero).y,i=t+this.drawWidth,o=e+this.drawHeight;return new b.BoundingBox(t,e,i,o)},Object.defineProperty(e.prototype,"timescale",{get:function(){return this._timescale},set:function(t){t<=0?d.Logger.getInstance().error("Cannot set engine.timescale to a value of 0 or less than 0."):this._timescale=t},enumerable:!0,configurable:!0}),e.prototype.playAnimation=function(t,e,i){this._animations.push(new C(t,e,i))},e.prototype.addTileMap=function(t){this.currentScene.addTileMap(t)},e.prototype.removeTileMap=function(t){this.currentScene.removeTileMap(t)},e.prototype.addTimer=function(t){return this.currentScene.addTimer(t)},e.prototype.removeTimer=function(t){return this.currentScene.removeTimer(t)},e.prototype.addScene=function(t,e){this.scenes[t]&&this._logger.warn("Scene",t,"already exists overwriting"),this.scenes[t]=e,e.engine=this},e.prototype.removeScene=function(t){if(t instanceof g.Scene)for(var e in this.scenes)this.scenes.hasOwnProperty(e)&&this.scenes[e]===t&&delete this.scenes[e];"string"==typeof t&&delete this.scenes[t]},e.prototype.add=function(t){t instanceof s.UIActor?this.currentScene.addUIActor(t):(t instanceof a.Actor&&this._addChild(t),t instanceof h.Timer&&this.addTimer(t),t instanceof l.TileMap&&this.addTileMap(t),2===arguments.length&&this.addScene(arguments[0],arguments[1]))},e.prototype.remove=function(t){t instanceof s.UIActor?this.currentScene.removeUIActor(t):(t instanceof a.Actor&&this._removeChild(t),t instanceof h.Timer&&this.removeTimer(t),t instanceof l.TileMap&&this.removeTileMap(t),t instanceof g.Scene&&this.removeScene(t),"string"==typeof t&&this.removeScene(t))},e.prototype._addChild=function(t){this.currentScene.add(t)},e.prototype._removeChild=function(t){this.currentScene.remove(t)},e.prototype.goToScene=function(t){if(this.scenes[t]){var e=this.currentScene,i=this.scenes[t];this._logger.debug("Going to scene:",t),this.currentScene.isInitialized&&(this.currentScene._deactivate.call(this.currentScene,[e,i]),this.currentScene.eventDispatcher.emit("deactivate",new p.DeactivateEvent(i,this.currentScene))),this.currentScene=i,this.currentScene._initialize(this),this.currentScene._activate.call(this.currentScene,[e,i]),this.currentScene.eventDispatcher.emit("activate",new p.ActivateEvent(e,this.currentScene))}else this._logger.error("Scene",t,"does not exist!")},e.prototype.screenToWorldCoordinates=function(t){var e=t.x,i=t.y;if(e=e/this.canvas.clientWidth*this.drawWidth,i=i/this.canvas.clientHeight*this.drawHeight,e-=this.halfDrawWidth,i-=this.halfDrawHeight,this.currentScene&&this.currentScene.camera){var o=this.currentScene.camera.getFocus();e+=o.x,i+=o.y}return new n.Vector(Math.floor(e),Math.floor(i))},e.prototype.worldToScreenCoordinates=function(t){var e=t.x,i=t.y;if(this.currentScene&&this.currentScene.camera){var o=this.currentScene.camera.getFocus();e-=o.x,i-=o.y}return e+=this.halfDrawWidth,i+=this.halfDrawHeight,e=e*this.canvas.clientWidth/this.drawWidth,i=i*this.canvas.clientHeight/this.drawHeight,new n.Vector(Math.floor(e),Math.floor(i))},e.prototype._setHeightByDisplayMode=function(t){this.displayMode===w.Container&&(this.canvas.width=t.clientWidth,this.canvas.height=t.clientHeight),this.displayMode===w.FullScreen&&(document.body.style.margin="0px",document.body.style.overflow="hidden",this.canvas.width=t.innerWidth,this.canvas.height=t.innerHeight)},e.prototype._initialize=function(t){var e,i,o=this;if(t.displayMode&&(this.displayMode=t.displayMode),this.displayMode===w.FullScreen||this.displayMode===w.Container){var r=this.displayMode===w.Container?this.canvas.parentElement||document.body:window;this._setHeightByDisplayMode(r),window.addEventListener("resize",function(){o._logger.debug("View port resized"),o._setHeightByDisplayMode(r),o._logger.info("parent.clientHeight "+r.clientHeight),o.setAntialiasing(o._isSmoothingEnabled)})}else this.displayMode===w.Position&&this._intializeDisplayModePosition(t);this.input={keyboard:new v.Keyboard,pointers:new v.Pointers(this),gamepads:new v.Gamepads},this.input.keyboard.init(),this.input.pointers.init(t&&t.pointerScope===v.PointerScope.Document?document:this.canvas),this.input.gamepads.init(),this.pageScrollPreventionMode=t.scrollPreventionMode,void 0!==document.hidden?(e="hidden",i="visibilitychange"):"msHidden"in document?(e="msHidden",i="msvisibilitychange"):"webkitHidden"in document&&(e="webkitHidden",i="webkitvisibilitychange"),document.addEventListener(i,function(){document[e]?(o.eventDispatcher.emit("hidden",new p.HiddenEvent(o)),o._logger.debug("Window hidden")):(o.eventDispatcher.emit("visible",new p.VisibleEvent(o)),o._logger.debug("Window visible"))}),this.ctx=this.canvas.getContext("2d"),this._suppressHiDPIScaling=!!t.suppressHiDPIScaling,t.suppressHiDPIScaling||this._initializeHiDpi(),this.canvasElementId||document.body.appendChild(this.canvas)},e.prototype.onInitialize=function(t){},e.prototype._intializeDisplayModePosition=function(t){if(!t.position)throw new Error("DisplayMode of Position was selected but no position option was given");if(this.canvas.style.display="block",this.canvas.style.position="absolute","string"==typeof t.position){var e=t.position.split(" ");switch(e[0]){case"top":this.canvas.style.top="0px";break;case"bottom":this.canvas.style.bottom="0px";break;case"middle":this.canvas.style.top="50%";var i=-this.halfDrawHeight;this.canvas.style.marginTop=i.toString();break;default:throw new Error("Invalid Position Given")}if(e[1])switch(e[1]){case"left":this.canvas.style.left="0px";break;case"right":this.canvas.style.right="0px";break;case"center":this.canvas.style.left="50%";var o=-this.halfDrawWidth;this.canvas.style.marginLeft=o.toString();break;default:throw new Error("Invalid Position Given")}}else t.position.top&&("number"==typeof t.position.top?this.canvas.style.top=t.position.top.toString()+"px":this.canvas.style.top=t.position.top),t.position.right&&("number"==typeof t.position.right?this.canvas.style.right=t.position.right.toString()+"px":this.canvas.style.right=t.position.right),t.position.bottom&&("number"==typeof t.position.bottom?this.canvas.style.bottom=t.position.bottom.toString()+"px":this.canvas.style.bottom=t.position.bottom),t.position.left&&("number"==typeof t.position.left?this.canvas.style.left=t.position.left.toString()+"px":this.canvas.style.left=t.position.left)},e.prototype._initializeHiDpi=function(){if(this.isHiDpi){var t=this.canvas.width,e=this.canvas.height;this.canvas.width=t*this.pixelRatio,this.canvas.height=e*this.pixelRatio,this.canvas.style.width=t+"px",this.canvas.style.height=e+"px",this._logger.warn("Hi DPI screen detected, resetting canvas resolution from \n                           "+t+"x"+e+" to "+this.canvas.width+"x"+this.canvas.height+" \n                           css size will remain "+t+"x"+e),this.ctx.scale(this.pixelRatio,this.pixelRatio),this._logger.warn("Canvas drawing context was scaled by "+this.pixelRatio)}},e.prototype.setAntialiasing=function(t){this._isSmoothingEnabled=t;var e=this.ctx;e.imageSmoothingEnabled=t;for(var i=0,o=["webkitImageSmoothingEnabled","mozImageSmoothingEnabled","msImageSmoothingEnabled"];i<o.length;i++){var r=o[i];r in e&&(e[r]=t)}},e.prototype.getAntialiasing=function(){return this.ctx.imageSmoothingEnabled||this.ctx.webkitImageSmoothingEnabled||this.ctx.mozImageSmoothingEnabled||this.ctx.msImageSmoothingEnabled},Object.defineProperty(e.prototype,"isInitialized",{get:function(){return this._isInitialized},enumerable:!0,configurable:!0}),e.prototype._overrideInitialize=function(e){this.isInitialized||(this.onInitialize(e),t.prototype.emit.call(this,"initialize",new p.InitializeEvent(e,this)),this._isInitialized=!0)},e.prototype._update=function(t){if(this._isLoading)return this._loader.update(this,t),this.input.keyboard.update(),this.input.pointers.update(),void this.input.gamepads.update();this._overrideInitialize(this),this._preupdate(t),this.currentScene.update(this,t),this._animations=this._animations.filter(function(t){return!t.animation.isDone()}),this.input.keyboard.update(),this.input.pointers.update(),this.input.gamepads.update(),this._postupdate(t)},e.prototype._preupdate=function(t){this.emit("preupdate",new p.PreUpdateEvent(this,t,this)),this.onPreUpdate(this,t)},e.prototype.onPreUpdate=function(t,e){},e.prototype._postupdate=function(t){this.emit("postupdate",new p.PostUpdateEvent(this,t,this)),this.onPostUpdate(this,t)},e.prototype.onPostUpdate=function(t,e){},e.prototype._draw=function(t){var e=this.ctx;if(this._predraw(e,t),this._isLoading)this._loader.draw(e,t);else{e.clearRect(0,0,this.canvasWidth,this.canvasHeight),e.fillStyle=this.backgroundColor.toString(),e.fillRect(0,0,this.canvasWidth,this.canvasHeight),this.currentScene.draw(this.ctx,t);for(var i=0,o=this._animations.length;i<o;i++)this._animations[i].animation.draw(e,this._animations[i].x,this._animations[i].y);if(this.isDebug){this.ctx.font="Consolas",this.ctx.fillStyle=this.debugColor.toString();for(var r=this.input.keyboard.getKeys(),n=0;n<r.length;n++)this.ctx.fillText(r[n].toString()+" : "+(v.Keys[r[n]]?v.Keys[r[n]]:"Not Mapped"),100,10*n+10);this.ctx.fillText("FPS:"+this.stats.currFrame.fps.toFixed(2).toString(),10,10)}for(var s=0;s<this.postProcessors.length;s++)this.postProcessors[s].process(this.ctx.getImageData(0,0,this.canvasWidth,this.canvasHeight),this.ctx);this._postdraw(e,t)}},e.prototype._predraw=function(t,e){this.emit("predraw",new p.PreDrawEvent(t,e,this)),this.onPreDraw(t,e)},e.prototype.onPreDraw=function(t,e){},e.prototype._postdraw=function(t,e){this.emit("postdraw",new p.PostDrawEvent(t,e,this)),this.onPostDraw(t,e)},e.prototype.onPostDraw=function(t,e){},e.prototype.start=function(t){var i,r=this;return this._compatible?(t?(this._loader=t,this._loader.wireEngine(this),i=this.load(this._loader)):i=o.Promise.resolve(),i.then(function(){r.emit("start",new p.GameStartEvent(r))}),this._hasStarted||(this._hasStarted=!0,this._logger.debug("Starting game..."),e.createMainLoop(this,window.requestAnimationFrame,Date.now)(),this._logger.debug("Game started")),i):(new o.Promise).reject("Excalibur is incompatible with your browser")},e.createMainLoop=function(t,e,i){var o=i();return function r(){if(t._hasStarted)try{t._requestId=e(r),t.emit("preframe",new p.PreFrameEvent(t,t.stats.prevFrame));var n=i(),s=Math.floor(n-o)||1;s>200&&(s=1);var a=s*t.timescale,h=t.stats.prevFrame.id+1;t.stats.prevFrame.reset(t.stats.currFrame),t.stats.currFrame.reset(),t.stats.currFrame.id=h,t.stats.currFrame.delta=a,t.stats.currFrame.fps=1/(a/1e3);var l=i();t._update(a);var c=i();t._draw(a);var u=i();t.stats.currFrame.duration.update=c-l,t.stats.currFrame.duration.draw=u-c,o=n,t.emit("postframe",new p.PostFrameEvent(t,t.stats.currFrame))}catch(e){window.cancelAnimationFrame(t._requestId),t.stop(),t.onFatalException(e)}}},e.prototype.stop=function(){this._hasStarted&&(this.emit("stop",new p.GameStopEvent(this)),this._hasStarted=!1,this._logger.debug("Game stopped"))},e.prototype.isPaused=function(){return!this._hasStarted},e.prototype.screenshot=function(){var t=new Image,e=this.canvas.toDataURL("image/png");return t.src=e,t},e.prototype.load=function(t){var e=this,i=new o.Promise;return this._isLoading=!0,t.load().then(function(){setTimeout(function(){e._isLoading=!1,i.resolve()},500)}),i},e}(_.Class);P._DefaultEngineOptions={width:0,height:0,canvasElementId:"",pointerScope:v.PointerScope.Document,suppressConsoleBootMessage:null,suppressMinimumBrowserFeatureDetection:null,suppressHiDPIScaling:null,scrollPreventionMode:x.Canvas,backgroundColor:f.Color.fromHex("#2185d0")},e.Engine=P;var C=function(t,e,i){this.animation=t,this.x=e,this.y=i}}),i("Algebra",["require","exports","Util/Util"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){this.x=t,this.y=e}return t.fromAngle=function(e){return new t(Math.cos(e),Math.sin(e))},t.isValid=function(t){return null!==t&&void 0!==t&&!isNaN(t.x)&&!isNaN(t.y)&&t.x!==1/0&&t.y!==1/0&&t.x!==-1/0&&t.y!==1/0},t.distance=function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},t.prototype.setTo=function(t,e){this.x=t,this.y=e},t.prototype.equals=function(t,e){return void 0===e&&(e=.001),Math.abs(this.x-t.x)<=e&&Math.abs(this.y-t.y)<=e},t.prototype.distance=function(e){return e||(e=t.Zero),Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},t.prototype.magnitude=function(){return this.distance()},t.prototype.normalize=function(){var e=this.distance();return e>0?new t(this.x/e,this.y/e):new t(0,1)},t.prototype.average=function(t){return this.add(t).scale(.5)},t.prototype.scale=function(e){return new t(this.x*e,this.y*e)},t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.sub=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.addEqual=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.subEqual=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.scaleEqual=function(t){return this.x*=t,this.y*=t,this},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.prototype.cross=function(e){return e instanceof t?this.x*e.y-this.y*e.x:"number"==typeof e?new t(e*this.y,-e*this.x):void 0},t.prototype.perpendicular=function(){return new t(this.y,-this.x)},t.prototype.normal=function(){return this.perpendicular().normalize()},t.prototype.negate=function(){return this.scale(-1)},t.prototype.toAngle=function(){return Math.atan2(this.y,this.x)},t.prototype.rotate=function(e,i){i||(i=new t(0,0));var o=Math.sin(e),r=Math.cos(e);return new t(r*(this.x-i.x)-o*(this.y-i.y)+i.x,o*(this.x-i.x)+r*(this.y-i.y)+i.y)},t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.toString=function(){return"("+this.x+", "+this.y+")"},t}();o.Zero=new o(0,0),o.One=new o(1,1),o.Half=new o(.5,.5),o.Up=new o(0,-1),o.Down=new o(0,1),o.Left=new o(-1,0),o.Right=new o(1,0),e.Vector=o;var r=function(){function t(t,e){this.pos=t,this.dir=e.normalize()}return t.prototype.intersect=function(t){var e=t.begin.sub(this.pos);if(0===this.dir.cross(t.getSlope())&&0!==e.cross(this.dir))return-1;var i=this.dir.cross(t.getSlope());if(0===i)return-1;var o=e.cross(t.getSlope())/i;if(o>=0){var r=e.cross(this.dir)/i/t.getLength();if(r>=0&&r<=1)return o}return-1},t.prototype.getPoint=function(t){return this.pos.add(this.dir.scale(t))},t}();e.Ray=r;var n=function(){function t(t,e){this.begin=t,this.end=e}return Object.defineProperty(t.prototype,"slope",{get:function(){return(this.end.y-this.begin.y)/(this.end.x-this.begin.x)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"intercept",{get:function(){return this.begin.y-this.slope*this.begin.x},enumerable:!0,configurable:!0}),t.prototype.normal=function(){return this.end.sub(this.begin).normal()},t.prototype.getSlope=function(){var t=this.begin,e=this.end,i=t.distance(e);return e.sub(t).scale(1/i)},t.prototype.getLength=function(){var t=this.begin,e=this.end;return t.distance(e)},t.prototype.distanceToPoint=function(t){var e=t.x,i=t.y,o=this.getLength(),r=this.end.y-this.begin.y,n=this.end.x-this.begin.x;return Math.abs(r*e-n*i+this.end.x*this.begin.y-this.end.y*this.begin.x)/o},t.prototype.findPoint=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null);var i=this.slope,r=this.intercept;if(null!==t)return new o(t,i*t+r);if(null!==e)return new o((e-r)/i,e);throw new Error("You must provide an X or a Y value")},t.prototype.hasPoint=function(){var t,e=0;if("number"==typeof arguments[0]&&"number"==typeof arguments[1])t=new o(arguments[0],arguments[1]),e=arguments[2]||0;else{if(!(arguments[0]instanceof o))throw"Could not determine the arguments for Vector.hasPoint";t=arguments[0],e=arguments[1]||0}var i=t.x-this.begin.x,r=t.y-this.begin.y,n=this.end.x-this.begin.x,s=this.end.y-this.begin.y,a=i*s-r*n;return!(Math.abs(a)>e)&&(Math.abs(n)>=Math.abs(s)?n>0?this.begin.x<=t.x&&t.x<=this.end.x:this.end.x<=t.x&&t.x<=this.begin.x:s>0?this.begin.y<=t.y&&t.y<=this.end.y:this.end.y<=t.y&&t.y<=this.begin.y)},t}();e.Line=n;var s=function(){function t(t,e){this.min=t,this.max=e}return t.prototype.overlaps=function(t){return this.max>t.min&&t.max>this.min},t.prototype.getOverlap=function(t){return this.overlaps(t)?this.max>t.max?t.max-this.min:this.max-t.min:0},t}();e.Projection=s;var a=function(){function t(t,e,i){this.worldPos=t,this.pagePos=e,this.screenPos=i}return t.fromPagePosition=function(e,r,n){var s,a,h,l;3===arguments.length?(h=new o(s=e,a=r),l=n):(s=(h=e).x,a=h.y,l=r);var c=s-i.getPosition(l.canvas).x,u=a-i.getPosition(l.canvas).y,p=new o(c,u);return new t(l.screenToWorldCoordinates(p),h,p)},t}();e.GlobalCoordinates=a}),i("Physics",["require","exports","Algebra"],function(t,e,i){"use strict";var o,r,n;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.Box=0]="Box",t[t.RigidBody=1]="RigidBody"}(o=e.CollisionResolutionStrategy||(e.CollisionResolutionStrategy={})),function(t){t[t.Naive=0]="Naive",t[t.DynamicAABBTree=1]="DynamicAABBTree"}(r=e.BroadphaseStrategy||(e.BroadphaseStrategy={})),function(t){t[t.Euler=0]="Euler"}(n=e.Integrator||(e.Integrator={}));var s=function(){function t(){}return t.useBoxPhysics=function(){t.collisionResolutionStrategy=o.Box},t.useRigidBodyPhysics=function(){t.collisionResolutionStrategy=o.RigidBody},t}();s.acc=new i.Vector(0,0),s.enabled=!0,s.collisionPasses=5,s.broadphaseStrategy=r.DynamicAABBTree,s.broadphaseDebug=!1,s.showCollisionNormals=!1,s.showMotionVectors=!1,s.showBounds=!1,s.showArea=!1,s.showContacts=!1,s.showNormals=!1,s.collisionResolutionStrategy=o.Box,s.defaultMass=10,s.integrator=n.Euler,s.integrationSteps=1,s.allowRigidBodyRotation=!0,s.collisionShift=.001,s.dynamicTreeVelocityMultiplyer=2,s.boundsPadding=5,s.surfaceEpsilon=.1,s.checkForFastBodies=!0,s.disableMinimumSpeedForFastBody=!1,e.Physics=s}),i("Actor",["require","exports","Physics","Class","Collision/BoundingBox","Resources/Texture","Events","Drawing/Color","Drawing/Sprite","Util/Log","Actions/ActionContext","Actions/Action","Algebra","Collision/Body","Collision/Side","Configurable","Traits/Index","Drawing/SpriteEffects","Util/Util"],function(t,e,i,o,n,s,a,h,l,c,u,p,d,f,g,y,_,v,m){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var b=function(t){function e(i,o,r,n,s){var a=t.call(this)||this;if(a.id=e.maxId++,a.body=new f.Body(a),a._height=0,a._width=0,a.scale=new d.Vector(1,1),a.sx=0,a.sy=0,a.isOffScreen=!1,a.visible=!0,a.opacity=1,a.previousOpacity=1,a.logger=c.Logger.getInstance(),a.scene=null,a.parent=null,a.children=[],a.collisionType=w.PreventCollision,a.collisionGroups=[],a._collisionHandlers={},a._isInitialized=!1,a.frames={},a._effectsDirty=!1,a.currentDrawing=null,a.traits=[],a.enableCapturePointer=!1,a.capturePointer={captureMoveEvents:!1,captureDragEvents:!1},a._zIndex=0,a._isKilled=!1,a._opacityFx=new v.Opacity(a.opacity),a._capturePointerEvents=["pointerup","pointerdown","pointermove","pointerenter","pointerleave","pointerdragstart","pointerdragend","pointerdragmove","pointerdragenter","pointerdragleave"],a._captureMoveEvents=["pointermove","pointerenter","pointerleave","pointerdragmove","pointerdragenter","pointerdragleave"],a._captureDragEvents=["pointerdragstart","pointerdragend","pointerdragmove","pointerdragenter","pointerdragleave"],i&&"object"==typeof i){var h=i;i=h.pos?h.pos.x:h.x,o=h.pos?h.pos.y:h.y,r=h.width,n=h.height}return a.pos.x=i||0,a.pos.y=o||0,a._width=r||0,a._height=n||0,s&&(a.color=s,a.opacity=s.a),a.traits.push(new _.TileMapCollisionDetection),a.traits.push(new _.OffscreenCulling),a.traits.push(new _.CapturePointer),a.actionQueue=new p.ActionQueue(a),a.actions=new u.ActionContext(a),a.anchor=new d.Vector(.5,.5),a.body.useBoxCollision(),a}return r(e,t),Object.defineProperty(e.prototype,"collisionArea",{get:function(){return this.body.collisionArea},set:function(t){this.body.collisionArea=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this.body.pos.x},set:function(t){this.body.pos.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.body.pos.y},set:function(t){this.body.pos.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pos",{get:function(){return this.body.pos},set:function(t){this.body.pos.setTo(t.x,t.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"oldPos",{get:function(){return this.body.oldPos},set:function(t){this.body.oldPos.setTo(t.x,t.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vel",{get:function(){return this.body.vel},set:function(t){this.body.vel.setTo(t.x,t.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"oldVel",{get:function(){return this.body.oldVel},set:function(t){this.body.oldVel.setTo(t.x,t.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"acc",{get:function(){return this.body.acc},set:function(t){this.body.acc.setTo(t.x,t.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this.body.rotation},set:function(t){this.body.rotation=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rx",{get:function(){return this.body.rx},set:function(t){this.body.rx=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"torque",{get:function(){return this.body.torque},set:function(t){this.body.torque=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mass",{get:function(){return this.body.mass},set:function(t){this.body.mass=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"moi",{get:function(){return this.body.moi},set:function(t){this.body.moi=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"friction",{get:function(){return this.body.friction},set:function(t){this.body.friction=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"restitution",{get:function(){return this.body.restitution},set:function(t){this.body.restitution=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t.clone()},enumerable:!0,configurable:!0}),e.prototype.onInitialize=function(t){},Object.defineProperty(e.prototype,"isInitialized",{get:function(){return this._isInitialized},enumerable:!0,configurable:!0}),e.prototype._initialize=function(e){this.isInitialized||(this.onInitialize(e),t.prototype.emit.call(this,"initialize",new a.InitializeEvent(e,this)),this._isInitialized=!0);for(var i=0,o=this.children;i<o.length;i++)o[i]._initialize(e)},e.prototype._checkForPointerOptIn=function(t){if(t){var e=t.toLowerCase();-1!==this._capturePointerEvents.indexOf(e)&&(this.enableCapturePointer=!0,-1!==this._captureMoveEvents.indexOf(e)&&(this.capturePointer.captureMoveEvents=!0),-1!==this._captureDragEvents.indexOf(e)&&(this.capturePointer.captureDragEvents=!0))}},e.prototype.on=function(e,i){this._checkForPointerOptIn(e),t.prototype.on.call(this,e,i)},e.prototype.once=function(e,i){this._checkForPointerOptIn(e),t.prototype.once.call(this,e,i)},e.prototype.off=function(e,i){t.prototype.off.call(this,e,i)},e.prototype._prekill=function(e){t.prototype.emit.call(this,"prekill",new a.PreKillEvent(this)),this.onPreKill(e)},e.prototype.onPreKill=function(t){},e.prototype._postkill=function(e){t.prototype.emit.call(this,"postkill",new a.PostKillEvent(this)),this.onPostKill(e)},e.prototype.onPostKill=function(t){},e.prototype.kill=function(){this.scene?(this._prekill(this.scene),this.emit("kill",new a.KillEvent(this)),this.scene.remove(this),this._isKilled=!0,this._postkill(this.scene)):this.logger.warn("Cannot kill actor, it was never added to the Scene")},e.prototype.unkill=function(){this._isKilled=!1},e.prototype.isKilled=function(){return this._isKilled},e.prototype.add=function(t){t.collisionType=w.PreventCollision,m.addItemToArray(t,this.children)&&(t.parent=this)},e.prototype.remove=function(t){m.removeItemFromArray(t,this.children)&&(t.parent=null)},e.prototype.setDrawing=function(t){t=t.toString(),this.currentDrawing!==this.frames[t]&&(null!=this.frames[t]?(this.frames[t].reset(),this.currentDrawing=this.frames[t]):c.Logger.getInstance().error("the specified drawing key '"+t+"' does not exist"))},e.prototype.addDrawing=function(){2===arguments.length?(this.frames[arguments[0]]=arguments[1],this.currentDrawing||(this.currentDrawing=arguments[1]),this._effectsDirty=!0):(arguments[0]instanceof l.Sprite&&this.addDrawing("default",arguments[0]),arguments[0]instanceof s.Texture&&this.addDrawing("default",arguments[0].asSprite()))},Object.defineProperty(e.prototype,"z",{get:function(){return this.getZIndex()},set:function(t){this.setZIndex(t)},enumerable:!0,configurable:!0}),e.prototype.getZIndex=function(){return this._zIndex},e.prototype.setZIndex=function(t){this.scene.cleanupDrawTree(this),this._zIndex=t,this.scene.updateDrawTree(this)},e.prototype.addCollisionGroup=function(t){this.collisionGroups.push(t)},e.prototype.removeCollisionGroup=function(t){var e=this.collisionGroups.indexOf(t);-1!==e&&this.collisionGroups.splice(e,1)},e.prototype.getCenter=function(){return new d.Vector(this.pos.x+this.getWidth()/2-this.anchor.x*this.getWidth(),this.pos.y+this.getHeight()/2-this.anchor.y*this.getHeight())},e.prototype.getWidth=function(){return this._width*this.getGlobalScale().x},e.prototype.setWidth=function(t){this._width=t/this.scale.x},e.prototype.getHeight=function(){return this._height*this.getGlobalScale().y},e.prototype.setHeight=function(t){this._height=t/this.scale.y},e.prototype.getLeft=function(){return this.getBounds().left},e.prototype.getRight=function(){return this.getBounds().right},e.prototype.getTop=function(){return this.getBounds().top},e.prototype.getBottom=function(){return this.getBounds().bottom},e.prototype.getWorldRotation=function(){return this.parent?this.rotation+this.parent.getWorldRotation():this.rotation},e.prototype.getWorldPos=function(){if(!this.parent)return this.pos.clone();var t=[],e=this;for(t.push(this);e.parent;)e=e.parent,t.push(e);var i=t.reduceRight(function(t,e){return e.parent?t+e.pos.x*e.getGlobalScale().x:t+e.pos.x},0),o=t.reduceRight(function(t,e){return e.parent?t+e.pos.y*e.getGlobalScale().y:t+e.pos.y},0),r=e.getWorldPos(),n=this.getWorldRotation();return new d.Vector(i,o).rotate(n,r)},e.prototype.getGlobalScale=function(){if(!this.parent)return new d.Vector(this.scale.x,this.scale.y);var t=this.parent.getGlobalScale();return new d.Vector(this.scale.x*t.x,this.scale.y*t.y)},e.prototype.getBounds=function(){var t=this._getCalculatedAnchor(),e=this.getWorldPos();return new n.BoundingBox(e.x-t.x,e.y-t.y,e.x+this.getWidth()-t.x,e.y+this.getHeight()-t.y).rotate(this.rotation,e)},e.prototype.getRelativeBounds=function(){var t=this._getCalculatedAnchor();return new n.BoundingBox(-t.x,-t.y,this.getWidth()-t.x,this.getHeight()-t.y).rotate(this.rotation)},e.prototype.contains=function(t,e,i){void 0===i&&(i=!1);var o=this.getBounds().contains(new d.Vector(t,e));return i?o||this.children.some(function(i){return i.contains(t,e,!0)}):o},e.prototype.getSideFromIntersect=function(t){return t?Math.abs(t.x)>Math.abs(t.y)?t.x<0?g.Side.Right:g.Side.Left:t.y<0?g.Side.Bottom:g.Side.Top:g.Side.None},e.prototype.collidesWithSide=function(t){var e=this.collides(t);return e?Math.abs(e.x)>Math.abs(e.y)?this.pos.x<t.pos.x?g.Side.Right:g.Side.Left:this.pos.y<t.pos.y?g.Side.Bottom:g.Side.Top:g.Side.None},e.prototype.collides=function(t){var e=this.getBounds(),i=t.getBounds();return e.collides(i)},e.prototype.onCollidesWith=function(t,e){this._collisionHandlers[t]||(this._collisionHandlers[t]=[]),this._collisionHandlers[t].push(e)},e.prototype.getCollisionHandlers=function(){return this._collisionHandlers},e.prototype.removeCollidesWith=function(t){this._collisionHandlers[t]=[]},e.prototype.within=function(t,e){return Math.sqrt(Math.pow(this.pos.x-t.pos.x,2)+Math.pow(this.pos.y-t.pos.y,2))<=e},e.prototype._getCalculatedAnchor=function(){return new d.Vector(this.getWidth()*this.anchor.x,this.getHeight()*this.anchor.y)},e.prototype._reapplyEffects=function(t){t.removeEffect(this._opacityFx),t.addEffect(this._opacityFx)},e.prototype.integrate=function(t){var e=t/1e3,o=this.acc.clone();this.collisionType===w.Active&&o.addEqual(i.Physics.acc),this.vel.addEqual(o.scale(e)),this.pos.addEqual(this.vel.scale(e)).addEqual(o.scale(.5*e*e)),this.rx+=this.torque*(1/this.moi)*e,this.rotation+=this.rx*e,this.scale.x+=this.sx*t/1e3,this.scale.y+=this.sy*t/1e3,this.body.update()},e.prototype.update=function(t,e){this._initialize(t),this._preupdate(t,e),this.actionQueue.update(e),this.color&&(this.color.a=this.opacity),this.previousOpacity!==this.opacity&&(this.previousOpacity=this.opacity,this._opacityFx.opacity=this.opacity,this._effectsDirty=!0),this.oldVel.setTo(this.vel.x,this.vel.y),this.oldPos.setTo(this.pos.x,this.pos.y),this.integrate(e);for(var i=0,o=this.traits;i<o.length;i++)o[i].update(this,t,e);for(var r=0;r<this.children.length;r++)this.children[r].update(t,e);this._postupdate(t,e)},e.prototype.onPreUpdate=function(t,e){},e.prototype.onPostUpdate=function(t,e){},e.prototype._preupdate=function(t,e){this.emit("preupdate",new a.PreUpdateEvent(t,e,this)),this.onPreUpdate(t,e)},e.prototype._postupdate=function(t,e){this.emit("postupdate",new a.PreUpdateEvent(t,e,this)),this.onPostUpdate(t,e)},e.prototype.draw=function(t,e){if(t.save(),t.translate(this.pos.x,this.pos.y),t.rotate(this.rotation),t.scale(this.scale.x,this.scale.y),t.save(),t.translate(-this._width*this.anchor.x,-this._height*this.anchor.y),this._predraw(t,e),this.currentDrawing){var i=this.currentDrawing,o=(this._width-i.width*i.scale.x)*this.anchor.x,r=(this._height-i.height*i.scale.y)*this.anchor.y;this._effectsDirty&&(this._reapplyEffects(this.currentDrawing),this._effectsDirty=!1),this.currentDrawing.draw(t,o,r)}else this.color&&(t.fillStyle=this.color.toString(),t.fillRect(0,0,this._width,this._height));t.restore();for(var n=0;n<this.children.length;n++)this.children[n].visible&&this.children[n].draw(t,e);this._postdraw(t,e),t.restore()},e.prototype.onPreDraw=function(t,e){},e.prototype.onPostDraw=function(t,e){},e.prototype._predraw=function(t,e){this.emit("predraw",new a.PreDrawEvent(t,e,this)),this.onPreDraw(t,e)},e.prototype._postdraw=function(t,e){this.emit("postdraw",new a.PreDrawEvent(t,e,this)),this.onPostDraw(t,e)},e.prototype.debugDraw=function(t){this.emit("predebugdraw",new a.PreDebugDrawEvent(t,this)),this.body.debugDraw(t);var e=this.getBounds();e.debugDraw(t),t.fillText("id: "+this.id,e.left+3,e.top+10),t.fillStyle=h.Color.Yellow.toString(),t.beginPath(),t.arc(this.getWorldPos().x,this.getWorldPos().y,3,0,2*Math.PI),t.closePath(),t.fill();for(var i=0;i<this.traits.length;i++)this.traits[i]instanceof _.OffscreenCulling&&this.traits[i].cullingBox.debugDraw(t);t.strokeStyle=h.Color.Yellow.toString(),t.beginPath();var o=Math.min(this.getWidth(),this.getHeight());t.arc(this.getWorldPos().x,this.getWorldPos().y,o,0,2*Math.PI),t.closePath(),t.stroke();var r={"0 Pi":0,"Pi/2":Math.PI/2,Pi:Math.PI,"3/2 Pi":3*Math.PI/2},n=t.font;for(var s in r)t.fillStyle=h.Color.Yellow.toString(),t.font="14px",t.textAlign="center",t.fillText(s,this.getWorldPos().x+Math.cos(r[s])*(o+10),this.getWorldPos().y+Math.sin(r[s])*(o+10));t.font=n;for(var l=0;l<this.children.length;l++)this.children[l].debugDraw(t);this.emit("postdebugdraw",new a.PostDebugDrawEvent(t,this))},e}(o.Class);b.maxId=0,e.ActorImpl=b;var w,x=function(t){function e(e,i,o,r,n){return t.call(this,e,i,o,r,n)||this}return r(e,t),e}(y.Configurable(b));e.Actor=x,function(t){t[t.PreventCollision=0]="PreventCollision",t[t.Passive=1]="Passive",t[t.Active=2]="Active",t[t.Fixed=3]="Fixed"}(w=e.CollisionType||(e.CollisionType={}))}),i("Actions/Action",["require","exports","Actions/RotationType","Algebra","Util/Log","Util/Util"],function(t,e,i,o,r,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e,i,r,n){this.actor=t,this.easingFcn=n,this._currentLerpTime=0,this._lerpDuration=1e3,this._lerpStart=new o.Vector(0,0),this._lerpEnd=new o.Vector(0,0),this._initialized=!1,this._stopped=!1,this._distance=0,this._lerpDuration=r,this._lerpEnd=new o.Vector(e,i)}return t.prototype._initialize=function(){this._lerpStart=new o.Vector(this.actor.pos.x,this.actor.pos.y),this._currentLerpTime=0,this._distance=this._lerpStart.distance(this._lerpEnd)},t.prototype.update=function(t){this._initialized||(this._initialize(),this._initialized=!0);var e=this.actor.pos.x,i=this.actor.pos.y;this._currentLerpTime<this._lerpDuration?(e=this._lerpEnd.x<this._lerpStart.x?this._lerpStart.x-(this.easingFcn(this._currentLerpTime,this._lerpEnd.x,this._lerpStart.x,this._lerpDuration)-this._lerpEnd.x):this.easingFcn(this._currentLerpTime,this._lerpStart.x,this._lerpEnd.x,this._lerpDuration),i=this._lerpEnd.y<this._lerpStart.y?this._lerpStart.y-(this.easingFcn(this._currentLerpTime,this._lerpEnd.y,this._lerpStart.y,this._lerpDuration)-this._lerpEnd.y):this.easingFcn(this._currentLerpTime,this._lerpStart.y,this._lerpEnd.y,this._lerpDuration),this.actor.pos.x=e,this.actor.pos.y=i,this._currentLerpTime+=t):(this.actor.pos.x=this._lerpEnd.x,this.actor.pos.y=this._lerpEnd.y)},t.prototype.isComplete=function(t){return this._stopped||new o.Vector(t.pos.x,t.pos.y).distance(this._lerpStart)>=this._distance},t.prototype.reset=function(){this._initialized=!1},t.prototype.stop=function(){this._stopped=!0},t}();e.EaseTo=s;var a=function(){function t(t,e,i,r){this._started=!1,this._stopped=!1,this._actor=t,this._end=new o.Vector(e,i),this._speed=r}return t.prototype.update=function(t){this._started||(this._started=!0,this._start=new o.Vector(this._actor.pos.x,this._actor.pos.y),this._distance=this._start.distance(this._end),this._dir=this._end.sub(this._start).normalize());var e=this._dir.scale(this._speed);this._actor.vel.x=e.x,this._actor.vel.y=e.y,this.isComplete(this._actor)&&(this._actor.pos.x=this._end.x,this._actor.pos.y=this._end.y,this._actor.vel.y=0,this._actor.vel.x=0)},t.prototype.isComplete=function(t){return this._stopped||new o.Vector(t.pos.x,t.pos.y).distance(this._start)>=this._distance},t.prototype.stop=function(){this._actor.vel.y=0,this._actor.vel.x=0,this._stopped=!0},t.prototype.reset=function(){this._started=!1},t}();e.MoveTo=a;var h=function(){function t(t,e,i,n){if(this._started=!1,this._stopped=!1,this._actor=t,this._end=new o.Vector(e,i),n<=0)throw r.Logger.getInstance().error("Attempted to moveBy time less than or equal to zero : "+n),new Error("Cannot move in time <= 0");this._time=n}return t.prototype.update=function(t){this._started||(this._started=!0,this._start=new o.Vector(this._actor.pos.x,this._actor.pos.y),this._distance=this._start.distance(this._end),this._dir=this._end.sub(this._start).normalize(),this._speed=this._distance/(this._time/1e3));var e=this._dir.scale(this._speed);this._actor.vel.x=e.x,this._actor.vel.y=e.y,this.isComplete(this._actor)&&(this._actor.pos.x=this._end.x,this._actor.pos.y=this._end.y,this._actor.vel.y=0,this._actor.vel.x=0)},t.prototype.isComplete=function(t){return this._stopped||new o.Vector(t.pos.x,t.pos.y).distance(this._start)>=this._distance},t.prototype.stop=function(){this._actor.vel.y=0,this._actor.vel.x=0,this._stopped=!0},t.prototype.reset=function(){this._started=!1},t}();e.MoveBy=h;var l=function(){function t(t,e,i){this._started=!1,this._stopped=!1,this._actor=t,this._actorToFollow=e,this._current=new o.Vector(this._actor.pos.x,this._actor.pos.y),this._end=new o.Vector(e.pos.x,e.pos.y),this._maximumDistance=void 0!==i?i:this._current.distance(this._end),this._speed=0}return t.prototype.update=function(t){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());var e=Math.sqrt(Math.pow(this._actorToFollow.vel.x,2)+Math.pow(this._actorToFollow.vel.y,2));if(0!==e&&(this._speed=e),this._current.x=this._actor.pos.x,this._current.y=this._actor.pos.y,this._end.x=this._actorToFollow.pos.x,this._end.y=this._actorToFollow.pos.y,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize(),this._distanceBetween>=this._maximumDistance){var i=this._dir.scale(this._speed);this._actor.vel.x=i.x,this._actor.vel.y=i.y}else this._actor.vel.x=0,this._actor.vel.y=0;this.isComplete()&&(this._actor.pos.x=this._end.x,this._actor.pos.y=this._end.y,this._actor.vel.y=0,this._actor.vel.x=0)},t.prototype.stop=function(){this._actor.vel.y=0,this._actor.vel.x=0,this._stopped=!0},t.prototype.isComplete=function(){return this._stopped},t.prototype.reset=function(){this._started=!1},t}();e.Follow=l;var c=function(){function t(t,e,i){this._started=!1,this._stopped=!1,this._speedWasSpecified=!1,this._actor=t,this._actorToMeet=e,this._current=new o.Vector(this._actor.pos.x,this._actor.pos.y),this._end=new o.Vector(e.pos.x,e.pos.y),this._speed=i||0,void 0!==i&&(this._speedWasSpecified=!0)}return t.prototype.update=function(t){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());var e=Math.sqrt(Math.pow(this._actorToMeet.vel.x,2)+Math.pow(this._actorToMeet.vel.y,2));0===e||this._speedWasSpecified||(this._speed=e),this._current.x=this._actor.pos.x,this._current.y=this._actor.pos.y,this._end.x=this._actorToMeet.pos.x,this._end.y=this._actorToMeet.pos.y,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize();var i=this._dir.scale(this._speed);this._actor.vel.x=i.x,this._actor.vel.y=i.y,this.isComplete()&&(this._actor.pos.x=this._end.x,this._actor.pos.y=this._end.y,this._actor.vel.y=0,this._actor.vel.x=0)},t.prototype.isComplete=function(){return this._stopped||this._distanceBetween<=1},t.prototype.stop=function(){this._actor.vel.y=0,this._actor.vel.x=0,this._stopped=!0},t.prototype.reset=function(){this._started=!1},t}();e.Meet=c;var u=function(){function t(t,e,o,r){this._started=!1,this._stopped=!1,this._actor=t,this._end=e,this._speed=o,this._rotationType=r||i.RotationType.ShortestPath}return t.prototype.update=function(t){if(!this._started){this._started=!0,this._start=this._actor.rotation;var e=Math.abs(this._end-this._start),o=n.TwoPI-e;switch(e>o?(this._shortDistance=o,this._longDistance=e):(this._shortDistance=e,this._longDistance=o),this._shortestPathIsPositive=(this._start-this._end+n.TwoPI)%n.TwoPI>=Math.PI,this._rotationType){case i.RotationType.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case i.RotationType.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case i.RotationType.Clockwise:this._direction=1,this._shortestPathIsPositive?this._distance=this._shortDistance:this._distance=this._longDistance;break;case i.RotationType.CounterClockwise:this._direction=-1,this._shortestPathIsPositive?this._distance=this._longDistance:this._distance=this._shortDistance}}this._actor.rx=this._direction*this._speed,this.isComplete()&&(this._actor.rotation=this._end,this._actor.rx=0,this._stopped=!0)},t.prototype.isComplete=function(){var t=Math.abs(this._actor.rotation-this._start);return this._stopped||t>=Math.abs(this._distance)},t.prototype.stop=function(){this._actor.rx=0,this._stopped=!0},t.prototype.reset=function(){this._started=!1},t}();e.RotateTo=u;var p=function(){function t(t,e,o,r){this._started=!1,this._stopped=!1,this._actor=t,this._end=e,this._time=o,this._rotationType=r||i.RotationType.ShortestPath}return t.prototype.update=function(t){if(!this._started){this._started=!0,this._start=this._actor.rotation;var e=Math.abs(this._end-this._start),o=n.TwoPI-e;switch(e>o?(this._shortDistance=o,this._longDistance=e):(this._shortDistance=e,this._longDistance=o),this._shortestPathIsPositive=(this._start-this._end+n.TwoPI)%n.TwoPI>=Math.PI,this._rotationType){case i.RotationType.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case i.RotationType.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case i.RotationType.Clockwise:this._direction=1,this._shortDistance>=0?this._distance=this._shortDistance:this._distance=this._longDistance;break;case i.RotationType.CounterClockwise:this._direction=-1,this._shortDistance<=0?this._distance=this._shortDistance:this._distance=this._longDistance}this._speed=Math.abs(this._distance/this._time*1e3)}this._actor.rx=this._direction*this._speed,this.isComplete()&&(this._actor.rotation=this._end,this._actor.rx=0,this._stopped=!0)},t.prototype.isComplete=function(){var t=Math.abs(this._actor.rotation-this._start);return this._stopped||t>=Math.abs(this._distance)},t.prototype.stop=function(){this._actor.rx=0,this._stopped=!0},t.prototype.reset=function(){this._started=!1},t}();e.RotateBy=p;var d=function(){function t(t,e,i,o,r){this._started=!1,this._stopped=!1,this._actor=t,this._endX=e,this._endY=i,this._speedX=o,this._speedY=r}return t.prototype.update=function(t){if(this._started||(this._started=!0,this._startX=this._actor.scale.x,this._startY=this._actor.scale.y,this._distanceX=Math.abs(this._endX-this._startX),this._distanceY=Math.abs(this._endY-this._startY)),Math.abs(this._actor.scale.x-this._startX)>=this._distanceX)this._actor.sx=0;else{var e=this._endY<this._startY?-1:1;this._actor.sx=this._speedX*e}if(Math.abs(this._actor.scale.y-this._startY)>=this._distanceY)this._actor.sy=0;else{var i=this._endY<this._startY?-1:1;this._actor.sy=this._speedY*i}this.isComplete()&&(this._actor.scale.x=this._endX,this._actor.scale.y=this._endY,this._actor.sx=0,this._actor.sy=0)},t.prototype.isComplete=function(){return this._stopped||Math.abs(this._actor.scale.y-this._startX)>=this._distanceX&&Math.abs(this._actor.scale.y-this._startY)>=this._distanceY},t.prototype.stop=function(){this._actor.sx=0,this._actor.sy=0,this._stopped=!0},t.prototype.reset=function(){this._started=!1},t}();e.ScaleTo=d;var f=function(){function t(t,e,i,o){this._started=!1,this._stopped=!1,this._actor=t,this._endX=e,this._endY=i,this._speedX=(this._endX-this._actor.scale.x)/o*1e3,this._speedY=(this._endY-this._actor.scale.y)/o*1e3}return t.prototype.update=function(t){this._started||(this._started=!0,this._startX=this._actor.scale.x,this._startY=this._actor.scale.y,this._distanceX=Math.abs(this._endX-this._startX),this._distanceY=Math.abs(this._endY-this._startY));var e=this._endX<this._startX?-1:1,i=this._endY<this._startY?-1:1;this._actor.sx=this._speedX*e,this._actor.sy=this._speedY*i,this.isComplete()&&(this._actor.scale.x=this._endX,this._actor.scale.y=this._endY,this._actor.sx=0,this._actor.sy=0)},t.prototype.isComplete=function(){return this._stopped||Math.abs(this._actor.scale.x-this._startX)>=this._distanceX&&Math.abs(this._actor.scale.y-this._startY)>=this._distanceY},t.prototype.stop=function(){this._actor.sx=0,this._actor.sy=0,this._stopped=!0},t.prototype.reset=function(){this._started=!1},t}();e.ScaleBy=f;var g=function(){function t(t,e){this._elapsedTime=0,this._started=!1,this._stopped=!1,this._actor=t,this._delay=e}return t.prototype.update=function(t){this._started||(this._started=!0),this.x=this._actor.pos.x,this.y=this._actor.pos.y,this._elapsedTime+=t},t.prototype.isComplete=function(){return this._stopped||this._elapsedTime>=this._delay},t.prototype.stop=function(){this._stopped=!0},t.prototype.reset=function(){this._elapsedTime=0,this._started=!1},t}();e.Delay=g;var y=function(){function t(t,e,i,o){void 0===o&&(o=1),this._timeVisible=0,this._timeNotVisible=0,this._elapsedTime=0,this._totalTime=0,this._stopped=!1,this._started=!1,this._actor=t,this._timeVisible=e,this._timeNotVisible=i,this._duration=(e+i)*o}return t.prototype.update=function(t){this._started||(this._started=!0),this._elapsedTime+=t,this._totalTime+=t,this._actor.visible&&this._elapsedTime>=this._timeVisible&&(this._actor.visible=!1,this._elapsedTime=0),!this._actor.visible&&this._elapsedTime>=this._timeNotVisible&&(this._actor.visible=!0,this._elapsedTime=0),this.isComplete()&&(this._actor.visible=!0)},t.prototype.isComplete=function(){return this._stopped||this._totalTime>=this._duration},t.prototype.stop=function(){this._actor.visible=!0,this._stopped=!0},t.prototype.reset=function(){this._started=!1,this._elapsedTime=0,this._totalTime=0},t}();e.Blink=y;var _=function(){function t(t,e,i){this._multiplier=1,this._started=!1,this._stopped=!1,this._actor=t,this._endOpacity=e,this._speed=i}return t.prototype.update=function(t){this._started||(this._started=!0,this._endOpacity<this._actor.opacity?this._multiplier=-1:this._multiplier=1),this._speed>0&&(this._actor.opacity+=this._multiplier*(Math.abs(this._actor.opacity-this._endOpacity)*t)/this._speed),this._speed-=t,this.isComplete()&&(this._actor.opacity=this._endOpacity),r.Logger.getInstance().debug("[Action fade] Actor opacity:",this._actor.opacity)},t.prototype.isComplete=function(){return this._stopped||Math.abs(this._actor.opacity-this._endOpacity)<.05},t.prototype.stop=function(){this._stopped=!0},t.prototype.reset=function(){this._started=!1},t}();e.Fade=_;var v=function(){function t(t){this._stopped=!1,this._actor=t}return t.prototype.update=function(t){this._actor.actionQueue.clearActions(),this._actor.kill(),this._stopped=!0},t.prototype.isComplete=function(){return this._stopped},t.prototype.stop=function(){},t.prototype.reset=function(){},t}();e.Die=v;var m=function(){function t(t,e){this._method=null,this._actor=null,this._hasBeenCalled=!1,this._actor=t,this._method=e}return t.prototype.update=function(t){this._method.call(this._actor),this._hasBeenCalled=!0},t.prototype.isComplete=function(){return this._hasBeenCalled},t.prototype.reset=function(){this._hasBeenCalled=!1},t.prototype.stop=function(){this._hasBeenCalled=!0},t}();e.CallMethod=m;var b=function(){function t(t,e,i){this._stopped=!1,this._actor=t,this._actionQueue=new x(t),this._repeat=e,this._originalRepeat=e;for(var o=0,r=i.length;o<r;o++)i[o].reset(),this._actionQueue.add(i[o])}return t.prototype.update=function(t){this.x=this._actor.pos.x,this.y=this._actor.pos.y,this._actionQueue.hasNext()||(this._actionQueue.reset(),this._repeat--),this._actionQueue.update(t)},t.prototype.isComplete=function(){return this._stopped||this._repeat<=0},t.prototype.stop=function(){this._stopped=!0},t.prototype.reset=function(){this._repeat=this._originalRepeat},t}();e.Repeat=b;var w=function(){function t(t,e){this._stopped=!1,this._actor=t,this._actionQueue=new x(t);for(var i=0,o=e.length;i<o;i++)e[i].reset(),this._actionQueue.add(e[i])}return t.prototype.update=function(t){this.x=this._actor.pos.x,this.y=this._actor.pos.y,this._stopped||(this._actionQueue.hasNext()||this._actionQueue.reset(),this._actionQueue.update(t))},t.prototype.isComplete=function(){return this._stopped},t.prototype.stop=function(){this._stopped=!0,this._actionQueue.clearActions()},t.prototype.reset=function(){},t}();e.RepeatForever=w;var x=function(){function t(t){this._actions=[],this._completedActions=[],this._actor=t}return t.prototype.add=function(t){this._actions.push(t)},t.prototype.remove=function(t){var e=this._actions.indexOf(t);this._actions.splice(e,1)},t.prototype.clearActions=function(){this._actions.length=0,this._completedActions.length=0,this._currentAction&&this._currentAction.stop()},t.prototype.getActions=function(){return this._actions.concat(this._completedActions)},t.prototype.hasNext=function(){return this._actions.length>0},t.prototype.reset=function(){this._actions=this.getActions();for(var t=0,e=this._actions.length;t<e;t++)this._actions[t].reset();this._completedActions=[]},t.prototype.update=function(t){this._actions.length>0&&(this._currentAction=this._actions[0],this._currentAction.update(t),this._currentAction.isComplete(this._actor)&&this._completedActions.push(this._actions.shift()))},t}();e.ActionQueue=x}),"undefined"==typeof window&&(window={audioContext:function(){}}),"undefined"==typeof window||window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setInterval(t,1e3/60)}),"undefined"==typeof window||window.cancelAnimationFrame||(window.cancelAnimationFrame=window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||function(){}),"undefined"==typeof window||window.AudioContext||(window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext),"undefined"==typeof window||window.devicePixelRatio||(window.devicePixelRatio=window.devicePixelRatio||1),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){var i,o;if(null==this)throw new TypeError("this is null or not defined");var r=Object(this),n=r.length>>>0;if("function"!=typeof t)throw new TypeError(t+" is not a function");for(arguments.length>1&&(i=e),o=0;o<n;){var s;o in r&&(s=r[o],t.call(i,s,o,r)),o++}}),Array.prototype.some||(Array.prototype.some=function(t){"use strict";if(void 0===this||null===this)throw new TypeError;var e=Object(this),i=e.length>>>0;if("function"!=typeof t)throw new TypeError;for(var o=arguments.length>=2?arguments[1]:void 0,r=0;r<i;r++)if(r in e&&t.call(o,e[r],r,e))return!0;return!1}),Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),i=this,o=function(){},r=function(){return i.apply(this instanceof o&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return o.prototype=this.prototype,r.prototype=new o,r}),e("Index")}()}.apply(e,[]))||(t.exports=o)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i(0),r=function(){function t(t){this.padding=20,this.xoffset=65,this.yoffset=20,this.columns=5,this.rows=3,this.brickWidth=t.drawWidth/this.columns-this.padding-this.padding/this.columns,this.brickHeight=30,this.brickColor=[o.Color.Violet,o.Color.Orange,o.Color.Yellow],this.generateBricks(t)}return t.prototype.generateBricks=function(t){this.bricks=[];for(var e=0;e<this.rows;e++)for(var i=0;i<this.columns;i++)this.bricks.push(new o.Actor(this.xoffset+i*(this.brickWidth+this.padding)+this.padding,this.yoffset+e*(this.brickHeight+this.padding)+this.padding,this.brickWidth,this.brickHeight,this.brickColor[e%this.brickColor.length]));this.bricks.forEach(function(e){e.collisionType=o.CollisionType.Active,e.on("precollision",function(){e.kill()}),t.add(e)})},t}();e.Bricks=r},function(t,e,i){"use strict";var o,r=this&&this.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var n=i(0),s=function(t){function e(e){var i=t.call(this,{x:100,y:300,width:20,height:20})||this;return i.game=e,i.collisionType=n.CollisionType.Passive,i.vel.setTo(200,200),i.color=n.Color.Red,i.draw=function(t,e){t.fillStyle=i.color.toString(),t.beginPath(),t.arc(i.pos.x,i.pos.y,10,0,2*Math.PI),t.closePath(),t.fill()},i.registerPrecollision(),i.registerPostupdate(),i}return r(e,t),e.prototype.registerPrecollision=function(){var t=this;this.on("precollision",function(e){var i=e.intersection.normalize();Math.abs(i.x)>Math.abs(i.y)?t.vel.x*=-1:t.vel.y*=-1})},e.prototype.registerPostupdate=function(){var t=this;this.on("postupdate",function(){t.pos.x<t.getWidth()/2&&(t.vel.x*=-1),t.pos.x+t.getWidth()/2>t.game.drawWidth&&(t.vel.x*=-1),t.pos.y<t.getHeight()/2&&(t.vel.y*=-1)}),this.on("exitviewport",function(){alert("You lose!")})},e}(n.Actor);e.Ball=s},function(t,e,i){"use strict";var o,r=this&&this.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var n=i(0),s=function(t){function e(e){var i=t.call(this,{x:e.drawWidth/2,y:e.drawHeight-40,width:200,height:20})||this;return i.color=n.Color.Chartreuse,i.collisionType=n.CollisionType.Fixed,i.addInputListener(e),i}return r(e,t),e.prototype.addInputListener=function(t){var e=this;t.input.pointers.primary.on("move",function(t){e.x=t.x})},e}(n.Actor);e.Paddle=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i(0),r=i(3),n=i(2),s=i(1),a=new o.Engine({width:800,height:600});a.isDebug=!0;var h=new r.Paddle(a),l=new n.Ball(a);new s.Bricks(a);a.start().then(function(){a.add(h),a.add(l)})}]);